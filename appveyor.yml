version: 1.0.{build}
image: Visual Studio 2019

environment:
  DOCKER_USER:
    secure: CbwbpNPxLV9AwhjSpIz7LA==
  DOCKER_PASS:
    secure: /T9ITfudL23Ga+Mz7oRaVA==
  WORKBENCH_ENVIRONMENT:
    secure: /0UAqpwPkUwhtSS6lpKMBHZ8ljEtyTr5h3VPFqsliGItsA4r4pDMJ4CiR7ga9cGoQJL7OtUCMR0yTk9eBQeF6nYxX03R9YRkfoq2hFPvs6R7281rEvLo+nWu0WVkXediro3tkkn8+5sCw9O2IAGL9njeCwHijA196zywnOpfAQUumVfTch4SotJ8nZxbxt/e9LKF01Uql/G0n2NTC56I/Kl9TGU8pL9mcZCxF7B4cvOZqUeaT+4wKLLtXznVQJNhAzog/tHkq1QjAgdSXZVm6FpSI0cZ6rs63Baz2ePGvRmVDvWSh8ItzGtpdVvmR9lYHVqZws/jdNQvhmusDmNijPdhUSsqOIWKFSjMtdz6TxTYhQ5RcnMqc+mEzW1kpeojeKNWggXcI46NuS7oUuw6tGxrfGVqSKch3m6fVtmsxz8KboUao76JhteLorJdUr9oTUIj5ZDYXo+nJ1pZteCGt8Wfnd5xi6Du7rr6R3rt4LaXe0Ye1cGklHx5ZxQL/A1NSqTRoYL71+y9w5jm/SStylYiN3ZsPtg2t9YvhaeZ0OmZ8UUZXIue7AjB6BkabqsPVzMHaBJA6u+ivmB8VLJYfVl/NhdQqpKqOh7iLAwMpl8=
  HOBBES_PAT:
    secure: FMSdnVu01kCl/h3wLYiJfrZh9g8XCScl5sT98lVFr8KakwD9C5Lsqs01fn4o7DwX7zu+voHMzTqJ+eE+eTP/j63LoH5DHq81hW2w0Rq6EOEXg1EAUolVHsVerSUAXzfpwnvRHzagS9pD6MX7/n7813lHo9vFL4lIZeqmc1oK/eFy4trd2cGfwbrgxFY2NZnzpzY2R9vVHTCiIJuDS33BuQ==
  PM_APIKEY:
    secure: ujCKbQHfvl9fiBouXlRQH1hq59pHNBKj+CyfDaowaVTxQm67QvpmG6HuVEgcmRvkwDwjVIjOo8IEe7X/fmwRKKLb1eYv8yUd4YSJ+T36Md0=

install:
  - docker version
  - dotnet tool install fake-cli -g
  - dotnet tool install --global --version 5.198.0 paket
  - npm install -s -g --unicode=false newman

before_build:
  - paket install
  - mkdir "c:\projects\hobbes\hobbes.server\db\data"

build_script: 
  - fake build --target build
  - fake build --target builddocker

test_script:
  - fake build --target test
  #- newman run https://api.getpostman.com/collections/4127812-d535bce5-ad9a-4346-acb4-311c8443c478?apikey=%PM_APIKEY% -e https://api.getpostman.com/environments/4127812-b0dfd968-9fc7-406b-b5a4-11bae0ed4b47?apikey=%PM_APIKEY%
  #- newman run https://api.getpostman.com/collections/9463780-a7355a7a-5fe6-42b5-a1ed-877f3c9bc2f7?apikey=%PM_APIKEY% -e https://api.getpostman.com/environments/4127812-b0dfd968-9fc7-406b-b5a4-11bae0ed4b47?apikey=%PM_APIKEY% --env-var "pat=%HOBBES_PAT%"

deploy_script:
  - docker login -u="%DOCKER_USER%" -p="%DOCKER_PASS%"
  - fake build --target publish

