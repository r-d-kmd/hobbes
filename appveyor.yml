version: 1.0.{build}
image: Visual Studio 2019

environment:
  DOCKER_USER:
    secure: CbwbpNPxLV9AwhjSpIz7LA==
  DOCKER_PASS:
    secure: /T9ITfudL23Ga+Mz7oRaVA==
  WORKBENCH_ENVIRONMENT:
    secure: YxlOCsSIWCrx3tPfgCsU0kZK2Jk8FUoLOGoAUU0F8MTMf5DMAi7Fml3sCqYsFvjQ7+/afn7s8N+bhukqec85rM2RvpTnNERfoiqi1gmgoUBZ78lQZsrbK3HxzSPOnue77BYvwzdwYK1rgBe5Z9CwtrfbJZo6VqrL1OSH8t3RgqF+3+ejwGbw0BLVzrdLGFlydV5/Y6P0lsnmZzynMr7OScFHx+rqiSXNrUhwPBQ0DgYkg2MvkGhrnegvZZi31HfjOWEpXE2/NKZQ7YAhm6UaGDh/IcQZp//YcBVv8IIPoBR0af8xuazFQpfqgr58GCuQoAd38kUlNccwzuE8gmrJOHPGzvV/uosqfNAzYp5Ff6F4Vm49ZCP3CtwcopbRjXnRCdmMksxio1ILF2HxaMzSODqs/TMFY86RRLNpG52rZoA=

dotnet_csproj:
  patch: true
  file: '**\hobbes.server.fsproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'
  
install:
  - docker version
  - dotnet tool install fake-cli -g
  - dotnet tool install --global --version 5.198.0 paket

before_build:
  - paket install
  - mkdir "c:\projects\hobbes\hobbes.server\db\data"

build_script: 
  - fake build --target build
  - fake build --target builddocker

test_script:
  - fake build --target test

after_test:
  - npm install -s -g --unicode=false newman
  - newman run --disable-unicode .\hobbes.server\db\Postman_collections\Smoktests.json -e .\hobbes.server\db\Postman_collections\Production_environment.json

deploy_script:
  - docker login -u="%DOCKER_USER%" -p="%DOCKER_PASS%"
  - fake build --target Publish

