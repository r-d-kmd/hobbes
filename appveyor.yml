version: 1.0.{build}
image: Visual Studio 2019

environment:
  DOCKER_USER:
    secure: CbwbpNPxLV9AwhjSpIz7LA==
  DOCKER_PASS:
    secure: /T9ITfudL23Ga+Mz7oRaVA==
  WORKBENCH_ENVIRONMENT:
    secure: VeWoaKDYLSvaT7Twdm5oF2UvhiZuB1Gqtj5gdZxX2j4fHkNRoFyFJfTt1QoIMOuyDzWy2EF9lTqJeAvRcKmWCbuAbcC+zxOb3OSGxzrap33knFmgF/+C0aip9pWI5/jgVZOIaALHCbMS2s/hO6bUEptqe6/PsoDF/w+oUBbhO0hZTxF1HF7LVUqM5kxNBNq/Z4N/R9aKUVwEpNdCS/luo47lBsWckHaW5RgsuZoaVDTuXzrj9PoQJ8FCIzAGrnkqPIV/ArjpzPNy6tNWG3cp6Gm4iFDCsyYKUY5B4rtpbSQ0wrEaoSEc1Q3Ayien3GBFxEem3LtHfA7ds3A3jfb9KR80iMJRtNtGctmkHsxN1kNPdAeI//ASsTyo2FpG1jEO

dotnet_csproj:
  patch: true
  file: '**\hobbes.server.fsproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'
  
install:
  - docker version
  - dotnet tool install fake-cli -g
  - dotnet tool install --global --version 5.198.0 paket

before_build:
  - paket install
  - mkdir "c:\projects\hobbes\hobbes.server\db\data"

build_script: 
  - fake build --target build
  - fake build --target builddocker

test_script:
  - fake build --target test

after_test:
  - npm install -s -g --unicode=false newman
  - newman run --disable-unicode .\hobbes.server\db\Postman_collections\Smoktests.json -e .\hobbes.server\db\Postman_collections\Production_environment.json

deploy_script:
  - docker login -u="%DOCKER_USER%" -p="%DOCKER_PASS%"
  - fake build --target Publish

