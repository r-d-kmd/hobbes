"use strict";define("Build/Common/Library/Legacy",["require","exports","VSS/Core/Observable","VSSUI/Utilities/ItemContribution","VSS/Features/Frame/ContributedPivotBarActionProvider","VSS/Features/Frame/ContributedPivotBarItemProvider","Build/Flux/Action","react","Build/Common/Library/Components/BuildPersona","Build/Common/Library/Identity","Build/SourceProviders/Common","VSS/Core/Util/String","VSS/Features/Identities/IdentityPickerProvider","VSSUI/Card","VSSUI/Dialog","VSSUI/IdentityPicker","VSSUI/List","VSSUI/Utilities/Date","VSSUI/Utilities/Provider","VSSUI/FormItem","VSSUI/TextField","VSSUI/Button","VSS/Platform/Layout","VSSUI/ComboBox","VSSUI/ConditionalChildren","VSSUI/Observer","VSSUI/Spinner","VSSUI/Util","Build/Common/Library/RepositoryService","Build/Common/Library/Constants","VSS/Core/Util/Object","VSSUI/MessageCard","VSSUI/Panel","VSSUI/RadioButton","VSSUI/Checkbox","Build/Flux/Store","DistributedTask/Common/Library/Sources/Queue"],function(e,t,i,s,o,r,n,a,c,l,h,d,p,u,m,S,g,b,v,_,C,f,y,P,x,w,B,k,I,E,F,T,D,L,O,R,V){var N,A,U,M,W;N=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.OkButtonText="Ok",t.Resources.AutoLinkWorkItemsOption="Automatically link work items included in this run",t.Resources.BranchDropdownForCommitLabel="Branch context",t.Resources.BranchesError="Error loading branches",t.Resources.BranchLabel="Branch",t.Resources.CancelButtonText="Cancel",t.Resources.CommitsLabel="Commit",t.Resources.FailedToLoadRepoErrorMessage="Failed to load Azure Repos source specified by this pipeline. Please ensure Azure Repos is enabled for this project.",t.Resources.MoreOptions="More options",t.Resources.OpenShelvesetPickerTooltip="Open the shelveset picker",t.Resources.PickBranchForCommitDescription="Select a branch that contains the commit",t.Resources.PipelineSettingsPanelTitle="Pipeline settings",t.Resources.PipelineSettingsSubheaderStatus="Processing of new run requests",t.Resources.PipelineSettingsStatusEnabled="Enabled",t.Resources.PipelineSettingsStatusDisabled="Disabled",t.Resources.PipelineSettingsStatusPaused="Paused",t.Resources.PipelineSettingsYamlDiscard="This will discard unsaved changes in the current YAML file",t.Resources.PipelineSettingsYamlFetchError="An unspecified error occurred while fetching existing YAML files.",t.Resources.PipelineSettingsYamlFilePath="YAML file path",t.Resources.SaveButtonLabel="Save",t.Resources.ShelvesetPickerDialogTitle="Shelveset picker",t.Resources.ShelvesetCommentFormat="{0} created {1} ({2})",t.Resources.ShelvesetNameFormat="{0}: {1}",t.Resources.ShelvesetOwnerName="Shelveset owner name",t.Resources.ShelvesetTextboxTitle="Shelveset name",t.Resources.SourceVersionTextboxTitle="Source version",t.Resources.VersionSelectorPlaceholderText="Select a branch",function(e){var r;t.ObservablePivotActionArray={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.StaticFirst=0]="StaticFirst",e[e.ContributedFirst=1]="ContributedFirst"}(r=t.ObservablePivotActionArray.ItemOrdering||(t.ObservablePivotActionArray.ItemOrdering={}));t.ObservablePivotActionArray.ObservableHeaderCommandArray=class extends i.ObservableArray{constructor(e,t,i,r,n,a){super([]),this._convert=(e=>{let t={id:e.key,text:e.name,iconProps:e.iconProps,isPrimary:!1,important:!1,disabled:e.disabled,href:e.href,onActivate:(t,i)=>e.onClick&&e.onClick(i),itemType:e.separator?1:0};if(e.children){t.subMenuProps={},t.subMenuProps.id=e.key+"-submenu";let i=[];e.children.forEach(e=>{i.push(this._convertChildAction(e))}),t.subMenuProps.items=i}return this._mutate&&(t=this._mutate(t)),t}),this._convertChildAction=(e=>{let t={id:e.key,text:e.name,iconProps:e.iconProps,disabled:e.disabled,href:e.href,onActivate:(t,i)=>e.onClick&&e.onClick(i),itemType:e.separator?1:0};if(e.children){t.subMenuProps={id:e.key+"submenu",items:[]};let i=[];e.children.forEach(e=>{i.push(this._convertChildAction(e))}),t.subMenuProps.items=i}return this._mutate&&(t=this._mutate(t)),t});let c=[];c=c.concat(t),this._contributedItems=[],i.forEach(t=>{const i=new o.ContributedPivotBarActionProvider({context:e,targetId:t.contributionId,getContext:t.getContributionContext});let r=new s.ContributedItemWithIdArray(i,e=>e,e=>e.key);this._contributedItems.push(r),r.subscribe((e,t)=>{this.value=this._getItems()})}),this._staticItems=t,this._divider=n,this._order=r,this._mutate=a,this.value=this._getItems()}_getItems(){let e=[];if(this._order===r.ContributedFirst&&(this._contributedItems.forEach(t=>{e=e.concat(t.value.map(this._convert))}),e.length>0&&this._divider&&(e=e.concat(this._divider))),e=e.concat(this._staticItems),this._order===r.StaticFirst){let t=!1;this._contributedItems.forEach(i=>{this._divider&&!t&&i.value.length>0&&(e=e.concat(this._divider),t=!0),e=e.concat(i.value.map(this._convert))})}return e}}}(),function(e){t.PivotItemToTabProvider={},Object.defineProperty(t,"__esModule",{value:!0}),t.PivotItemToTabProvider.getPivotItemToTabProvider=function(e,t,i,o,n){return new s.ObservableArrayWrappingItemProvider(new s.MutatedItemProvider(new r.ContributedPivotBarItemProvider({pageContext:e,tabGroupIds:[t],getContext:i}),e=>{const t=function(e,t,i){const s=e.id||e.itemKey||"";return s&&!e.url&&(t[s]||(t[s]=i.createObservableUrl({view:s})),e.url=t[s],e.itemKey=s),e}(e,o,n);return{id:t.itemKey||t.id,name:t.text,render:t.render,order:t.order,url:t.url,onBeforeTabChange:t.onBeforePivotChange}})).getItems()}}(),function(e){A=t.ComponentsShelvesetAction={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsShelvesetAction.ShelvesetPickerActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i}closePicker(e){this._actionHub.pickerDismissed.invoke(e)}};class i{constructor(){this._pickerDismissed=new n.Action}get pickerDismissed(){return this._pickerDismissed}}t.ComponentsShelvesetAction.ShelvesetPickerActionHub=i}(),function(e){U=t.ComponentsShelvesetPickerDialog={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsShelvesetPickerDialog.ShelvesetPickerDialog=class extends a.Component{constructor(e){super(e),this._pickedIdentity=new i.ObservableValue(void 0),this._selectedShelvesetName="",this._setCurrentUser=(()=>{if(this.props.pageContext){const e=this.props.pageContext.getService("IVssPageService").getData();e&&e.user&&(this._owner=e.user)}}),this._renderRow=((e,t,i)=>{const s=t.comment?d.format(N.ShelvesetNameFormat,t.name,t.comment):t.name;return a.createElement(g.ListItem,{key:"list-item"+e,index:e,details:i,className:"shelveset-row"},this._getUserImage(t),a.createElement("div",{className:"shelveset-info"},a.createElement("span",{className:"shelveset-title text-ellipsis"},s),a.createElement("span",{className:"shelveset-details"},this._getShelvesetDetails(t))))}),this._getShelvesetDetails=(e=>{let t="";const i=e.createdDate;return t=d.format(N.ShelvesetCommentFormat,e.owner.displayName,i.toLocaleDateString(),b.ago(i))}),this._getUserImage=(e=>a.createElement("span",{"aria-hidden":!0,className:"shelveset-owner"},a.createElement(c.BuildPersona,{size:"medium-plus",cssClass:"build-list-persona",displayName:e.owner.displayName,imageUrl:l.getAvatarUrl(e.owner),unloadableImageUrls:this._unloadableImageUrls}))),this._onSelectionChanged=((e,t)=>{const i=this.state.shelvesets[t.index];i&&(this._selectedShelvesetName=i.name+";"+i.owner.uniqueName,this.setState(this._getState()))}),this._onPeoplePickerChange=(e=>{e&&e.subjectDescriptor&&(this._owner=this._convertPickerIdentityToIdentityRef(e)||this._owner,this._fetchShelvesets()),this._pickedIdentity.value=e}),this._fetchShelvesets=(()=>{this._sourceProvider.fetchShelvesets(this._owner.id).then(e=>{this._shelvesets=e.sort((e,t)=>e.createdDate<t.createdDate?1:t.createdDate<e.createdDate?-1:0),this.setState(this._getState())})}),this._getState=(()=>({shelvesets:this._shelvesets,owner:this._owner,selectedShelvesetName:this._selectedShelvesetName})),this._onClickOk=(()=>{this._actionCreator.closePicker(this.state.selectedShelvesetName)}),this._onDismiss=(()=>{this._actionCreator.closePicker("")}),this._actionCreator=new A.ShelvesetPickerActionCreator({actionHub:this.props.actionHub}),this._listSelection=new g.ListSelection,this._unloadableImageUrls=new Set,this._shelvesets=[],this._setCurrentUser(),this.state=this._getState(),this._pickedIdentity.value=this._convertIdentityRefToPickerIdentity(this._owner);const t=this.props.pageContext?this.props.pageContext.getService("ISourceProviderService"):void 0;this._sourceProvider=t?t.getSourceProvider(h.RepositoryTypes.TfsVersionControl):void 0,this._fetchShelvesets()}render(){if(this.props.pageContext){const e=new p.PeoplePickerProvider(this.props.pageContext,{options:{MinResults:5,MaxResults:20}});return a.createElement(m.Dialog,{className:"shelveset-dialog",titleProps:{text:N.ShelvesetPickerDialogTitle},footerButtonProps:[{text:N.OkButtonText,primary:!0,onClick:this._onClickOk,disabled:!this.state.selectedShelvesetName},{text:N.CancelButtonText,onClick:this._onDismiss}],onDismiss:this._onDismiss,showCloseButton:!0},a.createElement("div",{className:"group-add-peoplepicker"},a.createElement(S.IdentityPickerDropdown,{pickerProvider:e,onChange:this._onPeoplePickerChange,value:this._pickedIdentity}),this.state.shelvesets&&this.state.shelvesets.length>0&&a.createElement(u.Card,null,a.createElement("div",{style:{display:"flex",height:"300px"}},a.createElement(g.ScrollableList,{itemProvider:new v.ArrayItemProvider(this.state.shelvesets),renderRow:this._renderRow,onSelect:this._onSelectionChanged,selection:this._listSelection,width:"100%"})))))}return a.createElement("div",null)}_convertIdentityRefToPickerIdentity(e){if(e)return{subjectDescriptor:e.descriptor,displayName:e.displayName,localId:e.id,signInAddress:e.uniqueName,isHosted:!0,entityType:""}}_convertPickerIdentityToIdentityRef(e){if(e)return{descriptor:e.subjectDescriptor,displayName:e.displayName,id:e.localId,uniqueName:e.signInAddress}}}}(),function(e){M=t.ComponentsTfvcSourceSelector={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsTfvcSourceSelector.TfvcSourceSelector=class extends a.Component{constructor(e){super(e),this._showShelvesetPickerDialog=!1,this._findShelveset=(()=>{this._showShelvesetPickerDialog=!0,this.setState(this._getState())}),this._closeShelvesetPickerDialog=(e=>{this._showShelvesetPickerDialog=!1,this.setState(this._getState())}),this._actionHub=e.actionHub?e.actionHub:new A.ShelvesetPickerActionHub,this.state=this._getState()}render(){return a.createElement("div",{className:"tfvc-source-selector"},a.createElement("div",null,a.createElement(_.FormItem,{label:N.SourceVersionTextboxTitle},a.createElement(C.TextField,{value:this.props.sourceVersion,onChange:(e,t)=>{this.props.onVersionSelected&&this.props.onVersionSelected(t)}}))),this.props.actionHub&&a.createElement("div",{className:"shelveset-selector-container"},a.createElement("div",{className:"shelveset-name"},a.createElement(_.FormItem,{label:N.ShelvesetTextboxTitle},a.createElement(C.TextField,{value:this.props.shelvesetName,onChange:(e,t)=>{this.props.onShelvesetSelected&&this.props.onShelvesetSelected(t)}}))),a.createElement("div",{className:"shelveset-picker-button"},a.createElement(f.Button,{iconProps:{iconName:"More"},onClick:this._findShelveset,ariaLabel:N.MoreOptions,tooltipProps:{text:N.OpenShelvesetPickerTooltip}})),this.state.showShelvesetPickerDialog&&a.createElement(U.ShelvesetPickerDialog,{pageContext:this.props.pageContext,project:this.props.projectId,actionHub:this._actionHub})))}componentDidMount(){this._actionHub.pickerDismissed.addListener(this._closeShelvesetPickerDialog)}componentWillUnmount(){this._actionHub.pickerDismissed.removeListener(this._closeShelvesetPickerDialog)}_getState(){return{showShelvesetPickerDialog:this._showShelvesetPickerDialog}}}}(),function(e){W=t[e]={},Object.defineProperty(t,"__esModule",{value:!0});const s="refs/heads/",o="refs/tags/";t[e].branchDropdownComboBoxInputSelector=".ms-ComboBox-Input";const r="branchDropdown",n="branchDropdown--combobox";t[e].BranchDropdown=class extends y.VssComponent{constructor(e,t){super(e,t),this._externalSourcesComboBoxRef=a.createRef(),this._showBranchPickerForCommit=new i.ObservableValue(!1),this._getExternalSourceProvider=(()=>a.createElement("div",null,a.createElement(w.Observer,{selectedRef:this._selectedExternalRef},e=>a.createElement(P.ComboBox,{className:n,label:this.props.label,ariaLabel:this.props.ariaLabel,options:this._getComboBoxBranches(),autoComplete:!0,allowFreeform:!0,onChanged:this._onBranchOptionSelected,onMenuOpen:this._onComboBoxOpen,componentRef:this._externalSourcesComboBoxRef&&this._externalSourcesComboBoxRef.current,text:this._getFriendlyName(e.selectedRef)})),this.props.description&&a.createElement("span",{className:"branch-dropdown-description body-s secondary-text"},this.props.description),this.props.viewCommits&&a.createElement(_.FormItem,{className:"branchDropdown--textbox",label:N.CommitsLabel},a.createElement(C.TextField,{value:this.props.currentCommit,onChange:(e,t)=>{this.props.onVersionSelected&&this.props.onVersionSelected(t)},disabled:!1})))),this._getWrappedVersionDropdown=((e,t,i,s,o)=>a.createElement(y.WrappedComponent,{wrappedType:"ms.vss-code-web.version-dropdown-as-textfield",dependencies:["ms.vss-code-web.version-dropdown"],wrappedProps:{ariaLabelledBy:o,focusTreatment:0,initiallySelectedVersion:{version:this.props.defaultBranch,versionOptions:0,versionType:0},isDropdownFullWidth:this.props.isDrodownFullWidth,onSelect:e,providerOptions:{repository:t,viewCommitsPivot:i,viewMyBranches:!0,viewTagsPivot:s}}})),this._onVersionSelected=((e,t)=>{if(!t.data||!t.data.versionDescriptor)return;const i=t.data.versionDescriptor.version,s=t.data.versionDescriptor.versionType;let o=!1;this.props.onBranchSelected&&0===s?this.props.onBranchSelected(i):this.props.onTagSelected&&1===s?this.props.onTagSelected(i):this.props.onVersionSelected&&2===s&&(this.props.onVersionSelected(i),o=!0),this.props.showBranchPickerOnCommitSelected&&this._updateShowBranchPickerForCommit(o)}),this._updateShowBranchPickerForCommit=(e=>{this._showBranchPickerForCommit.value!==e&&(e&&this.props.onBranchSelectedForCommit&&this.props.onBranchSelectedForCommit(this.props.defaultBranch),this._showBranchPickerForCommit.value=e)}),this._onBranchSelectedForCommit=((e,t)=>{t.data&&t.data.versionDescriptor&&this.props.onBranchSelectedForCommit&&this.props.onBranchSelectedForCommit(t.data.versionDescriptor.version)}),this._getFriendlyName=(e=>e.startsWith(s)?e.substr(s.length):e.startsWith(o)?e.substr(o.length):e),this._onBranchOptionSelected=((e,t,i)=>{const s=e?e.text:i;s&&(s.startsWith(o)&&this.props.onTagSelected?this.props.onTagSelected(s):this.props.onBranchSelected&&this.props.onBranchSelected(s),this._selectedExternalRef.value=s)}),this._onComboBoxOpen=(()=>{if(!this.props.comboBoxMaxWidth)return;const e=document.querySelector(".ms-Callout.ms-ComboBox-callout");e&&(e.style.minWidth=this.props.comboBoxMaxWidth+"px")}),this.state={branches:[]},this._repoIsTfsGit?this._repository=new i.ObservableValue(void 0):this._repoIsExternal&&(this._selectedExternalRef=new i.ObservableValue(this.props.defaultBranch))}componentDidMount(){super.componentDidMount(),this._repoIsExternal&&!this._repoIsSvn&&0==this.state.branches.length?this._getBranches():this._repoIsTfsGit&&this._fetchTfsGitRepo(),this._resizeLegacyComboBox(),this.props.autoFocus&&this._externalSourcesComboBoxRef&&this._externalSourcesComboBoxRef.current&&this._externalSourcesComboBoxRef.current.focus()}render(){return a.createElement("div",{className:k.css(this.props.className,r)},this._repoIsTfsGit?this._renderVersionDropdown():this._repoIsTfvc?a.createElement("div",null,a.createElement(M.TfvcSourceSelector,{pageContext:this.props.pageContext,projectId:this.props.projectId,label:this.props.label,onVersionSelected:this.props.onVersionSelected,onShelvesetSelected:this.props.onShelvesetSelected,actionHub:this.props.actionHub,sourceVersion:this.props.sourceVersion,shelvesetName:this.props.shelvesetName})):this._getExternalSourceProvider())}componentDidUpdate(e,t){super.componentDidUpdate(e,t),e.defaultBranch!==this.props.defaultBranch&&this._resizeLegacyComboBox()}get _repoIsTfsGit(){return this.props.repositoryType.toLocaleLowerCase()===h.RepositoryTypes.TfsGit.toLocaleLowerCase()}get _repoIsTfvc(){return this.props.repositoryType.toLocaleLowerCase()===h.RepositoryTypes.TfsVersionControl.toLocaleLowerCase()}get _repoIsSvn(){return this.props.repositoryType.toLocaleLowerCase()===h.RepositoryTypes.Svn.toLocaleLowerCase()}get _repoIsExternal(){return!this._repoIsTfsGit&&!this._repoIsTfvc}_renderVersionDropdown(){return a.createElement(a.Fragment,null,this.props.label&&a.createElement("label",{className:"ms-label branchDropdown--label",id:k.getSafeId("branch-dropdown")},this.props.label),a.createElement(w.Observer,{repository:this._repository},e=>e.repository?a.createElement(a.Fragment,null,this._getWrappedVersionDropdown(this._onVersionSelected,e.repository,this.props.viewCommits||!1,this.props.viewTags||!1,"branch-dropdown"),this.props.description&&a.createElement("span",{className:"body-s margin-top-4 secondary-text"},this.props.description),a.createElement(x.ConditionalChildren,{renderChildren:this._showBranchPickerForCommit},a.createElement("div",{className:"flex-column flex-grow margin-top-16"},a.createElement("label",{className:"ms-label branchDropdown--label",id:k.getSafeId("branch-dropdown-for-commit")},N.BranchDropdownForCommitLabel),this._getWrappedVersionDropdown(this._onBranchSelectedForCommit,e.repository,!1,!1,"branch-dropdown-for-commit"),a.createElement("span",{className:"body-s margin-top-4 secondary-text"},N.PickBranchForCommitDescription)))):a.createElement(B.Spinner,null)))}_getComboBoxBranches(){return this.state.branches.map(e=>{const t=this._getFriendlyName(e);return{key:t,text:t}})}_getBranches(){const e={connectionId:this.props.connectionId,sourceProvider:this.props.repositoryType,repository:this.props.repositoryId},t=this.context.pageContext.getService("IVssContributionService");this.trackPromise(t.getDataAsync("ms.vss-build-web.git-branch-data-provider",e,!0)).promise.then(e=>{if(e)this.setState({branches:e.branches});else if(this.props.onError){const e=t.getDataProviderExceptions()["ms.vss-build-web.git-branch-data-provider"],i=e&&e.message||N.BranchesError;this.props.onError(i)}},e=>{if(this.props.onError){const t=e&&e.message||N.BranchesError;this.props.onError(t)}})}_resizeLegacyComboBox(){if(!this._repoIsExternal||!this.props.comboBoxMinWidth||!this.props.comboBoxMaxWidth)return;const i=document.querySelector(`.${r} .${n}`),s=i&&i.querySelector(t[e].branchDropdownComboBoxInputSelector);if(s){const e=52,t=this.props.comboBoxMinWidth,o=this.props.comboBoxMaxWidth;s.style.width="0";let r=s.scrollWidth;if(!r){const e=document.createElement("div");e.style.position="absolute",e.style.top="-10000px",e.style.left="-10000px",e.textContent=s.value,document.body.appendChild(e),r=e.offsetWidth||o,document.body.removeChild(e)}s.style.width="",r+=e;const n=Math.max(Math.min(r,o),t);i.style.width=n+"px"}}_fetchTfsGitRepo(){this.trackPromise(this._getVcCodeContribution()).promise.then(()=>{const e=this.context.pageContext.getRestClient("IGitRestClient"),t=d.isGuid(this.props.repositoryId)?void 0:this.props.projectId;e.getRepository(this.props.repositoryId,t).then(e=>{this._repository.value=e}).catch(()=>this.props.onError&&this.props.onError(N.FailedToLoadRepoErrorMessage))})}_getVcCodeContribution(){return this.context.pageContext.getService("IVssContributionService").getContributionAsync("ms.vss-code-web.common-content")}}}("ComponentsBranchDropdown"),function(e){t.ComponentsPipelineSettingsPanel={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsPipelineSettingsPanel.PipelineSettingsPanel=class extends y.VssComponent{constructor(e,t){super(e,t),this._isFirstTimeOpened=!0,this._onDismiss=(()=>{this.setState({modifiedSettings:Object.assign({},this.state.originalSettings),selectedConfigFileKey:this.state.originalSettings.yamlFilePath,selectedWitLinkingBranch:this._convertToBranchSelector(this.state.originalSettings.witLinkingBranchFilter),witLinkingEnabled:this.state.originalSettings.witLinkingEnabled}),this.props.onDismiss()}),this._onSave=(()=>{const e=this.state.originalSettings,t=Object.assign({},this.state.modifiedSettings);t.status===e.status&&delete t.status,t.yamlFilePath===e.yamlFilePath&&delete t.yamlFilePath,t.witLinkingEnabled===e.witLinkingEnabled&&delete t.witLinkingEnabled,t.witLinkingBranchFilter===e.witLinkingBranchFilter&&delete t.witLinkingBranchFilter,this.props.onSave(t)}),this._onStatusChanged=(e=>{this.setState({modifiedSettings:Object.assign(Object.assign({},this.state.modifiedSettings),{status:Number(e)})})}),this._onWitLinkToggle=(e=>{this.setState({modifiedSettings:Object.assign(Object.assign({},this.state.modifiedSettings),{witLinkingEnabled:e}),witLinkingEnabled:e})}),this._onYamlFileChanged=((e,t,i)=>{const s=e&&e.text||i;let o=e&&e.text?String(e.key):"";if(!o){o="__FreeFormTextKey__";const e=this.state.configFiles;let t=e[0];t.key!==o&&(t=this._toComboBoxOption(o,i),e.unshift(t)),t.text=i,this.setState({configFiles:e})}this.setState({modifiedSettings:Object.assign(Object.assign({},this.state.modifiedSettings),{yamlFilePath:s}),selectedConfigFileKey:o})}),this._onWitLinkingBranchChange=(e=>{const t=this._convertToBranchFilter(e);this.setState({modifiedSettings:Object.assign(Object.assign({},this.state.modifiedSettings),{witLinkingBranchFilter:t}),selectedWitLinkingBranch:e})}),this._isWitLinkingEnabled=(e=>{if(e.options)for(const t of e.options)if(d.equals(t.definition.id,E.BuildOptionGUIDs.WitLinkingOptionGUID,!0))return t.enabled;return!1}),this._getExistingWitLinkingFilter=(e=>{if(e.options)for(const t of e.options)if(d.equals(t.definition.id,E.BuildOptionGUIDs.WitLinkingOptionGUID)){const e=t.inputs.branchFilters;if(e){const t=JSON.parse(e);return t.length>0?t[0]:""}}return""}),this._convertToBranchFilter=(e=>"+refs/heads/"+e),this._convertToBranchSelector=(e=>e.replace("+refs/heads/",""));const i=this.props.definition.process,s={status:this.props.definition.queueStatus,yamlFilePath:i.yamlFilename,witLinkingEnabled:this._isWitLinkingEnabled(this.props.definition),witLinkingBranchFilter:this._getExistingWitLinkingFilter(this.props.definition)};this.state={originalSettings:s,modifiedSettings:Object.assign({},s),configFiles:this._toComboBoxOptions([s.yamlFilePath]),selectedConfigFileKey:s.yamlFilePath,witLinkingEnabled:s.witLinkingEnabled,selectedWitLinkingBranch:this._convertToBranchSelector(s.witLinkingBranchFilter)}}render(){const e=[{text:N.CancelButtonText,disabled:this.props.isSaving,onClick:this.props.onDismiss},{text:N.SaveButtonLabel,primary:!0,disabled:this.props.isSaving||!this._isDirty(),onClick:this._onSave}];return a.createElement("div",null,this.props.isOpen&&a.createElement(D.Panel,{titleProps:{text:N.PipelineSettingsPanelTitle,size:1},onDismiss:this._onDismiss,footerButtonProps:e},this._renderBody()))}_renderBody(){this._isFirstTimeOpened&&(this._getConfigFiles(),this._isFirstTimeOpened=!1);let e="";this.props.isYamlDirty&&this.state.modifiedSettings.yamlFilePath!==this.state.originalSettings.yamlFilePath&&(e=N.PipelineSettingsYamlDiscard);const t=this.props.definition.repository;return a.createElement("div",{className:"ci-designer-settings-panel-body flex-grow"},this.props.errorMessage&&a.createElement(T.MessageCard,{className:"error-message",severity:"Error"},this.props.errorMessage),a.createElement(L.RadioButtonGroup,{text:N.PipelineSettingsSubheaderStatus,selectedButtonId:String(this.state.modifiedSettings.status),onSelect:this._onStatusChanged},a.createElement(L.RadioButton,{id:String(0),text:N.PipelineSettingsStatusEnabled}),a.createElement(L.RadioButton,{id:String(1),text:N.PipelineSettingsStatusPaused}),a.createElement(L.RadioButton,{id:String(2),text:N.PipelineSettingsStatusDisabled})),a.createElement(P.ComboBox,{className:"yaml-file-path-input",allowFreeform:!0,label:N.PipelineSettingsYamlFilePath,options:this.state.configFiles,selectedKey:this.state.selectedConfigFileKey,errorMessage:e,onChanged:this._onYamlFileChanged}),d.equals(t.type,h.RepositoryTypes.TfsGit,!0)&&a.createElement(O.Checkbox,{className:"wit-linking-checkbox",label:N.AutoLinkWorkItemsOption,checked:this.state.witLinkingEnabled,onChange:(e,t)=>{this._onWitLinkToggle(t)}}),this.state.witLinkingEnabled&&a.createElement(W.BranchDropdown,{ariaLabel:N.BranchLabel,className:"wit-linking-dropdown",repositoryType:t.type,repositoryId:t.id,defaultBranch:this.state.selectedWitLinkingBranch,connectionId:t.properties&&t.properties.connectedServiceId,isDrodownFullWidth:!1,comboBoxMinWidth:120,comboBoxMaxWidth:350,onBranchSelected:this._onWitLinkingBranchChange}))}_getConfigFiles(){const e=this.props.definition,t={connectionId:e.repository.properties&&e.repository.properties.connectedServiceId,id:e.repository.id,name:e.repository.name,sourceProviderType:e.repository.type,defaultBranch:this.props.branch};this.context.pageContext.getService("IRepositoryService").getConfigFiles(t,I.ConfigFileType.Yaml).then(e=>{let t=e.files||[];const i=this.state.originalSettings.yamlFilePath||"",s=i.startsWith("/")?i:"/"+i;(t=t.filter(e=>e!==s)).unshift(i),this.setState({configFiles:this._toComboBoxOptions(t)})},e=>{const t=e&&e.message||N.PipelineSettingsYamlFetchError;this.props.onError(t)})}_toComboBoxOptions(e){return e.map(e=>this._toComboBoxOption(e,e))}_toComboBoxOption(e,t){return{key:e,text:t}}_isDirty(){return!F.shallowCompare(this.state.originalSettings,this.state.modifiedSettings)}}}(),function(e){t.StoresQueue={},Object.defineProperty(t,"__esModule",{value:!0});class i extends R.Store{constructor(e){super(),this._queues=[],this._queuesInitializing=!1,this._queuesUpdated=(e=>{this._queues=e,this.emitChanged()}),this._queueSelected=(e=>{let t;e&&(t={id:e.id,name:e.name},this._selectedQueue=t,this.emitChanged())}),this._actionHub=e.actionHub?e.actionHub:new o,this._actionCreator=new s({actionHub:this._actionHub,source:new V.QueueSource({pageContext:e.pageContext,project:e.project})}),this._actionHub.queuesUpdated.addListener(this._queuesUpdated),this._actionHub.queueSelected.addListener(this._queueSelected)}getQueues(){return this._queuesInitializing||(this._queuesInitializing=!0,this._actionCreator.fetchQueues()),this._queues.filter(e=>!e.pool||e.pool&&!e.pool.isLegacy)}getSelectedQueue(){return this._selectedQueue}getActionHub(){return this._actionHub}dispose(){this._actionHub.queuesUpdated.removeListener(this._queuesUpdated),this._actionHub.queueSelected.removeListener(this._queueSelected)}}t.StoresQueue.QueueStore=i,i.key="build-commands-queue-store";class s{constructor(e){this._source=e.source,this._actionHub=e.actionHub}fetchQueues(){this._source.getQueues().then(e=>{this._actionHub.queuesUpdated.invoke(e)})}selectQueue(e){this._actionHub.queueSelected.invoke(e)}}t.StoresQueue.QueueActionCreator=s;class o{constructor(){this._queuesUpdated=new n.Action,this._queueSelected=new n.Action}get queuesUpdated(){return this._queuesUpdated}get queueSelected(){return this._queueSelected}}t.StoresQueue.QueueActionHub=o}()},["Resources","ObservablePivotActionArray","PivotItemToTabProvider","Components/ShelvesetAction","Components/ShelvesetPickerDialog","Components/TfvcSourceSelector","Components/BranchDropdown","Components/PipelineSettingsPanel","Stores/Queue"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.common-library-legacy"}}));