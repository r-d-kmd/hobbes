"use strict";define("Build/Common/Library",["require","exports","react","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Layout","VSS/Core/Util/String","VSSUI/Icon","VSSUI/TooltipEx","VSSUI/VssPersona","VSS/Platform/Location","VSSUI/Button","Tfs/Platform/Page","VSS/Core/Observable","VSS/Platform/Identity","VSSUI/ButtonGroup","VSSUI/Link","VSSUI/Observer","VSSUI/Panel","VSSUI/Table","VSSUI/Status","Build/Flux/Action","VSS/Platform/Context","VSS/Platform/History","VSS/Features/SignalR/3rdParty/jquery.shimmed","Build/Flux/Sources/Contribution","Build/Flux/Store"],function(e,t,s,i,n,r,o,a,c,l,u,d,p,m,h,g,S,b,y,f,v,C,P,_,I,k){var R,D,B,x,N,w,T,L;R=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.AgentPool="Agent pool",t.Resources.ARIALabelCopyToClipboard="Copy to clipboard",t.Resources.AutoAuthorizeErrorMessage="An unspecified error occurred while attempting to authorize resources.",t.Resources.BranchLabelFormat="Branch {0}",t.Resources.BuildUIDeprecationMessage="In the next few days, we will update this view to our new multi-stage pipelines user experience.",t.Resources.ClosePanelButton="Close",t.Resources.CommitLabelFormat="Source version {0}",t.Resources.CopiedToClipboardText="Copied to clipboard",t.Resources.CopyToClipboardText="Copy to clipboard",t.Resources.DeleteRetentionLeases="Remove all",t.Resources.DeleteRetentionLeaseMessage="Delete retention lease",t.Resources.LearnMore="Learn more",t.Resources.LeaseOwnerColumnHeader="Retained by",t.Resources.OptInNow="Opt-in now",t.Resources.ProjectRetentionSettingsLink="View retention settings",t.Resources.RepoLabelFormat="Repository {0}",t.Resources.RetainedByBranchPolicyPrimaryText="Branch policy",t.Resources.RetainedByBranchPolicySecondaryText="On branch {0}",t.Resources.RetainedByPipelineRetentionPolicyPrimaryText="Pipeline retention settings",t.Resources.RetainedByPipelineRetentionPolicySecondaryText="Retained as recent run of this pipeline",t.Resources.RetainedByReleaseSecondaryText="Run artifact(s) used by release",t.Resources.RetainedByUserSecondaryText="Manually retained",t.Resources.RetentionLeasesPanelHeading="Run retention",t.Resources.RetentionPanelDescription="Why is this run being retained?",t.Resources.RetentionTableName="Retention leases",t.Resources.RunNotRetained="This run has not been actively retained.",t.Resources.Snooze="Snooze",t.Resources.StatusAbandoned="Abandoned",t.Resources.StatusCanceled="Canceled",t.Resources.StatusFailed="Failed",t.Resources.StatusQueued="Queued",t.Resources.StatusRunning="Running",t.Resources.StatusSkipped="Skipped",t.Resources.StatusSuccess="Success",t.Resources.StatusUnknown="No runs",t.Resources.StatusWaiting="Waiting",t.Resources.StatusWarning="Warning",t.Resources.UnresolvedUser="Unresolved user",t.Resources.SaveButtonLabel="Save",t.Resources.SourceVersionTextboxTitle="Source version",t.Resources.ConfigFileDataProviderErrorMessage="Error retrieving config files for repository {0}.",t.Resources.SavePipelineCommentDisable="Disable pipeline",t.Resources.SavePipelineCommentEnable="Enable pipeline",t.Resources.SavePipelineCommentEnableAutoLink="Updated automatic work item linking status to {0}",t.Resources.SavePipelineCommentPause="Pause pipeline",t.Resources.SavePipelineCommentUnknownStatus="Change pipeline processing status",t.Resources.SavePipelineCommentUpdateAutoLinkBranch="Updated automatic work item linking branch to {0}",t.Resources.SavePipelineCommentYamlFile="Change YAML file to {0}",t.Resources.SavePipelineErrorMessage="An unspecified error occurred while saving the pipeline.",t.Resources.VariableSecretMask="***********",function(e){t.Array={},Object.defineProperty(t,"__esModule",{value:!0});const s="";t.Array.subtract=function(e,t){if(e=e||[],t=t||[],[].includes)return e.filter(e=>!t.includes(e));{let i={},n=[];for(let e=0;e<t.length;e++)i[(t[e]||s)+s]=!0;for(let t=0;t<e.length;t++)i[(e[t]||s)+s]||n.push(e[t]);return n}},t.Array.intersect=function(e,t){return t=t||[],(e=e||[]).filter(e=>-1!==t.indexOf(e))}}(),function(e){t.ComponentsBranchLink={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsBranchLink.BranchLink=class extends n.VssComponent{constructor(e,t){super(e,t);const s=t.pageContext.getService("ISourceProviderService").getSourceProvider(e.repositoryType),i=s?s.getBranchText(e.branch):e.branch,n=s?s.getBranchIconName(e.branch):"OpenSource";this.state={branchIconName:n,branchLink:"#",branchName:i}}componentDidMount(){super.componentDidMount(),this._refreshStateData()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),e.repositoryId===this.props.repositoryId&&e.branch===this.props.branch||this._refreshStateData()}render(){const{excludeTabStop:e=!0,monospace:t,readonly:n}=this.props;let c="scroll-hidden flex-row flex-baseline branch-link";return t&&(c+=" monospaced-text"),!n&&this.state.branchLink?s.createElement(i.FPSLink,{className:c,excludeTabStop:e,href:this.state.branchLink,subtle:!0,ariaLabel:r.format(R.BranchLabelFormat,this.state.branchName)},s.createElement(a.Tooltip,{overflowOnly:!0},s.createElement("span",{className:"text-ellipsis"},s.createElement(o.Icon,{iconName:this.state.branchIconName,className:"pipelines-icon-right-margin"}),this.state.branchName))):this.state.branchName?(c+=" pipelines-icon-left-margin pipeline-link",s.createElement("div",{className:c},s.createElement(a.Tooltip,{overflowOnly:!0},s.createElement("span",{className:"text-ellipsis","aria-label":r.format(R.BranchLabelFormat,this.state.branchName)},s.createElement(o.Icon,{iconName:this.state.branchIconName,className:"pipelines-icon-right-margin"}),this.state.branchName)))):s.createElement("span",null)}_refreshStateData(){const e=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(this.props.repositoryType),t=e?e.getBranchText(this.props.branch):this.props.branch,s=e?e.getBranchIconName(this.props.branch):"OpenSource";!this.props.readonly&&e?this.trackPromise(this.props.projectNamePromise||e.getProjectName(this.props.repositoryId)).promise.then(t=>this.trackPromise(e.fetchBranchLink({branchName:this.props.branch,repositoryName:this.props.repositoryName||this.props.repositoryId,repositoryUrl:this.props.repositoryUrl,links:{}},t||void 0)).promise).then(e=>{this.setState({branchIconName:s,branchLink:e,branchName:t})},e=>{e.isCanceled||console.log(e)}):this.setState({branchIconName:s,branchLink:"#",branchName:t})}}}(),function(e){D=t.ComponentsBuildPersona={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsBuildPersona.BuildPersona=class extends n.VssComponent{constructor(e,t){super(e,t),this._getFallbackImageUrl=(e=>{if(!this.props.displayName)return e>=40?l.getAssetLocation(this.context.pageContext,"ms.vss-build-web/common-library/default-user-avatar-large.svg"):l.getAssetLocation(this.context.pageContext,"ms.vss-build-web/common-library/default-user-avatar-small.svg")}),this._onImageError=(()=>{this.props.imageUrl&&this.setState({unloadableImageUrls:this.state.unloadableImageUrls.add(this.props.imageUrl)})}),this.state={unloadableImageUrls:e.unloadableImageUrls||new Set}}render(){return s.createElement(c.VssPersona,{size:this.props.size,cssClass:this.props.cssClass,identityDetailsProvider:{getIdentityImageUrl:e=>!this.props.imageUrl||this.state.unloadableImageUrls.has(this.props.imageUrl)?this._getFallbackImageUrl(e):this.props.imageUrl,getDisplayName:()=>this.props.displayName?this.props.displayName:R.UnresolvedUser},onImageError:this._onImageError})}}}(),function(e){t.ComponentsCommandComponent={},Object.defineProperty(t,"__esModule",{value:!0});const i=["ms.vss-distributedtask-web.common-library","ms.vss-build-web.common-commands"];t.ComponentsCommandComponent.CommandComponent=class extends s.Component{render(){return s.createElement(n.WrappedComponent,Object.assign({dependencies:i,wrappedType:this.props.commandType},this.props))}},t.ComponentsCommandComponent.prefetch=function(e){const t=e.getService("IVssContributionService");t.getContributionAsync("ms.vss-build-web.queue-panel"),t.getContributionAsync("ms.vss-build-web.common-commands"),t.getContributionAsync("ms.vss-build-web.common-library-legacy"),t.getContributionAsync("ms.vss-distributedtask-web.common-library")}}(),function(e){t.ComponentsCommitLink={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsCommitLink.CommitLink=class extends n.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(this.props.repositoryType),i=s?s.getCommitText(this.props.commitId):"";this.state={commitLink:"#",commitText:i}}componentDidMount(){super.componentDidMount(),this._refreshStateData()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),e.repositoryId===this.props.repositoryId&&e.commitId===this.props.commitId||this._refreshStateData()}render(){const{excludeTabStop:e=!0,monospace:t,readonly:n}=this.props;let a="scroll-hidden flex-row flex-baseline";return t&&(a+=" monospaced-text"),!n&&this.state.commitLink?s.createElement(i.FPSLink,{className:a,excludeTabStop:e,href:this.state.commitLink,subtle:!0,ariaLabel:r.format(R.CommitLabelFormat,this.state.commitText)},s.createElement("span",{className:"text-ellipsis"},!1!==this.props.showIcon&&s.createElement(o.Icon,{iconName:"BranchCommit",className:"pipelines-icon-right-margin"}),this.state.commitText)):this.state.commitText?(a+=" bolt-table-link bolt-table-inline-link pipeline-link",s.createElement("div",{className:a},s.createElement("span",{className:"text-ellipsis","aria-label":r.format(R.CommitLabelFormat,this.state.commitText)},!1!==this.props.showIcon&&s.createElement(o.Icon,{iconName:"BranchCommit",className:"pipelines-icon-right-margin"}),this.state.commitText))):s.createElement("span",null)}_refreshStateData(){const e=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(this.props.repositoryType),t=e?e.getCommitText(this.props.commitId):"";!this.props.readonly&&e?this.trackPromise(this.props.projectNamePromise||e.getProjectName(this.props.repositoryId)).promise.then(t=>this.trackPromise(e.fetchCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,commitId:this.props.commitId,displayUri:""},t||void 0)).promise).then(e=>{this.setState({commitLink:e,commitText:t})},e=>{e.isCanceled||console.log(e)}):this.setState({commitLink:"#",commitText:t})}}}(),function(e){t.ComponentsRepoLink={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsRepoLink.RepoLink=class extends n.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=s.getSourceProvider(this.props.sourceRepositoryType),!1!==e.includeIcon&&(this._repoIconName=this._sourceProvider?this._sourceProvider.getRepoIconName():""),this.state={repoLink:""}}componentDidMount(){super.componentDidMount(),this._sourceProvider&&this.trackPromise(this._sourceProvider.getProjectName(this.props.sourceRepositoryId)).promise.then(e=>this.trackPromise(this._sourceProvider.fetchRepositoryLink({repositoryName:this.props.sourceRepositoryName||this.props.sourceRepositoryId,repositoryUrl:this.props.sourceRepositoryUrl,repositoryId:this.props.sourceRepositoryId},e||void 0)).promise).then(e=>{this.setState({repoLink:e})},e=>{e.isCanceled||console.log(e)})}render(){const e=this.props.sourceRepositoryName||this.props.sourceRepositoryId;return e?s.createElement(i.FPSLink,{className:"scroll-hidden flex-row flex-baseline",href:this.state.repoLink,subtle:!0,ariaLabel:r.format(R.RepoLabelFormat,e)},s.createElement("span",{className:"text-ellipsis "},!1!==this.props.includeIcon&&s.createElement(o.Icon,{iconName:this._repoIconName,className:"pipelines-icon-right-margin"}),e)):s.createElement("span",null)}}}(),function(e){t.ComponentsCopyToClipboardButton={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsCopyToClipboardButton.CopyToClipboardButton=class extends s.Component{constructor(e){super(e),this._buttonWrapper=s.createRef(),this._onShowCopyClicked=(e=>{this.setState({isCalloutVisible:!0});const t=this.props.textToCopy();if(window.clipboardData)return window.clipboardData.setData("text",t),void(this.props.onClickStopPropagation&&e.stopPropagation());const s=e=>{e.clipboardData&&(e.clipboardData.setData("text",t),e.preventDefault())};document.addEventListener("copy",s),document.execCommand("copy"),document.removeEventListener("copy",s),this.props.onClickStopPropagation&&e.stopPropagation()}),this._onCalloutDismiss=(()=>{this.setState({isCalloutVisible:!1})}),this.state={isCalloutVisible:!1}}render(){return s.createElement("div",{ref:this._buttonWrapper,className:this.props.className},this._getRenderContents())}_getRenderContents(){return this.state.isCalloutVisible?this._getButton(R.CopiedToClipboardText):this._getButton(R.CopyToClipboardText)}_getButton(e){return s.createElement(u.Button,{subtle:!0,ariaLabel:R.ARIALabelCopyToClipboard,iconProps:{iconName:"Copy"},onClick:this._onShowCopyClicked,onBlur:this._onCalloutDismiss,tooltipProps:{showOnFocus:!0,text:e}})}}}(),function(e){B=t.Identity={},Object.defineProperty(t,"__esModule",{value:!0}),t.Identity.getAvatarUrl=function(e){let t="";return e&&(t=(t=e&&e._links&&e._links.avatar&&e._links.avatar.href)||e.imageUrl||""),t}}(),function(e){t.ComponentsRetentionPanel={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsRetentionPanel.RetentionPanel=class extends n.VssComponent{constructor(e,t){super(e,t),this._renderOwnerCell=((e,t,n,l)=>{let u,d=l.ownerDisplayName,p=R.RetainedByUserSecondaryText;if(r.equals(l.leaseType,f,!0)&&l.leaseOwnerIdentityRef){let e=l.leaseOwnerIdentityRef;u=s.createElement(D.BuildPersona,{size:"medium",displayName:e.displayName,imageUrl:this._getAvatarUrl(e)})}else r.equals(l.leaseType,i,!0)?(u=s.createElement(o.Icon,{className:"lease-owner-icon",iconName:"OpenSource",size:"medium"}),d=R.RetainedByBranchPolicyPrimaryText,p=r.format(R.RetainedByBranchPolicySecondaryText,l.ownerDisplayName)):r.equals(l.leaseType,c,!0)?(u=s.createElement(o.Icon,{className:"lease-owner-icon",iconName:"Rocket",size:"medium"}),p=R.RetainedByReleaseSecondaryText):r.equals(l.leaseType,v,!0)?(u=s.createElement(o.Icon,{className:"lease-owner-icon",iconName:"Build",size:"medium"}),d=R.RetainedByPipelineRetentionPolicyPrimaryText,p=R.RetainedByPipelineRetentionPolicySecondaryText):u=s.createElement(o.Icon,{className:"lease-owner-icon",iconName:"Contact",size:"medium"});const m=s.createElement("span",{className:"padding-right-8"},u),h=s.createElement(a.Tooltip,{overflowOnly:!0,text:d},s.createElement("span",{className:"text-ellipsis"},d)),g=s.createElement("span",{className:"font-size secondary-text"},p);return s.createElement(y.TwoLineTableCell,{columnIndex:t,iconProps:{render:()=>m},key:"col-"+t+" row-"+e,line1:h,line2:s.createElement("span",{className:"font-size secondary-text"},g)})}),this._renderValidUntilCell=((e,t,i,n)=>{let r=n.validUntil.toLocaleDateString();return s.createElement(y.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"scroll-hidden"},s.createElement("span",{className:"flex-row scroll-hidden"},r))}),this._renderDeleteCell=((e,t,i,n)=>s.createElement(y.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"scroll-hidden"},s.createElement(u.Button,{ariaLabel:R.DeleteRetentionLeaseMessage,className:"bolt-list-cell-content-reveal",disabled:!this.props.canDeleteLeases,iconProps:{iconName:"Delete"},onClick:e=>{this.props.onDelete([n.id]),e.preventDefault()},subtle:!0,tooltipProps:{text:R.DeleteRetentionLeaseMessage}}))),this._getAvatarUrl=(e=>{if(e){if(e.imageUrl)return e.imageUrl;const t=B.getAvatarUrl(e);if(t)return t;if(e.id)return m.getIdentityImageUrl(this.context.pageContext,e.id)}return""}),this._columns=[{id:"lease-owner",width:new p.ObservableValue(413),name:R.LeaseOwnerColumnHeader,renderCell:this._renderOwnerCell,columnStyle:2},{id:"delete-lease",width:new p.ObservableValue(51),renderCell:this._renderDeleteCell,columnStyle:1}];const n=d.getTFSPageData(this.context.pageContext);n&&n.project&&(this._projectId=n.project.id)}render(){return s.createElement(b.CustomPanel,{onDismiss:this.props.onDismiss},s.createElement(b.PanelHeader,{titleProps:{text:R.RetentionLeasesPanelHeading,size:1},description:R.RetentionPanelDescription,onDismiss:this.props.onDismiss}),s.createElement(b.PanelContent,{className:"no-padding"},s.createElement("div",{className:"custom-scrollbar flex-column flex-grow h-scroll-hidden"},s.createElement("div",{className:"h-scroll-hidden"},s.createElement(y.Table,{ariaLabel:R.RetentionTableName,columns:this._columns,itemProvider:this.props.retentionLeases,selectableText:!0,rowHeight:60})),s.createElement(S.Observer,{leases:this.props.retentionLeases},e=>0===e.leases.length?s.createElement("span",{className:"no-leases-span font-size-ms secondary-text"},R.RunNotRetained):null))),s.createElement(S.Observer,{leases:this.props.retentionLeases},e=>{const t=l.routeUrl(this.context.pageContext,"ms.vss-build-web.build-settings-route",{projectId:this._projectId});return s.createElement(b.PanelFooter,{className:"flex-row justify-space-between"},s.createElement(g.Link,{className:"a-link",href:t,target:"_blank"},R.ProjectRetentionSettingsLink),s.createElement(h.ButtonGroup,null,s.createElement(u.Button,{text:R.ClosePanelButton,onClick:this.props.onDismiss}),s.createElement(u.Button,{text:R.DeleteRetentionLeases,disabled:0===e.leases.length,onClick:()=>{let e=this.props.retentionLeases.value.map(e=>e.id);this.props.onDelete(e)},primary:!0})))}))}};const i="Branch",c="RM",f="User",v="Pipeline"}(),x=t.Constants={},Object.defineProperty(t,"__esModule",{value:!0}),(L=t.Constants.ProcessType||(t.Constants.ProcessType={})).Designer=1,L.Yaml=2,L.Docker=3,(T=t.Constants.NavConstants||(t.Constants.NavConstants={})).buildId="buildId",T.changeId="changeId",T.jobId="jobId",T.planId="planId",T.stepId="stepId",T.timelineId="timelineId",T.fullTimeline="fullTimeline",T.update="update",T.jobQueueData="jobQueueData",T.continuationToken="continuationToken",T.job="j",T.line="l",T.stage="s",T.task="t",T.view="view",T.logs="logs",T.artifacts="artifacts",T.treeState="treeState",T.imageUri="imageUri",T.type="type",T.alias="alias",T.tag="tag",T.consumedArtifacts="consumedArtifacts",T.publishedArtifacts="publishedArtifacts",T.stageName="stageName",(t.Constants.BuildOptionGUIDs||(t.Constants.BuildOptionGUIDs={})).WitLinkingOptionGUID="5d58cc01-7c75-450c-be18-a388ddb129ec",t.ContributedExtensiontypes={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){t.Duration={},Object.defineProperty(t,"__esModule",{value:!0}),t.Duration.getDurationStats=function(e){e=Math.abs(e);const t=Math.floor(e/1e3),s=Math.floor(t/60),i=Math.floor(s/60);return{days:Math.floor(i/24),hours:i%24,minutes:s%60,seconds:t%60}},t.Duration.padZeroes=function(e,t=2){let s=e+"";for(;s.length<t;)s="0"+s;return s}}(),function(e){var s;t.ErrorHandler={},Object.defineProperty(t,"__esModule",{value:!0}),s||(s={}),t.ErrorHandler.handleError=function(e){console.error(e),s.registeredHandler&&s.registeredHandler(e)},t.ErrorHandler.registerErrorHandler=function(e){s.registeredHandler=e}}(),function(e){N=t.SingletonManager={},Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this._objects={}}add(e,t){this._objects[e]=t}get(e){return this._objects[e]}remove(e){this._objects[e]&&this._objects[e].dispose(),delete this._objects[e]}dispose(){const e=this._objects||{};Object.keys(e).forEach(t=>{e[t].dispose()}),this._objects={}}}var i;t.SingletonManager.SingletonManager=s,t.SingletonManager.getSingletonManager=function(){return i||(i=new s),i}}(),function(e){w=t.PipelinesStateData={},Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this._treeData=""}get treeData(){return this._treeData}updateTreeData(e){this._treeData=e}dispose(){this._treeData=""}}t.PipelinesStateData.PipelinesStateData=s,s.key="PipelinesTreeStateDataStore"}(),function(e){function s(e){const t=e.getService("IVssHistoryService");let s=t.getState();delete s[x.NavConstants.treeState],t.replaceState(s),N.getSingletonManager().remove(w.PipelinesStateData.key)}function i(e,t){const s=e.getService("IVssHistoryService"),i=s.generateUrl({treeState:t});s.replaceState(void 0,i)}function n(e){const t=window.location.href;return t.lastIndexOf("_build")>=0||t.lastIndexOf("build-")>=0}function r(){return N.getSingletonManager().get(w.PipelinesStateData.key)}function o(){const e=new w.PipelinesStateData;return N.getSingletonManager().add(w.PipelinesStateData.key,e),e}t.StateHandler={},Object.defineProperty(t,"__esModule",{value:!0}),t.StateHandler.clearTreeState=s,t.StateHandler.updateTreeStateSettings=function(e,t){n(e)&&function(){let e=r();return e||(e=o()),e}().updateTreeData(t)},t.StateHandler.updateTreeStateUrl=i,t.StateHandler.getTreeState=function(e){let t="",n=r();return(t=e.getService("IVssHistoryService").getState()[x.NavConstants.treeState]||"")||n&&(t=n.treeData)&&i(e,t),n||t||s(e),n||o(),t},t.StateHandler.clearTreeStateOnUnmount=function(e){n(e)||s(e)}}(),function(e){var s;function i(e){e=(e=e||"").toLowerCase();const t={statusProps:f.Statuses.Queued,label:R.StatusUnknown};switch(e){case s.Cancelled:t.statusProps=f.Statuses.Canceled,t.label=R.StatusCanceled;break;case s.Failed:t.statusProps=f.Statuses.Failed,t.label=R.StatusFailed;break;case s.InProgress:t.statusProps=f.Statuses.Running,t.label=R.StatusRunning;break;case s.Pending:t.statusProps=f.Statuses.Queued,t.label=R.StatusWaiting;break;case s.Queued:t.statusProps=f.Statuses.Waiting,t.label=R.StatusQueued;break;case s.Skipped:t.statusProps=f.Statuses.Skipped,t.label=R.StatusSkipped;break;case s.Succeeded:t.statusProps=f.Statuses.Success,t.label=R.StatusSuccess;break;case s.Waiting:t.statusProps=f.Statuses.Waiting,t.label=R.StatusWaiting;break;case s.Warning:t.statusProps=f.Statuses.Warning,t.label=R.StatusWarning}return t}t.Indicator={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Cancelled="cancelled",e.Failed="failed",e.InProgress="inprogress",e.Pending="pending",e.Queued="queued",e.Skipped="skipped",e.Succeeded="succeeded",e.Unknown="unknown",e.Waiting="waiting",e.Warning="warning"}(s=t.Indicator.Status||(t.Indicator.Status={})),t.Indicator.getStatusIndicatorData=i,t.Indicator.getBuildStatusIndicatorData=function(e,t){let n=s.Unknown;switch(e){case 4:n=s.Cancelled;break;case 1:n=s.InProgress;break;case 32:case 8:n=s.Queued;break;case 2:switch(t){case 2:n=s.Succeeded;break;case 4:n=s.Warning;break;case 8:n=s.Failed;break;case 32:n=s.Cancelled}}return i(n)},t.Indicator.getTimelineStatusIndicatorData=function(e,t,n,r){let o=s.Unknown;switch(e){case 0:o=n?s.Waiting:r?s.Queued:s.Pending;break;case 1:o=s.InProgress;break;case 2:switch(t){case 0:o=s.Succeeded;break;case 1:o=s.Warning;break;case 2:o=s.Failed;break;case 3:o=s.Cancelled;break;case 4:o=s.Skipped;break;case 5:o=s.Cancelled}}return i(o)}}(),function(e){t.Navigation={},Object.defineProperty(t,"__esModule",{value:!0}),t.Navigation.openLinkSecurely=function(e,t=!1){const s=t?"_blank":"_self",i=window.open(e,s);i&&(i.opener=null)};t.Navigation.NavigationActionHub=class{constructor(){this._navigationChanged=new v.Action}get navigationChanged(){return this._navigationChanged}};C.Services.add("IBuildNavigationService",{serviceFactory:class extends C.VssService{constructor(){super(...arguments),this._onNavigate=(e=>{this._actionHub&&this._actionHub.navigationChanged.invoke(e)})}_serviceStart(e){super._serviceStart(e),this._historyService=this.pageContext.getService("IVssHistoryService"),this._historyService.subscribe(this._onNavigate,P.HistoryServiceEventNames.statePopped),this._linkingService=this.pageContext.getService("IBuildLinkingService")}_serviceEnd(e){super._serviceEnd(e),this._historyService&&this._historyService.unsubscribe(this._onNavigate,P.HistoryServiceEventNames.statePopped)}subscribeToNavigationChanges(e){this._actionHub=e}getCurrentState(){return this._historyService&&this._historyService.getState()||{}}getHistoryService(){return this._historyService}getLinkingService(){return this._linkingService}pushState(e){if(this._historyService){let t=this._historyService.getState();Object.keys(e).forEach(s=>{t[s]=e[s]}),this._historyService.pushState(t)}}}})}(),function(e){t.PipelinesL2Header={},Object.defineProperty(t,"__esModule",{value:!0});class s extends C.VssService{constructor(){super(...arguments),this.items=new p.ObservableArray}getBreadcrumbItems(e){return this.items.push({key:"Hub",text:"",priority:100,hidden:!0}),this.items}}t.PipelinesL2Header.PipelinesL2Header=s,C.Services.add("pipelines-l2-breadcrumb-service",{serviceFactory:s})}(),function(e){t.SignalRHubProxies={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.buildDetailHub="buildDetailHub"}(t.SignalRHubProxies.HubNames||(t.SignalRHubProxies.HubNames={})),t.SignalRHubProxies.getBuildProxyToRegister=function(e){const t=_.jqueryShimmed;return e.server={stopWatchingBuild:function(s,i){return e.invoke.apply(e,t.merge(["StopWatchingBuild"],t.makeArray(arguments)))},stopWatchingCollection:function(){return e.invoke.apply(e,t.merge(["StopWatchingCollection"],t.makeArray(arguments)))},stopWatchingProject:function(s){return e.invoke.apply(e,t.merge(["StopWatchingProject"],t.makeArray(arguments)))},watchBuild:function(s,i){return e.invoke.apply(e,t.merge(["WatchBuild"],t.makeArray(arguments)))},watchCollection:function(){return e.invoke.apply(e,t.merge(["WatchCollection"],t.makeArray(arguments)))},watchProject:function(s){return e.invoke.apply(e,t.merge(["WatchProject"],t.makeArray(arguments)))}},e}}(),function(e){t.PipelineResourcesService={},Object.defineProperty(t,"__esModule",{value:!0});const s="ms.vss-build-web.authorize-pipeline-resources-data-provider";C.Services.add("IPipelineResourcesService",{serviceFactory:class extends C.VssService{updateAuthorizedResource(e,t,s,i){const n=this.pageContext.getService("ITfsPageService").getData();let r="";n&&n.project&&(r=n.project.id);const o=[{authorized:i,id:s,type:t,name:""}];return this.pageContext.getRestClient("IBuildRestClient").authorizeDefinitionResources(o,r,e)}autoAuthorizeResources(e,t){const i={pipelineId:e,sourceBranch:t};return new Promise((e,t)=>{const n=this.pageContext.getService("IVssContributionService");n.getDataAsync(s,i,!0).then(i=>{if(i)e(i);else{const e=n.getDataProviderExceptions()[s],i=e&&e.message||R.AutoAuthorizeErrorMessage;t(new Error(i))}})})}}})}(),function(e){t.StoresPermissions={},Object.defineProperty(t,"__esModule",{value:!0});const s="_permissions",i="ms.vss-web.user-claims-data";t.StoresPermissions.PermissionsStore=class extends k.Store{constructor(e){super();const t=e.source?e.source:new I.ContributionSource({pageContext:e.pageContext});this._permissions=t.getSharedData(s)||{},this._claims=t.getData(i)||{}}hasPermission(e,t,s){if(this._permissions){const i=this._permissions[e];if(i){const n=i[t];return void 0===n&&console.warn("PermissionsStore: token "+t+", for namespace"+e+", has no permissions defined."),(s&n)>0}console.warn("PermissionsStore: namespace "+e+"has no permissions defined.")}return!1}hasClaim(e){return!(!this._claims||!this._claims[e])}}}(),function(e){var s,i,n;t.Security={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BuildNamespaceId="33344d9c-fc72-4d6f-aba5-fa317101a7e9"}(s=t.Security.Constants||(t.Security.Constants={})),function(e){e.ViewBuilds=1,e.EditBuildQuality=2,e.RetainIndefinitely=4,e.DeleteBuilds=8,e.ManageBuildQualities=16,e.DestroyBuilds=32,e.UpdateBuildInformation=64,e.QueueBuilds=128,e.ManageBuildQueue=256,e.StopBuilds=512,e.ViewBuildDefinition=1024,e.EditBuildDefinition=2048,e.DeleteBuildDefinition=4096,e.OverrideBuildCheckInValidation=8192,e.AdministerBuildPermissions=16384,e.AllPermissions=32767}(i=t.Security.BuildRequiredPermissions||(t.Security.BuildRequiredPermissions={})),function(e){e.Anonymous="anonymous",e.Public="public",e.Member="member"}(n=t.Security.UserClaims||(t.Security.UserClaims={}));const r="/",o="\\";class a{constructor(e){this._store=e.store,this._projectId=e.projectId}canEditDefinition(e){return this.hasDefinitionPermission(e,i.EditBuildDefinition)}canChangeBuild(e){return this.hasDefinitionPermission(e,i.EditBuildQuality)}canCancelBuild(e,t){const s=(t.requestedBy&&t.requestedBy.id||"").toLowerCase(),n=(t.requestedFor&&t.requestedFor.id||"").toLowerCase();return(e=e||e.toLowerCase())===s||e===n||this.hasDefinitionPermission(t.definition,i.StopBuilds)}canCancelBuildByUserId(e,t,s,n,r){const o=(r||"").toLowerCase(),a=(n||"").toLowerCase();return(e=e||e.toLowerCase())===o||e===a||this._hasDefinitionPermission(t,s,i.StopBuilds)}canDeleteBuild(e){return this.hasDefinitionPermission(e,i.DeleteBuilds)}canDeleteBuildByDefinitionId(e,t){return this._hasDefinitionPermission(e,t,i.DeleteBuilds)}canQueueBuild(e){return this.hasDefinitionPermission(e,i.QueueBuilds)}canQueueBuildById(e,t){return this._hasDefinitionPermission(e,t,i.QueueBuilds)}canEditTagsByUserId(e,t,s,n,r){const o=(r||"").toLowerCase(),a=(n||"").toLowerCase();return(e=e||e.toLowerCase())===o||e===a||this._hasDefinitionPermission(t,s,i.EditBuildQuality)}canRetainBuild(e){return this.hasDefinitionPermission(e,i.RetainIndefinitely)||this.hasDefinitionPermission(e,i.UpdateBuildInformation)}canRetainBuildByDefinitionId(e,t){return this._hasDefinitionPermission(e,t,i.RetainIndefinitely)||this._hasDefinitionPermission(e,t,i.UpdateBuildInformation)}hasDefinitionPermission(e,t){return this._store.hasPermission(s.BuildNamespaceId,a.getDefinitionSecurityToken(this._projectId,e),t)}hasFolderPermission(e,t){return this._store.hasPermission(s.BuildNamespaceId,a._getDefinitionFolderSecurityToken(this._projectId,e),t)}isAnonymousUser(){return this._store.hasClaim(n.Anonymous)}isPublicUser(){return this._store.hasClaim(n.Public)}isMember(){return this._store.hasClaim(n.Member)}static getDefinitionSecurityToken(e,t){return a._getDefinitionSecurityToken(e,t.id.toString(),t.path)}static getSecurityTokenPath(e){return(e=e.replace(/\\/g,r))[0]===r&&(e=e.slice(1,e.length)),e}_hasDefinitionPermission(e,t,i){return this._store.hasPermission(s.BuildNamespaceId,a._getDefinitionSecurityToken(this._projectId,e,t),i)}static _getDefinitionSecurityToken(e,t,s){let i=t;return s!==o&&(i=a.getSecurityTokenPath(s)+r+i),e+r+i}static _getDefinitionFolderSecurityToken(e,t){return t===o?e:e+r+a.getSecurityTokenPath(t)+r}}t.Security.Security=a}(),function(e){t.RepositoryService={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Yaml="yaml",e.Docker="docker"}(t.RepositoryService.ConfigFileType||(t.RepositoryService.ConfigFileType={}));C.Services.add("IRepositoryService",{serviceFactory:class extends C.VssService{getConfigFiles(e,t){const s={connectionId:e.connectionId,sourceProvider:e.sourceProviderType,repositoryId:e.id,repositoryName:e.name,configFileType:t,branch:e.defaultBranch};return this.getDataProviderResult("ms.vss-build-web.find-config-files-data-provider",e,s,R.ConfigFileDataProviderErrorMessage)}getDataProviderResult(e,t,s,i){const n=r.format(i,t.name||t.id),o=this.pageContext.getService("IVssContributionService");return o.getDataAsync(e,s,!0).then(t=>{if(t)return t;{const t=o.getDataProviderExceptions()[e],s=t&&t.message||n;throw new Error(s)}},e=>{throw new Error(e&&e.message||n)})}}})}(),function(e){t.SourcesBuild={},Object.defineProperty(t,"__esModule",{value:!0});const s=50;t.SourcesBuild.BuildSource=class{constructor(e){this._client=e.pageContext.getRestClient("IBuildRestClient"),this._project=e.project}getBuild(e){return this._client.getBuild(this._project,e)}getBuilds(e){return this._client.getBuilds(e.project||this._project,e.definitions,e.queues,e.buildNumber,e.minTime,e.maxTime,e.requestedFor,e.reasonFilter,e.statusFilter,e.resultFilter,e.tagFilters,e.properties,e.top||s,e.continuationToken,e.maxBuildsPerDefinition,e.deletedFilter,e.queryOrder,e.branchName,e.buildIds,e.repositoryId,e.repositoryType)}getClient(){return this._client}}}()},["Resources","Array","Components/BranchLink","Components/BuildPersona","Components/CommandComponent","Components/CommitLink","Components/RepoLink","Components/CopyToClipboardButton","Identity","Components/RetentionPanel","Constants","ContributedExtension.types","Duration","ErrorHandler","SingletonManager","PipelinesStateData","StateHandler","Indicator","Navigation","PipelinesL2Header","SignalRHubProxies","PipelineResourcesService","Stores/Permissions","Security","RepositoryService","Sources/Build"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.common-library"}}));