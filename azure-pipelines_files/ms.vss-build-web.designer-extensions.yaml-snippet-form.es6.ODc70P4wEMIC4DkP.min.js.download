"use strict";define("Build/DesignerExtensions/YamlSnippetForm",["require","exports","VSS/Core/Util/String","DistributedTask/Client/RestClient/TaskAgent","ServiceEndpoints/Client/RestClient/ServiceEndpoint","ServiceEndpoints/Client/Constants/ServiceEndpoint","Build/DesignerExtensions/YamlAssistantLibrary/Contracts/Constants","VSS/Platform/Util/Cookie","react","VSSUI/Util","VSSUI/Callout","VSSUI/Icon","VSS/Features/Markdown/MarkdownRendererComponent","VSSUI/Spinner","VSSUI/Button","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/Utilities/GroupedItemProvider","VSS/Core/Observable","VSSUI/FormItem","VSSUI/EditableDropdown","VSSUI/ListBox","VSS/Core/Util/Object","VSSUI/RadioButton","Pipelines/Common/Library/Contracts/Constants","VSSUI/Checkbox","VSSUI/TextField","Build/Flux/Store","DistributedTask/Common/AadAuthorizer/AadAuthorizer","Tfs/Platform/Page","VSS/Platform/Layout","markdown-it","VSSUI/Accordion","VSSUI/Link","VSSUI/FocusZone"],function(e,t,i,n,s,o,r,a,p,l,u,c,d,h,m,g,_,S,b,C,y,v,f,E,I,V,N,x,T,D,w,P,k,A,R){var z,M,O,L,B,j,F,G,U,q,K,W,H,Y;z=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.Authorize="Authorize",t.Resources.Authorizing="Authorizing...",t.Resources.Connecting="Connecting...",t.Resources.InvalidBooleanValue="Invalid boolean value: `{0}`, allowed empty, `true` or `false`",t.Resources.NeedsAuthorizing="This subscription requires authorization",t.Resources.AzureSubscriptionPanelTitle="Azure service connection",t.Resources.Connect="Connect",t.Resources.Cancel="Cancel",t.Resources.FailedToFindSnippet="Could not find task for {0}",t.Resources.FailedToFindServiceConnection="Failed to connect to {0}",t.Resources.AddSnippetYaml="Add",t.Resources.CancelSnippetYaml="Cancel",t.Resources.AzureConnectionGroupTitle="Service connections",t.Resources.AzureSubscriptionGroupTitle="Subscriptions",t.Resources.AzureConnectionsEmptyMessage="No subscription or service connection found",t.Resources.FailedToLoadSnippet="Error loading task: {0}",t.Resources.NoServiceConnections="No existing service connections of the appropriate type could be found",t.Resources.NoResultsFound="No results found",t.Resources.InformationButton="Information",t.Resources.NoAzureRMResults="No Azure service connections or subscriptions could be found",t.Resources.CreateRMTimeout="Timed out waiting for the service connection to be ready",t.Resources.TaskReference="About this task",t.Resources.UnsupportedSnippetMessage="The guide for this task is not yet supported, but you can add an outline for it.",t.Resources.AddSnippetOutlineYaml="Add outline",t.Resources.ProjectInfoNotFound="Could not find information for the project selected",t.Resources.ResourcesCannotBeCreated="Kubernetes resources cannot be created. Please review the template definition.",t.Resources.UnknownDatasourceError="Unknown datasource error",t.Resources.EndpointNotFound="The endpoint {0} cannot be found or has been deleted. Please retry the pipeline creation.",function(e){M=t.SourcesSnippetFormSource={},Object.defineProperty(t,"__esModule",{value:!0});t.SourcesSnippetFormSource.SnippetFormSource=class{constructor(e,t){this._sleepTimeAwaitingEndpoint=1e3,this._dtClient=n.getTaskAgentClient(e),this._serviceEndpointClient=s.getServiceEndpointClient(e),this._telemetryService=e.getService("IVssTelemetryService");const i=e.getService("ITfsPageService");this._projectId=i.getData().project.id,this._getInputType=t}async getAzureSubscriptions(){return this._dtClient.getAzureSubscriptions().then(e=>e.value)}async getServiceConnections(e){let t=void 0;if(e.indexOf(":")>0){let i=e.split(":");e=i[0],t=i[1].split(",")}return this._dtClient.getServiceEndpoints(this._projectId,e,t,void 0,void 0)}async createAzureRMConnection(e){this._telemetryService&&this._telemetryService.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.createAzureRM,{});const t={authorization:{parameters:{authenticationType:o.AzureEndpointConstants.spnKeyAuthType,tenantId:e.subscriptionTenantId},scheme:o.EndpointAuthorizationSchemes.ServicePrincipal},data:{creationMode:o.AzureEndpointConstants.SpnCreationModeAutomatic,environment:o.AzureEndpointConstants.DefaultAzureEnvironment,scopeLevel:o.AzureEndpointConstants.SubscriptionString,subscriptionId:e.subscriptionId,subscriptionName:e.displayName},type:r.AzureRMConnectionType,name:e.displayName+"("+e.subscriptionId+")"},i=await this._dtClient.createServiceEndpoint(t,this._projectId);return this._returnEndpointWhenReady(i.id)}async getDataSourceResources(e,t,n,s,o){r.InternalDataSources[e.type]?t=r.InternalDataSources[e.type]:i.isGuid(t)||(t=await this._findEndpointByName(t,this._getInputType&&this._getInputType(e.dataSourceDependency))||t);const a={dataSourceDetails:{dataSourceName:e.dataSourceBinding.dataSourceName,dataSourceUrl:e.dataSourceBinding.endpointUrl,headers:[],resourceUrl:"",resultSelector:e.dataSourceBinding.resultSelector,initialContextTemplate:e.dataSourceBinding.initialContextTemplate,parameters:Object.assign(Object.assign({},e.dataSourceBinding.parameters),s)},resultTransformationDetails:{resultTemplate:e.dataSourceBinding.resultTemplate,callbackContextTemplate:e.dataSourceBinding.callbackContextTemplate,callbackRequiredTemplate:e.dataSourceBinding.callbackRequiredTemplate},serviceEndpointDetails:n};e.dataSourceDependency&&(a.dataSourceDetails.parameters[e.dataSourceDependency]=t);let p=[];p=await this._getServiceEndpointResult(a,t,p,o);let l={};return p&&p.length>0&&p.forEach(e=>{try{const t=JSON.parse(e);t.DisplayValue&&t.Value?l[t.Value]=t.DisplayValue:t.id&&t.name?l[t.id]=t.name:l[e]=e}catch(t){l[e]=e}}),l}async _findEndpointByName(e,t){let i=await this._serviceEndpointClient.getServiceEndpointsByNames(this._projectId,[e],t);return i.length?(i.length>1&&this._telemetryService&&this._telemetryService.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.FindEndpointByName,{endpoints:i.map(e=>({id:e.id,name:e.name,description:e.description,isReady:e.isReady,groupScopeId:e.groupScopeId,type:e.type}))}),i[0].id):void(this._telemetryService&&this._telemetryService.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.FindEndpointByName,{endpoints:[]}))}async _getServiceEndpointResult(e,t,i,n){if(!n){const i=await this._serviceEndpointClient.executeServiceEndpointRequest(e,this._projectId,t),n=parseInt(i.statusCode);if(i.errorMessage&&404!==n)throw new Error(i.errorMessage);return i.result}const s=await this._serviceEndpointClient.executeServiceEndpointRequest(e,this._projectId,t);if(s.errorMessage){if(0==i.length)throw new Error(s.errorMessage)}else{const e=s.result;e&&e.length>0&&(i=i.concat(e))}return s.callbackRequired&&(Object.assign(e.dataSourceDetails.parameters,s.callbackContextParameters),i=await this._getServiceEndpointResult(e,t,i,n)),i}async _returnEndpointWhenReady(e){let t=await this._dtClient.getServiceEndpointDetails(this._projectId,e),i=0;for(;!t.isReady;){if(t.operationStatus&&"Failed"===t.operationStatus.state)throw new Error(t.operationStatus.statusMessage);if(i>=120)throw new Error(z.CreateRMTimeout);i++,await this._sleep(this._sleepTimeAwaitingEndpoint),t=await this._dtClient.getServiceEndpointDetails(this._projectId,e)}return t}async _sleep(e){return new Promise(t=>setTimeout(t,e))}_getDebugSubscriptions(){if(!this._debugSubscriptions){this._debugSubscriptions=[];for(let e=1;e<10;++e)this._debugSubscriptions.push({displayName:"sub "+e,subscriptionId:""+e,subscriptionTenantId:"tenant"+e,subscriptionTenantName:"tenant "+e})}return this._debugSubscriptions}_getDebugServiceConnections(){if(!this._debugServiceConnections){this._debugServiceConnections=[];for(let e=1;e<10;++e)this._debugServiceConnections.push({name:"sc "+e,id:"sc"+e})}return this._debugServiceConnections}}}(),function(e){O=t.UtilitiesVisibilityHelper={},Object.defineProperty(t,"__esModule",{value:!0});const n="&&",s="||";t.UtilitiesVisibilityHelper.VisibilityHelper=class{static getVisibility(e,t){const i=this._getVisibilityRule(e);if(!i)return!0;let s=i.operator===n;for(let e=0,n=i.predicateRules.length;e<n;e++){const n=i.predicateRules[e];if(!n)continue;let o=t(n.inputName);const r=this._getPredicateResult(n,o);s=this._evaluate(s,r,i.operator)}return s}static _getVisibilityRule(e){let t=null;if(e)if(-1!==e.indexOf(n)){let i=e.split(n).map(this._getPredicateRule);t={operator:n,predicateRules:i}}else if(-1!==e.indexOf(s)){let i=e.split(s).map(this._getPredicateRule);t={operator:s,predicateRules:i}}else t={operator:null,predicateRules:[this._getPredicateRule(e)]};return t}static _getPredicateRule(e){let t=null,i=/([a-zA-Z0-9 ]+)([!=<>]+)([a-zA-Z0-9. ]+)|([a-zA-Z0-9 ]+(?=NotContains|NotEndsWith|NotStartsWith))(NotContains|NotEndsWith|NotStartsWith)([a-zA-Z0-9. ]+)|([a-zA-Z0-9 ]+(?=Contains|EndsWith|StartsWith))(Contains|EndsWith|StartsWith)([a-zA-Z0-9. ]+)/g.exec(e);return i&&10===i.length&&(t=i[1]?{inputName:i[1].trim(),condition:i[2].trim(),expectedValue:i[3].trim()}:i[4]?{inputName:i[4].trim(),condition:i[5].trim(),expectedValue:i[6].trim()}:{inputName:i[7].trim(),condition:i[8].trim(),expectedValue:i[9].trim()}),t}static _getPredicateResult(e,t){let n=!1,s=t?t.toString().toLowerCase():t;if(e){let o=e.expectedValue?e.expectedValue.toString().toLowerCase():e.expectedValue;switch(e.condition){case"=":case"==":n=s===o;break;case"!=":n=s!==o;break;case"<":n=s<o;break;case">":n=s>o;break;case"<=":n=s<=o;break;case">=":n=s>=o;break;case"Contains":n=!!t&&t.indexOf(o)>=0;break;case"StartsWith":n=!!t&&i.startsWith(t,o,!0);break;case"EndsWith":n=!!t&&i.endsWith(t,o,!0);break;case"NotContains":n=!(t&&t.indexOf(o)>=0);break;case"NotStartsWith":n=!(t&&i.startsWith(t,o,!0));break;case"NotEndsWith":n=!(t&&i.endsWith(t,o,!0))}}return n}static _evaluate(e,t,i){return i===n?e&&t:i===s?e||t:null!==i||t}}}(),function(e){L=t.ComponentsEnhancedLabel={},Object.defineProperty(t,"__esModule",{value:!0});let i=1;t.ComponentsEnhancedLabel.EnhancedLabel=class extends p.Component{constructor(e){super(e),this._calloutId=`enhancedlabelcallout-${i++}`,this._showCallout=(e=>{this.setState({showCallout:!0,anchorElement:e.currentTarget})}),this._hideCallout=(()=>{this.setState({showCallout:!1})}),this._onClick=(e=>{this._blockCallout||this._showCallout(e)}),this._onKeypress=(e=>{13!==e.which&&32!==e.which||this._showCallout(e)}),this._onMouseDown=(e=>{this._blockCallout=this.state.showCallout}),this.state={showCallout:!1}}render(){return p.createElement("span",{className:l.css("enhancedlabel inline-flex-row",this.props.className)},p.createElement("span",{className:l.css(this.props.isRequired&&"enhancedlabel-required")},this.props.title),this.props.documentation&&p.createElement("span",{className:"enhancedlabel-documentation",tabIndex:0,onClick:this._onClick,onMouseDown:this._onMouseDown,onKeyPress:this._onKeypress,role:"button","aria-label":this.props.ariaLabel||z.InformationButton},p.createElement(c.Icon,{className:"no-padding",iconName:"Info"})),this.state.showCallout&&this.state.anchorElement&&p.createElement(u.Callout,{className:"enhancedlabel-documentation-callout",anchorElement:this.state.anchorElement,anchorOffset:{vertical:8,horizontal:8},anchorOrigin:{horizontal:"start",vertical:"end"},calloutOrigin:{horizontal:"center",vertical:"start"},id:this._calloutId,key:this._calloutId,role:"tooltip",onDismiss:this._hideCallout,blurDismiss:!0,escDismiss:!0,focuszoneProps:{focusOnMount:!0,defaultActiveElement:".enhancedlabel-documentation-callout-focusbox",circularNavigation:!0}},p.createElement("div",{className:"enhancedlabel-documentation-callout-focusbox",tabIndex:0},p.createElement(d.MarkdownRendererComponent,{className:"enhancedlabel-documentation-callout-content depth-16",rawContent:this.props.documentation,options:{breaks:!0,html:!0,hideExternalImageIcon:!0}}))))}}}(),function(e){B=t.ComponentsAzureSubscriptionPickList={},Object.defineProperty(t,"__esModule",{value:!0});const i="connections",n="subscriptions";t.ComponentsAzureSubscriptionPickList.AzureSubscriptionPickList=class extends p.PureComponent{constructor(e){super(e),this._error=new b.ObservableValue(!1),this._message=new b.ObservableValue(void 0),this._selection=new _.DropdownSelection,this._itemProvider=new S.GroupedItemProvider([],[{id:i,loading:!0,name:z.AzureConnectionGroupTitle},{id:n,loading:!0,name:z.AzureSubscriptionGroupTitle}],!0),this._onSelectionChanged=((e,t)=>{t.groupId===n?(this._error.value=!1,this._message.value=z.NeedsAuthorizing,this.setState({authorizing:!1,needAuthorizing:!0})):t.groupId===i&&(this._error.value=!1,this._message.value=void 0,this.props.onValueChanged(this.props.inputDefinition.name,t.id,t.text),this.setState({authorizing:!1,needAuthorizing:!1}))}),this._onAuthorize=(async()=>{try{if(!this._selection.selectedCount)return Promise.resolve(void 0);const e=this._itemProvider.value[this._selection.value[0].beginIndex];if(!e.data)return Promise.resolve(void 0);const t=e.data;this.setState({authorizing:!0});let n=Object.assign({},t),s=this._getSubscriptionDisplayName(n),o=1;const r=this._itemProvider.value.filter(e=>e.groupId===i).map(e=>e.text);for(;r.indexOf(s)>=0;)n.displayName=t.displayName+"("+o+")",s=this._getSubscriptionDisplayName(n),o++;const a=await this.props.serviceConnectionProvider.createAzureRMConnection(n);this._itemProvider.push({id:a.id,text:a.name,groupId:i,data:a}),this._selection.select(this._itemProvider.value.findIndex(e=>e.id===a.id)),this.props.onValueChanged(this.props.inputDefinition.name,a.id,a.name),this._error.value=!1,this._message.value=void 0,this.setState({authorizing:!1,needAuthorizing:!1})}catch(e){this._error.value=!0,this._message.value=e.message,this.setState({authorizing:!1}),this.props.onError("AzureSubscriptionPickList._onAuthorize",e)}}),this._initiallySelectedName=this.props.getValue(this.props.inputDefinition.name),this.state={authorizing:!1,needAuthorizing:!1}}render(){const e=this.state.needAuthorizing,t=this.state.authorizing?z.Authorizing:z.Authorize,i=this.state.authorizing,n=this.props.inputDefinition;return p.createElement("div",{className:"flex-column"},p.createElement(C.FormItem,{message:this._message,error:this._error,label:p.createElement(L.EnhancedLabel,{title:n.label,isRequired:n.required,documentation:n.helpMarkdown})},p.createElement(g.Dropdown,{noItemsText:z.NoAzureRMResults,items:this._itemProvider,selection:this._selection,onSelect:this._onSelectionChanged})),e&&p.createElement(m.Button,{className:"authorize-button flex-self-start",onClick:this._onAuthorize,primary:!0,disabled:this.state.authorizing},i&&p.createElement(h.Spinner,{size:"small"}),t))}componentDidMount(){this._loadSubscriptions()}async _loadSubscriptions(){try{const e=this.props.serviceConnectionProvider.getAzureSubscriptions(),t=this.props.serviceConnectionProvider.getServiceConnections(r.AzureRMConnectionType),i=await e,n=await t;this._buildConnectionOptions(i,n)}catch(e){this._error.value=!0,this._message.value=e.message,this.props.onError("AzureSubscriptionPickList._loadSubscriptions",e)}}_buildConnectionOptions(e,t){let s=t.map(e=>({id:e.id,text:e.name,groupId:i,data:e}));this._initiallySelectedName&&!s.find(e=>e.text===this._initiallySelectedName)&&s.push({id:this._initiallySelectedName,text:this._initiallySelectedName,groupId:i,data:void 0}),s.sort((e,t)=>e.text.localeCompare(t.text));let o=e.map(e=>({id:e.subscriptionId,text:this._getSubscriptionDisplayName(e),groupId:n,data:e}));o.sort((e,t)=>e.text.localeCompare(t.text)),this._itemProvider.removeAll(),s&&(this._itemProvider.pushGroups({id:i,name:z.AzureConnectionGroupTitle}),this._itemProvider.push(...s)),o&&(this._itemProvider.pushGroups({id:n,name:z.AzureSubscriptionGroupTitle}),this._itemProvider.push(...o)),this._initiallySelectedName&&this._selection.select(this._itemProvider.value.findIndex(e=>e.text===this._initiallySelectedName||e.id===this._initiallySelectedName))}_getSubscriptionDisplayName(e){return e.displayName+"("+e.subscriptionId+")"}}}(),function(e){j=t.ComponentsEnhancedDropdown={},Object.defineProperty(t,"__esModule",{value:!0});function i(e){if(e){if(e.MultiSelectFlatList&&"true"===e.MultiSelectFlatList.toLowerCase())return!0;if(e.MultiSelect&&"true"===e.MultiSelect.toLowerCase())return!0}return!1}function n(e){return!(!e||!e.EditableOptions||"true"!==e.EditableOptions.toLowerCase())}t.ComponentsEnhancedDropdown.EnhancedDropdown=class extends p.PureComponent{constructor(e){if(super(e),this._items=new b.ObservableArray,this._message=new b.ObservableValue(void 0),this._error=new b.ObservableValue(!1),this._loadingItem={id:"loading",type:4,render:(e,t,i,n)=>p.createElement(v.LoadingCell,{key:e,columnIndex:t,tableColumn:i,tableItem:n,onMount:this._onLoadingMount})},this._onSelect=(()=>{let e=[],t=[];for(let i=0;i<this._selection.value.length;i++){let n=this._selection.value[i].beginIndex,s=this._selection.value[i].endIndex;for(let i=n;i<=s;i++)e.push(this._items.value[i].id),t.push(this._items.value[i].text)}this._onValueChangeInternal(e.join(", "),t.join(", "))}),this._onValueChange=(e=>{if(e){const t=this._items.value.find(t=>t.id===e.id);t?this._onValueChangeInternal(t.id,t.text||t.id):this._onValueChangeInternal(e.id,e.id)}}),this._onLoadingMount=(async()=>{try{this._items.value=await this.props.loadItems(),this._error.value=!1,this._message.value=void 0,this._selection.clear(),this._initialValues&&(this._allowMultiselection?this._initialValues.split(","):[this._initialValues]).forEach(e=>{e=e.trim(),this._items.value.find(t=>t.text===e||t.id===e)||this._items.push({id:e,text:e})});const e=this.props.getValue(this.props.inputDefinition.name);e&&(this._allowMultiselection?e.split(","):[e]).forEach(e=>{e=e.trim();const t=this._items.value.findIndex(t=>t.text===e||t.id===e);t>=0&&this._selection.select(t)})}catch(e){this._items.value=[],this._error.value=!0,this._message.value=e.message,this._selection.clear(),this.props.onError&&this.props.onError(this.props.errorContext||"",e)}}),this._onExpand=(()=>{this.props.loadItems&&(this._error.value||this.props.alwaysRefresh)&&(this._items.removeAll(),this._items.push(this._loadingItem))}),this._allowMultiselection=i(e.inputDefinition.properties),this._editable=n(e.inputDefinition.properties),this._allowMultiselection&&(this._editable=!1),this._selection=this._allowMultiselection&&new _.DropdownMultiSelection||new _.DropdownSelection,this._initialValues=e.getValue(e.inputDefinition.name),e.loadItems)this._items.push(this._loadingItem);else{let t=Object.keys(e.inputDefinition.options).map(t=>({id:t,text:e.inputDefinition.options[t]})),i=e.getValue(this.props.inputDefinition.name);""!==i?(this._allowMultiselection?i.split(","):[i]).forEach(e=>{e=e.trim(),void 0===t.find(t=>t.id===e)&&t.push({id:e,text:e});const i=t.findIndex(t=>t.id===e);i>=0&&this._selection.select(i)}):this.props.inputDefinition.defaultValue,this._items.change(0,...t)}}render(){const e=this.props.inputDefinition,t={noItemsText:z.NoResultsFound,items:this._items,selection:this._selection,onExpand:this._onExpand,placeholder:this.props.loadItems&&this._initialValues};return p.createElement(C.FormItem,{message:this._message,error:this._error,label:p.createElement(L.EnhancedLabel,{title:e.label,isRequired:e.required,documentation:e.helpMarkdown})},this._editable&&p.createElement(y.EditableDropdown,Object.assign({},t,{allowFreeform:!0,onValueChange:this._onValueChange})),!this._editable&&p.createElement(g.Dropdown,Object.assign({},t,{onSelect:this._onSelect})))}componentDidMount(){this.props.loadOnMount&&this.props.loadItems&&this._onLoadingMount()}_onValueChangeInternal(e,t){this.props.onValueChanged(this.props.inputDefinition.name,e,this.props.useValueAliases&&t||void 0)}},t.ComponentsEnhancedDropdown.allowsMultiSelect=i,t.ComponentsEnhancedDropdown.allowEditable=n}(),function(e){F=t.ComponentsDataSourcePickList={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsDataSourcePickList.DataSourcePickList=class extends p.Component{constructor(){super(...arguments),this._loadItems=(async()=>{const e=this.props.getValue(this.props.inputDefinition.dataSourceDependency),t=this._getParameters(),i=e+Object.keys(t).map(e=>t[e]);return i===this._lastCheckedDependencies&&this._cachedPromise?this._cachedPromise:(this._lastCheckedDependencies=i,this._cachedPromise=this._loadItemsInternal(e,t),this._cachedPromise)}),this._loadItemsInternal=(async(e,t)=>{const i=await this.props.serviceConnectionProvider.getDataSourceResources(this.props.inputDefinition,e,this.props.serviceEndpointDetails,t,this.props.makeRecursiveDatasourceCalls);let n=[];return Object.keys(i).forEach(e=>{n.push({id:e,text:i[e]})}),n.sort((e,t)=>e.text.localeCompare(t.text)),n})}render(){return p.createElement(j.EnhancedDropdown,{inputDefinition:this.props.inputDefinition,onValueChanged:this.props.onValueChanged,getValue:this.props.getValue,loadItems:this._loadItems,loadOnMount:this.props.preloadItems,alwaysRefresh:!0,onError:this.props.onError,errorContext:"DataSourcePickList"})}_getParameters(){const e=this._extractDependentParametersFromUrl(this.props.inputDefinition.dataSourceBinding.endpointUrl),t=Object.assign(Object.assign({},e),this.props.inputDefinition.dataSourceBinding.parameters);return Object.keys(t).forEach(e=>{let i=t[e];0===i.indexOf("$(")&&(i=this.props.getValue(i.substr(2,i.length-3))),t[e]=i}),t}_extractDependentParametersFromUrl(e){if(e){const t={};for(;;){const i=e.indexOf("$(");if(i<0)break;const n=(e=e.substr(i)).substr(0,e.indexOf(")")+1);t[n.substr(2,n.length-3)]=n,e=e.substr(n.length)}return t}return{}}}}(),function(e){G=t.ComponentsRadioGroup={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsRadioGroup.RadioGroup=class extends p.Component{constructor(e){super(e),this._onChange=(e=>{this.props.onValueChanged(this.props.inputDefinition.name,e)}),this._groupId=f.getId("yaml-snippet-panel-radiogroup"),this._initialValue=e.getValue(e.inputDefinition.name)}render(){let e=this.props.getValue(this.props.inputDefinition.name),t=this.props.direction?this.props.direction:2;return p.createElement("div",{className:"flex-column"},p.createElement(C.FormItem,{label:p.createElement(L.EnhancedLabel,{title:this.props.inputDefinition.label,isRequired:this.props.inputDefinition.required,documentation:this.props.inputDefinition.helpMarkdown})},p.createElement(E.RadioButtonGroup,{className:l.css(this.props.inputDefinition.required&&"required"),selectedButtonId:e,onSelect:this._onChange,id:this._groupId,direction:t},this._radioButtons())))}_radioButtons(){let e=[];return Object.keys(this.props.inputDefinition.options).forEach(t=>{e.push(p.createElement(E.RadioButton,{key:t,id:t,text:this.props.inputDefinition.options[t]}))}),this.props.inputDefinition.options[this._initialValue]||e.push(p.createElement(E.RadioButton,{key:this._initialValue,id:this._initialValue,text:this._initialValue})),e}}}(),function(e){U=t.ComponentsServiceConnectionPickList={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsServiceConnectionPickList.ServiceConnectionPickList=class extends p.Component{constructor(){super(...arguments),this._loadConnections=(async()=>{const e=await this.props.serviceConnectionProvider.getServiceConnections(this.props.connectionType);let t=[];return e.forEach(e=>{t.push({id:e.id,text:e.name})}),t.sort((e,t)=>e.text.localeCompare(t.text)),t})}render(){return p.createElement(j.EnhancedDropdown,{inputDefinition:this.props.inputDefinition,onValueChanged:this.props.onValueChanged,getValue:this.props.getValue,useValueAliases:!0,loadItems:this._loadConnections,loadOnMount:!0,onError:this.props.onError,errorContext:"ServiceConnectionPickList"})}}}(),function(e){q=t.ComponentsSnippetInput={},Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentsSnippetInput.unsupportedInputs=function(e){const t=[];return e.forEach(e=>{e.type===I.InputTypes.BOOL||e.type===I.InputTypes.STRING||e.type===I.InputTypes.PICKLIST||e.type===I.InputTypes.RADIO||e.type===I.InputTypes.INT||e.type===I.InputTypes.MULTILINE||0===e.type.indexOf(r.DataSourcePrefix)||0===e.type.indexOf(r.ConnectedServicePrefix)||r.InternalDataSources[e.type]||t.push(e.type)}),t};t.ComponentsSnippetInput.SnippetInput=class extends p.Component{render(){if(!this.props.isVisible)return null;const e=this.props.snippetInput,t=this.props.getValue(e.name);switch(e.type){case I.InputTypes.BOOL:{const n=t===e.defaultValue||"true"===t||"false"===t;let s=e.helpMarkdown;return n||(s=`> ${i.format(z.InvalidBooleanValue,t)}\n\n${s}`),p.createElement("span",{className:"inline-flex-row flex-center"},p.createElement(V.Checkbox,{className:l.css(e.required&&"required","yaml-snippet-checkbox"),label:e.label,checked:"true"===t,disabled:!n,onChange:(t,i)=>this.props.onValueChanged(e.name,i?"true":"false")}),p.createElement(L.EnhancedLabel,{title:"",isRequired:e.required,documentation:s}))}case I.InputTypes.FILEPATH:case I.InputTypes.STRING:case I.InputTypes.INT:return p.createElement(C.FormItem,{label:p.createElement(L.EnhancedLabel,{title:e.label,isRequired:e.required,documentation:e.helpMarkdown})},p.createElement(N.TextField,{value:t,onChange:(t,i)=>this.props.onValueChanged(e.name,i)}));case I.InputTypes.MULTILINE:return p.createElement(C.FormItem,{label:p.createElement(L.EnhancedLabel,{title:e.label,isRequired:e.required,documentation:e.helpMarkdown})},p.createElement(N.TextField,{className:"snippet-multiline",value:t,multiline:!0,autoAdjustHeight:!0,rows:3,onChange:(t,i)=>this.props.onValueChanged(e.name,i)}));case I.InputTypes.PICKLIST:return p.createElement(j.EnhancedDropdown,{inputDefinition:this.props.snippetInput,getValue:this.props.getValue,onValueChanged:this.props.onValueChanged});case I.InputTypes.RADIO:return p.createElement(G.RadioGroup,{inputDefinition:e,onValueChanged:this.props.onValueChanged,getValue:this.props.getValue})}if(0===e.type.indexOf(r.DataSourcePrefix)||r.InternalDataSources[e.type])return p.createElement(F.DataSourcePickList,{inputDefinition:e,serviceConnectionProvider:this.props.serviceConnectionProvider,onValueChanged:this.props.onValueChanged,getValue:this.props.getValue,onError:this.props.onError});if(0===e.type.indexOf(r.ConnectedServicePrefix)){const t=e.type.substr(r.ConnectedServicePrefix.length).toLowerCase();switch(t){case r.AzureRMConnectionType:return p.createElement(B.AzureSubscriptionPickList,{inputDefinition:e,serviceConnectionProvider:this.props.serviceConnectionProvider,getValue:this.props.getValue,onValueChanged:this.props.onValueChanged,onError:this.props.onError});default:return p.createElement(U.ServiceConnectionPickList,{inputDefinition:e,connectionType:t,serviceConnectionProvider:this.props.serviceConnectionProvider,getValue:this.props.getValue,onValueChanged:this.props.onValueChanged,onError:this.props.onError})}}return p.createElement(C.FormItem,{label:p.createElement(L.EnhancedLabel,{title:e.label,isRequired:e.required,documentation:e.helpMarkdown})},p.createElement(N.TextField,{value:t,onChange:(t,i)=>this.props.onValueChanged(e.name,i)}))}}}(),function(e){K=t.ComponentsSnippetInputGroup={},Object.defineProperty(t,"__esModule",{value:!0});class i extends p.Component{render(){return p.createElement("div",{className:l.css("snippet-input-group flex-column",this.props.className)},this.props.inputs.map(e=>p.createElement(q.SnippetInput,{key:e.name,snippetInput:e,isVisible:this.props.inputValueProvider.isVisible(e.name),onValueChanged:this.props.inputValueProvider.setValue,getValue:this.props.inputValueProvider.getValue,serviceConnectionProvider:this.props.serviceConnectionProvider,onError:this.props.onError})))}}t.ComponentsSnippetInputGroup.SnippetInputList=i;class n{constructor(e,t,i,n,s,o,r){this.groupKey=e,this.groupTitle=t,this.isCollapsed=i,this.inputs=n,this.inputValueProvider=s,this.serviceConnectionProvider=o,this.onError=r}get key(){return this.groupKey}get title(){return this.groupTitle}onRenderContent(){return p.createElement(i,{inputs:this.inputs,inputValueProvider:this.inputValueProvider,serviceConnectionProvider:this.serviceConnectionProvider,onError:this.onError})}}t.ComponentsSnippetInputGroup.SnippetInputGroup=n,t.ComponentsSnippetInputGroup.getSnippetInputGroups=function(e,t,i,s,o,r){const a=[];return t.forEach(t=>{a.push(new n(t.name,t.displayName,i(t.name),e[t.name],s,o,r))}),a}}(),function(e){W=t.StoresSnippetFormStore={},Object.defineProperty(t,"__esModule",{value:!0});t.StoresSnippetFormStore.SnippetFormStore=class extends x.Store{constructor(){super(...arguments),this._inputsByGroup={},this._groupCollapsedState={},this._inputsByName={},this._inputValues={},this._inputValueAliases={},this._inputVisibility={},this._groupVisibility={},this.getValuesForExport=(()=>{let e={};return this._snippet.inputs.forEach(t=>{this._snippet.includeInputs.some(e=>e===t.name)?e[t.name]=t.defaultValue:t.required&&this._inputVisibility[t.name]&&t.defaultValue&&(t.groupName===r.UnparentedInputsGroupName||this._groupVisibility[t.groupName])&&(e[t.name]=t.defaultValue)}),Object.keys(this._inputValues).forEach(t=>{void 0!==this._inputValueAliases[t]&&this._inputValueAliases[t]!==this._inputsByName[t].defaultValue?e[t]=this._inputValueAliases[t]:void 0!==this._inputValues[t]&&this._inputValues[t]!==this._inputsByName[t].defaultValue&&(e[t]=this._inputValues[t])}),Object.keys(this._inputVisibility).forEach(t=>{this._inputVisibility[t]||delete e[t]}),e}),this.setValue=((e,t,i)=>{this._inputValues[e]=t,i&&(this._inputValueAliases[e]=i),this._updateVisibilityMaps(),this.emitChanged()}),this.getValue=(e=>this._inputVisibility[e]?void 0!==this._inputValues[e]?this._inputValues[e]:this._inputsByName[e]&&this._inputsByName[e].defaultValue||"":""),this.isVisible=(e=>this._inputVisibility[e]),this.isGroupVisible=(e=>this._groupVisibility[e]),this.isGroupCollapsed=(e=>this._groupCollapsedState[e]),this.toggleGroup=((e,t)=>{const i=this._groupCollapsedState[t.key].value;this._groupCollapsedState[t.key].value=!i}),this.getInputType=(e=>{const t=this._inputsByName[e].type;return t.indexOf(":")>=0?t.split(":").pop():t})}loadSnippet(e,t){this._snippet=e,this._inputsByGroup={},this._inputsByName={},this._organizeInputs(),t&&this._loadStartingParameters(t),this._updateVisibilityMaps(),this._findInitiallyExpandedGroups(),this._unsupportedInputs=q.unsupportedInputs(Object.keys(this._inputsByName).map(e=>this._inputsByName[e])),this.emitChanged()}get visibleGroups(){return this._snippet.groups.filter(e=>this._groupVisibility[e.name]&&this._inputsByGroup[e.name]&&this._inputsByGroup[e.name].length>0)}get snippet(){return this._snippet}get inputsByGroup(){return this._inputsByGroup}get isSnippetSupported(){return 0===this._unsupportedInputs.length}get unsupporedInputTypes(){return this._unsupportedInputs}hasInputType(e){let t,i=!1;if(e.indexOf("prop:")>=0){const i=e.split(" ");t=i.find(e=>e.indexOf("prop:")>=0).substr(5),e=e.replace("prop:"+t,"").trim()}return Object.keys(this._inputsByName).forEach(n=>{const s=this._inputsByName[n];s.type===e&&(t?s.properties&&s.properties[t]&&"true"===s.properties[t].toLowerCase()&&(i=!0):i=!0)}),i}_organizeInputs(){this._snippet.inputs.forEach(e=>{this._inputsByGroup[e.groupName]||(this._inputsByGroup[e.groupName]=[]),this._inputsByGroup[e.groupName].push(e),this._inputsByName[e.name]=e})}_updateVisibilityMaps(){this._snippet.inputs.forEach(e=>{this._inputVisibility[e.name]=O.VisibilityHelper.getVisibility(e.visibleRule,this.getValue)}),this._snippet.groups.forEach(e=>{const t=this._inputsByGroup[e.name]||[];0===t.filter(e=>this._inputVisibility[e.name]).length?this._groupVisibility[e.name]=!1:(this._groupVisibility[e.name]=O.VisibilityHelper.getVisibility(e.visibleRule,this.getValue),this._groupVisibility[e.name]||t.forEach(e=>{this._inputVisibility[e.name]=!1}))})}_findInitiallyExpandedGroups(){this._snippet.groups.forEach(e=>{let t=!1;t=!1===e.isExpanded||e.displayName.trim().toLowerCase().indexOf("advanced")>=0,this._groupCollapsedState[e.name]=new b.ObservableValue(t)})}_loadStartingParameters(e){Object.keys(e).forEach(t=>{let i=void 0;this._inputsByName[t]?i=this._inputsByName[t]:this._snippet.inputs.forEach(e=>{e.aliases.indexOf(t)>=0&&(i=e)});const n=e[t];i&&null!=n&&(this._inputValues[i.name]=n.toString())})}}}(),function(e){var o,r;H=t.UtilitiesEndpointHelper={},Object.defineProperty(t,"__esModule",{value:!0});class a{}t.UtilitiesEndpointHelper.EndpointConstants=a,a.AuthSchemes=((o=class{}).docker="Docker",o.kubernetes="Kubernetes",o.servicePrincipal="serviceprincipal",o),a.EndpointTypes=((r=class{}).docker="dockerregistry",r.kubernetes="Kubernetes",r.azureRM="azurerm",r),a.azureEnvironment="AzureCloud",a.azureManagementUrl="https://management.azure.com/";class p{static _getClusterNameFromClusterId(e){let t="";if(e){const i=e.split("/"),n=i.findIndex(e=>"managedClusters"===e)+1;n>0&&(t=i[n])}return t}static async getAuthorizationToken(e,t){const i=n.getTaskAgentClient(e),s=await i.getVstsAadTenantId();if(t&&s&&s.toLocaleLowerCase()!=t.subscriptionAccount.subscriptionTenantId.toLocaleLowerCase()){const i=new T.AadAuthorizer(e),n=D.getTFSPageData(e);if(n&&n.project){return await i.getAccessTokenKey(n.project,t.subscriptionAccount.subscriptionTenantId,s)}}}static getAzureRMServiceEndpointDetails(e,t,i){if(!t)return{};let n={accessTokenType:"AppToken",tenantId:t.subscriptionAccount.subscriptionTenantId};return i&&(n.accessToken=i,n.accessTokenFetchingMethod=1..toString()),{authorization:{parameters:n,scheme:a.AuthSchemes.servicePrincipal},data:{subscriptionId:t.id,subscriptionName:t.displayName,environment:a.azureEnvironment,scopeLevel:"subscription"},type:a.EndpointTypes.azureRM,url:a.azureManagementUrl}}static getEndpointStatus(e,t){const n=D.getTFSPageData(t);if(n&&n.project){const o=n.project.name;return new Promise((n,r)=>{let a=!1,p={state:"InProgress",statusMessage:""};function l(t){r(JSON.stringify({endpointId:e,error:t}))}let u=setTimeout(function r(){a||s.getServiceEndpointClient(t).getServiceEndpointDetails(o,e).then(t=>{null===t&&(clearTimeout(u),a=!0,l(i.format(z.EndpointNotFound,e))),t.operationStatus&&(p=t.operationStatus),t.isReady?(clearTimeout(u),a=!0,n(p.state)):"Failed"===p.state?(clearTimeout(u),a=!0,l(p.statusMessage)):"InProgress"===p.state&&(u=setTimeout(r,2e3))},e=>{clearTimeout(u),a=!0,l(e)})},2e3)})}return Promise.reject(z.ProjectInfoNotFound)}static generateAuxillaryResourcesForEndpoints(e,t,i){let n={};const s=t.k8sConnection,o=e.filter(e=>"environmentresource:kubernetes"===e.type.toLocaleLowerCase());if(o.length>0){if(!s)return Promise.reject(z.ResourcesCannotBeCreated);for(let e=0;e<o.length;e++){const t={name:s.Data.namespace,namespace:s.Data.namespace,clusterName:p._getClusterNameFromClusterId(s.Data.clusterId),serviceEndpointId:s.Id,tags:[]};n[o[e].name]={resourcetocreate:t,type:o[e].type}}n.environment={resourcetocreate:{name:i.repositoryName,description:`CI/CD setup from this repo: '${i.repositoryName}'`},type:"environment"}}return Promise.resolve(n)}}t.UtilitiesEndpointHelper.EndpointHelper=p}(),function(e){Y=t.UtilitiesYamlExport={},Object.defineProperty(t,"__esModule",{value:!0});const i="\r\n",n="  ",s="    ",o="      ",r="|\n";t.UtilitiesYamlExport.exportYaml=async function(e,t,a){return Boolean(t.content)?function(e,t,i){const n=e.getService("IVssContributionService"),s={templateParameters:Object.assign(Object.assign({},i),{templateId:t.id}),validateAssets:!1,branch:"",connectionId:"",repositoryId:"",sourceProviderType:""};return n.getDataAsync("ms.vss-build-web.customized-template-data-provider",s).then(e=>e&&e.content||"")}(e,t,a):function(e,t){let a="- task: "+e.name+"@"+e.version.major+i;return e.inputs.length>0&&(a+=n+"inputs:"+i),e.inputs.forEach(e=>{let n=t[e.name];if(void 0!==n){e.type!==I.InputTypes.BOOL&&e.type!==I.InputTypes.INT&&""!==n&&(n=(n=n.trim()).indexOf("\n")>0?(n=r+n).split("\n").join(i+o):"'"+n.replace(/'/g,"''")+"'");const t=e.aliases&&e.aliases.length>0&&e.aliases[0]||e.name;a+=s+t+": "+n+i}}),a}(t,a)}}(),function(e){t.ComponentsAzureContainerRegistryPicker={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsAzureContainerRegistryPicker.AzureContainerRegistryPicker=class extends w.VssComponent{constructor(e,t){super(e,t),this.getValue=(e=>"subscriptionId"===e&&this.props.subscription&&this.props.subscription.id?"0":""),this._createServiceEndpointObject=((e,t)=>{let i=JSON.parse(t.replace(/'/g,'"')),n=this.getRegistryNameFromRegistryId(i.id),s={data:{registrytype:"ACR",registryId:i.id,subscriptionId:this.props.subscription?this.props.subscription.id:"",subscriptionName:this.props.subscription?this.props.subscription.displayName:""},name:n,type:H.EndpointConstants.EndpointTypes.docker,url:`https://${i.loginServer}`,authorization:{scheme:H.EndpointConstants.AuthSchemes.servicePrincipal,parameters:{tenantId:this.props.subscription?this.props.subscription.subscriptionAccount.subscriptionTenantId:"",servicePrincipalId:"<placeholder>",scope:i.id,loginServer:i.loginServer}}};this.props.onAllValuesReceived(s)}),this.state={registryUrl:""},this._source=new M.SnippetFormSource(this.context.pageContext)}render(){let e={dataSourceBinding:{dataSourceName:"AzureRMContainerRegistries",resultTemplate:"{ \"Value\": \"{'id':'{{id}}', 'name':'{{name}}' , 'loginServer': '{{ properties.loginServer}}'}\", \"DisplayValue\" : \"{{name}}\" }",parameters:{}},dataSourceDependency:"subscriptionId",label:"Container registry",name:"containerRegistry"};const{className:t}=this.props;return p.createElement("div",{className:w.css("section",t)},p.createElement(F.DataSourcePickList,{inputDefinition:e,serviceConnectionProvider:this._source,onValueChanged:this._createServiceEndpointObject,getValue:this.getValue,onError:this.props.onError,preloadItems:!0,serviceEndpointDetails:H.EndpointHelper.getAzureRMServiceEndpointDetails(this.context.pageContext,this.props.subscription,this.props.endpointToken)}))}componentDidMount(){super.componentDidMount()}getRegistryNameFromRegistryId(e){let t="";if(e){let i=e.split("/"),n=i.findIndex(e=>"registries"===e)+1;n>0&&(t=i[n])}return t}}}(),function(e){t.ComponentsAzureKubernetesEndpointInput={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsAzureKubernetesEndpointInput.AzureKubernetesEndpointInput=class extends w.VssComponent{constructor(e,t){super(e,t),this.onValueChanged=((e,t)=>{if("clusterName"===e){const e=JSON.parse(t.replace(/'/g,'"'));this.setState({clusterId:e.id,fqdn:`https://${e.fqdn}`,clusterName:e.name,namespace:""})}else"namespace"===e?this.setState(Object.assign(Object.assign({},this.state),{namespace:t.toLowerCase()}),()=>{this.props.onAllValuesReceived(this._createServiceEndpointObject())}):"createNewNamespace"===e&&this.setState(Object.assign(Object.assign({},this.state),{createNewNamespace:t,namespace:""}))}),this.getValue=(e=>{switch(e){case"createNewNamespace":return this.state.createNewNamespace;case"namespace":return this.state.namespace;case"subscriptionId":return this.props.subscription&&this.props.subscription.id?"0":"";case"clusterName":return this.state.clusterName?this.state.clusterName:"";default:return""}}),this._getKubernetesServiceEndpointDetails=(()=>{if(this.props.subscription){let e=void 0;return e={authorization:{parameters:{azureEnvironment:H.EndpointConstants.azureEnvironment,azureTenantId:this.props.subscription.subscriptionAccount.subscriptionTenantId},scheme:H.EndpointConstants.AuthSchemes.kubernetes},data:{authorizationType:"AzureSubscription",azureSubscriptionId:this.props.subscription.id,azureSubscriptionName:this.props.subscription.displayName,clusterId:this.state.clusterId},type:H.EndpointConstants.EndpointTypes.kubernetes,url:this.state.fqdn}}}),this._createServiceEndpointObject=(()=>{if(this.props.subscription){const e={azureEnvironment:"AzureCloud",azureTenantId:this.props.subscription.subscriptionAccount.subscriptionTenantId};return this.props.endpointToken&&(e.azureAccessToken=this.props.endpointToken),{data:{authorizationType:"AzureSubscription",azureSubscriptionId:this.props.subscription.id,azureSubscriptionName:this.props.subscription.displayName,clusterId:this.state.clusterId,namespace:this.state.namespace,"operation.createOrReuseNamespace":this.state.createNewNamespace,clusterAdmin:this.props.clusterAdmin?"true":"false"},name:`${this.state.clusterName}-${this.state.namespace}`,type:"kubernetes",url:this.state.fqdn,authorization:{scheme:"Kubernetes",parameters:e}}}}),this._getRadioButtons=(()=>[p.createElement(E.RadioButton,{key:"true",className:"namespace-radio-button",id:"true",text:"New"}),p.createElement(E.RadioButton,{key:"false",className:"namespace-radio-button",id:"false",text:"Existing"})]),this.state={clusterId:"",namespace:"",fqdn:"",createNewNamespace:"false",clusterName:"",clusterAdmin:!1},this._source=new M.SnippetFormSource(this.context.pageContext)}render(){const e={dataSourceBinding:{dataSourceName:"AzureKubernetesClusters",resultTemplate:"{ \"Value\": \"{'id':'{{id}}', 'fqdn': '{{properties.fqdn}}', 'name': '{{name}}' }\", \"DisplayValue\" : \"{{name}}\" }",parameters:{}},dataSourceDependency:"subscriptionId",label:"Cluster",name:"clusterName"},t={dataSourceBinding:{dataSourceName:"KubernetesNamespaces",resultTemplate:'{ "Value" : "{{metadata.name}}", "DisplayValue" : "{{metadata.name}}" }',parameters:{}},dataSourceDependency:"clusterName",label:"",name:"namespace"};null!=this.props.clusterAdmin&&this.props.clusterAdmin!=this._clusterAdmin&&(this._clusterAdmin=this.props.clusterAdmin,this.onValueChanged("namespace",this.state.namespace));const{className:i}=this.props;return p.createElement("div",{className:"section"},p.createElement("div",{className:i},p.createElement(F.DataSourcePickList,{inputDefinition:e,serviceConnectionProvider:this._source,onValueChanged:this.onValueChanged,getValue:this.getValue,onError:this.props.onError,preloadItems:!0,serviceEndpointDetails:H.EndpointHelper.getAzureRMServiceEndpointDetails(this.context.pageContext,this.props.subscription,this.props.endpointToken),makeRecursiveDatasourceCalls:!0})),p.createElement("div",{className:i},p.createElement("label",{className:"bolt-textfield-label"},"Namespace"),p.createElement(E.RadioButtonGroup,{className:"",selectedButtonId:this.getValue("createNewNamespace"),onSelect:e=>this.onValueChanged("createNewNamespace",e),direction:1},this._getRadioButtons()),"false"===this.state.createNewNamespace&&p.createElement(F.DataSourcePickList,{inputDefinition:t,serviceConnectionProvider:this._source,onValueChanged:this.onValueChanged,getValue:this.getValue,onError:this.props.onError,preloadItems:!!this.state.clusterId,serviceEndpointDetails:this._getKubernetesServiceEndpointDetails()}),"true"===this.state.createNewNamespace&&p.createElement(C.FormItem,{className:"flex-row",label:""},p.createElement(N.TextField,{containerClassName:"namespace-text-field",value:this.getValue("namespace"),onChange:(e,t)=>this.onValueChanged("namespace",t)}))))}componentDidMount(){super.componentDidMount()}}}(),function(e){t.ComponentsSimpleMarkdownRenderer={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsSimpleMarkdownRenderer.SimpleMarkdownRenderer=class extends p.Component{constructor(e,t){super(e,t),this.state={},this._renderer=new P({breaks:!0,linkify:!1,typographer:!1,html:!0}),this._renderer.validateLink=n}render(){const e=this._renderer.render(this.props.text);return p.createElement("span",{dangerouslySetInnerHTML:{__html:e}})}};const i=/^(vbscript|javascript|file|data):/;function n(e){var t=e.trim().toLowerCase();return!i.test(t)}t.ComponentsSimpleMarkdownRenderer.validateLinkProtocol=n}(),function(e){t.SnippetForm={},Object.defineProperty(t,"__esModule",{value:!0});class n extends w.VssComponent{constructor(e){super(e),this._addSnippetToYaml=(()=>{this._export(this._store.getValuesForExport(),r.TelemetryConstants.ExportSnippet)}),this._getStateFromStore=(()=>{this.setState({snippetInputsByGroup:this._store.inputsByGroup,visibleGroups:this._store.visibleGroups,isSnippetSupported:this._store.isSnippetSupported})}),this._onError=((e,t)=>{const i=this.context.pageContext.getService("IVssTelemetryService");i&&i.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.Error,{location:e,error:t,snippetName:this.props.snippet.friendlyName})}),this.state={snippetInputsByGroup:{},visibleGroups:[],isSnippetSupported:!0}}render(){return p.createElement("div",{className:"yaml-snippet-form flex-column flex-grow"},this._content())}_content(){if(this.state.error&&this.state.error.message)return p.createElement("div",null,p.createElement(m.Button,{className:"yaml-snippet-back-button",onClick:this.props.onDismiss,subtle:!0,iconProps:{iconName:"Back"},ariaLabel:z.CancelSnippetYaml}),p.createElement("span",null,i.format(z.FailedToLoadSnippet,this.state.error.message)));const e=this.state.snippetInputsByGroup[r.UnparentedInputsGroupName];return p.createElement(p.Fragment,null,p.createElement(R.FocusZone,{focusOnMount:!0},p.createElement("div",{className:l.css(this.props.className||"yaml-snippet-form-content","flex-grow","v-scroll-auto","h-scroll-hidden")},p.createElement("div",{className:l.css(this.props.innerContentClassName||"yaml-snippet-form-inner-content")},!this.props.hideHeader&&p.createElement("span",{className:"flex-row snippet-form-header"},p.createElement(m.Button,{className:"yaml-snippet-back-button",onClick:this.props.onDismiss,subtle:!0,iconProps:{iconName:"Back"},ariaLabel:z.CancelSnippetYaml}),p.createElement("span",{className:"snippet-name-header text-ellipsis title-s"},this.props.snippet.friendlyName)),e&&e.length>0&&p.createElement(K.SnippetInputList,{className:"ungrouped",inputs:e,inputValueProvider:this._store,serviceConnectionProvider:this._source,onError:this._onError}),this.state.visibleGroups.length>0&&p.createElement(k.Accordion,{sections:K.getSnippetInputGroups(this.state.snippetInputsByGroup,this.state.visibleGroups,this._store.isGroupCollapsed,this._store,this._source,this._onError),onSectionClicked:this._store.toggleGroup})))),!this.props.hideFooter&&p.createElement("div",{className:"yaml-snippet-form-footer"},this.props.snippet.documentationUrl&&p.createElement(A.Link,{className:"snippet-documentation",href:this.props.snippet.documentationUrl,target:"_blank",rel:"noopener noreferrer"},z.TaskReference),p.createElement(m.Button,{primary:!0,onClick:this._addSnippetToYaml},z.AddSnippetYaml)))}componentDidMount(){super.componentDidMount(),this._load()}componentWillUnmount(){super.componentWillUnmount(),this._store&&this._store.dispose()}componentDidUpdate(e,t){e.snippet===this.props.snippet&&e.startingParameters===this.props.startingParameters||this._load()}_load(){this.props.snippet.inputs.length>0?(this._store=this.props.store||new W.SnippetFormStore,this._store.addListener(this._getStateFromStore),this._source=new M.SnippetFormSource(this.context.pageContext,this._store.getInputType),this._loadSnippet(this.props.snippet,this.props.startingParameters)):this._export({},r.TelemetryConstants.ExportSnippet)}_loadSnippet(e,t){try{if(this._store.loadSnippet(e,t),!this._store.isSnippetSupported){const e=this.context.pageContext.getService("IVssTelemetryService");e&&e.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.LoadedUnsupportedSnippet,{name:this.props.snippet.friendlyName,version:this.props.snippet.version,isTemplate:Boolean(this.props.snippet.content),unsupportedInputs:this._store.unsupporedInputTypes.join(",")})}if(Boolean(t)){const t=this.context.pageContext.getService("IVssTelemetryService");t&&t.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.SnippetSelected,{name:e.friendlyName,version:e.version,codeLens:!0})}}catch(e){this.setState({error:e});const t=this.context.pageContext.getService("IVssTelemetryService");t&&t.publishEvent(r.TelemetryConstants.Area,r.TelemetryConstants.Error,{location:"loadSnippetForm",error:e})}}async _export(e,t){if(this.props.onInputsCompleted&&this.props.onInputsCompleted(e),this.props.onYamlGenerated){const t=await Y.exportYaml(this.context.pageContext,this.props.snippet,e);this.props.onYamlGenerated(t)}this.props.onDismiss&&this.props.onDismiss();const i=this.context.pageContext.getService("IVssTelemetryService");i&&i.publishEvent(r.TelemetryConstants.Area,t,{name:this.props.snippet.friendlyName,version:this.props.snippet.version,isTemplate:Boolean(this.props.snippet.content)})}}t.SnippetForm.SnippetForm=n,w.Components.add("yaml-snippet-form",n)}()},["Resources","Sources/SnippetFormSource","Utilities/VisibilityHelper","Components/EnhancedLabel","Components/AzureSubscriptionPickList","Components/EnhancedDropdown","Components/DataSourcePickList","Components/RadioGroup","Components/ServiceConnectionPickList","Components/SnippetInput","Components/SnippetInputGroup","Stores/SnippetFormStore","Utilities/EndpointHelper","Utilities/YamlExport","Components/AzureContainerRegistryPicker","Components/AzureKubernetesEndpointInput","Components/SimpleMarkdownRenderer","SnippetForm"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.designer-extensions.yaml-snippet-form"}}));