"use strict";define("Build/Designer",["require","exports","Build/Common/Library/Navigation","VSS/Platform/Context","VSS/Core/Observable","VSS/Platform/FPS","Build/Common/Library/Resources","Tfs/Platform/Page","Build/SourceProviders/Common","VSS/Core/Util/String","react","VSSUI/Icon","VSSUI/List","VSSUI/Utilities/Provider","VSS/Platform/Layout","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Components/Format","VSS/Platform/Location","VSSUI/Button","VSSUI/Image","VSSUI/MessageCard","VSS/Platform/Feature","VSSUI/Header","VSSUI/Dialog","VSSUI/ButtonGroup","VSSUI/Checkbox","VSSUI/FormItem","VSSUI/Link","VSSUI/Panel","VSSUI/TextField","react-dom","Build/Common/Library/Components/CopyToClipboardButton","VSS/Core/TimerManagement","VSSUI/TooltipEx","VSSUI/RadioButton","VSSUI/Spinner","VSSUI/Util","Build/Common/Library/Legacy/Components/BranchDropdown","VSSUI/Callout","VSSUI/HeaderCommandBar","VSSUI/VssIcon","Build/Common/Library/Components/CommandComponent","Build/Common/Library/Constants","Build/Common/Library/Legacy/Components/PipelineSettingsPanel","Build/Common/Library/StateHandler","Build/Queue-Panel/QueuePanel","VSSUI/Page","VSSUI/Pill","VSSUI/PillGroup","OfficeFabric/ProgressIndicator","OfficeFabric/Selection","VSS/Platform/Trace","VSSUI/Ago","VSSUI/FilterBar","VSSUI/PickList","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","Build/DesignerExtensions/YamlSnippetForm/Utilities/EndpointHelper","VSSUI/Observer","VSSUI/SplitButton","VSSUI/Wizard"],function(e,t,i,s,r,a,n,o,l,c,d,p,h,m,u,g,v,S,b,f,y,_,C,P,E,w,x,R,T,N,I,F,L,D,B,k,V,A,M,O,U,z,Y,j,W,H,q,K,G,Q,J,$,Z,X,ee,te,ie,se,re,ae,ne){var oe,le,ce,de,pe,he,me,ue,ge,ve,Se,be,fe,ye,_e,Ce,Pe,Ee,we,xe,Re,Te,Ne,Ie,Fe,Le,De,Be,ke;oe=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.AddedSnippet="Added task",t.Resources.AuthorizeAndRunButtonText="Authorize resources and run",t.Resources.AuthorizeButtonText="Authorize",t.Resources.AuthorizeWithExternalIdentity="To continue, authorize a connection using your {0} identity",t.Resources.AuthorizingMessage="Authorizing...",t.Resources.AuthorizingWithProviderMessage="Authorizing with {0}...",t.Resources.AutoAuthorizeErrorMessage="An unspecified error occurred while attempting to authorize resources.",t.Resources.AzurePipelinesApp="Azure Pipelines GitHub App",t.Resources.Branch="Branch",t.Resources.BranchDataProviderErrorMessage="Error retrieving branches for repository {0}.",t.Resources.BranchNameErrorInvalidCharacter="A branch name cannot contain '{0}'.",t.Resources.BranchNameErrorInvalidLeadCharacter="A branch name cannot start with '{0}'.",t.Resources.BranchNameErrorInvalidTrailCharacter="A branch name cannot end with '{0}'.",t.Resources.BranchNameErrorSameAsTarget="The branch name cannot be the same as the target branch.",t.Resources.BranchNameErrorTooLong="The branch name cannot be longer than {0} characters.",t.Resources.BringYourOwnYamlTitle="Existing Azure Pipelines YAML file",t.Resources.BringYourOwnYamlTitleShort="Select an existing YAML file",t.Resources.BringYourOwnYamlDesc="Select an Azure Pipelines YAML file in any branch of the repository.",t.Resources.BuildInSimpleSteps="Build your code in a few easy steps",t.Resources.BuildNumberFormat="#{0}",t.Resources.BuildQueuedMessage="Build {0} has been queued.",t.Resources.BuildQueuingMessage="Queuing a build...",t.Resources.BuildsHubName="Builds",t.Resources.Cancel="Cancel",t.Resources.ChangeToAppConnection="Use app connection",t.Resources.ChooseSubscription="Azure subscription",t.Resources.Close="Close",t.Resources.CommandRunWithParameters="Run with parameters",t.Resources.CommandSettings="Settings",t.Resources.CommandTriggers="Triggers",t.Resources.CommandVariables="Variables",t.Resources.CommitMessage="Commit message",t.Resources.Configure="Configure",t.Resources.Configuring="Configuring...",t.Resources.ConfigureYourPipeline="Configure your pipeline",t.Resources.ConfiguringYourPipelineAndGeneratingYaml="Configuring resources and generating YAML",t.Resources.ConfigFileDataProviderErrorMessage="Error retrieving config files for repository {0}.",t.Resources.ConfigFileNotFound="File not found.",t.Resources.ConfigFileInvalid="File is not a valid Dockerfile or YAML file.",t.Resources.ConfirmLosingUnsavedChange="You have unsaved changes which will be lost if you navigate away. Are you sure you want to discard these changes?",t.Resources.ConfirmLosingUnsavedChangeTitle="Are you sure you want to leave?",t.Resources.Connect="Connect",t.Resources.ConnectionChanged="Connection was successfully changed",t.Resources.Continue="Continue",t.Resources.CreatingPipeline="Creating pipeline...",t.Resources.DefaultBranch="default",t.Resources.DisabledSecretCheckboxTooltip="Once marked secret, a variable's value will always be kept secret.",t.Resources.EditInOldDesigner="Use the classic editor",t.Resources.EditorDefaultTitle="Pipeline editor",t.Resources.EditorErrorDefaultPipelineFetch="An error occurred while fetching the pipeline. {0}",t.Resources.EditorErrorGitRepoNotFound="{0} You can use the classic editor to select the repository in the YAML source settings.",t.Resources.EditorErrorNotYamlPipeline="{0} You can use the classic editor to view and edit pipelines without YAML.",t.Resources.EditorErrorServiceConnection="{0} You can use the classic editor to fix the service connection in the YAML source settings.",t.Resources.ErrorMessage="Error: {0}",t.Resources.ExistingFileFound="An existing YAML file was found",t.Resources.FilesToBeAdded="Files to be added to your repository ({0})",t.Resources.FileInvalidCharacters='The file name cannot contain any of the following characters: \\ : * ? " < > |',t.Resources.FileInvalidDoubleSlash="The file name cannot contain //",t.Resources.FileInvalidEmpty="The file name cannot be empty",t.Resources.FileInvalidEndCharacters="The file or folder name cannot end with any of the following characters: / .",t.Resources.FullYaml="Download full YAML",t.Resources.HostedMacWarning="Using a hosted macOS pool affects your data storage and security. {0}",t.Resources.ImageName="Image name",t.Resources.GetFileContentErrorMessage="An unspecified error occurred while fetching file {0} from branch {1}.",t.Resources.LearnMore="Learn more",t.Resources.Leave="Leave",t.Resources.LoadingEditor="Loading the editor...",t.Resources.LoadingYAMLFiles="Loading existing YAML files...",t.Resources.LoginUrlNotSpecified="Could not login to view this YAML file",t.Resources.InstallApp="Install app",t.Resources.InvalidServiceConnection="Unable to fetch any repositories. Please ensure the service connection is valid.",t.Resources.Name="Name",t.Resources.NameColumnHeader="Name",t.Resources.NewPipeline="New pipeline",t.Resources.OK="OK",t.Resources.OldDesignerFallbackFormat="{0} to create a pipeline without YAML.",t.Resources.OldDesignerLinkText="Use the classic editor",t.Resources.OptionalExtendedDescription="Optional extended description",t.Resources.OrFormat="Or, {0}",t.Resources.Path="Path",t.Resources.PipelineHostedOn="This pipeline's YAML is hosted on {0}",t.Resources.PipelineSavedMessage="Changes applied to the pipeline for all runs",t.Resources.PipelineSettingsPanelTitle="Pipeline settings",t.Resources.PipelineSettingsSubheaderStatus="Processing of new run requests",t.Resources.PipelineSettingsStatusEnabled="Enabled",t.Resources.PipelineSettingsStatusDisabled="Disabled",t.Resources.PipelineSettingsStatusPaused="Paused",t.Resources.PipelineSettingsYamlDiscard="This will discard unsaved changes in the current YAML file",t.Resources.PipelineSettingsYamlFetchError="An unspecified error occurred while fetching existing YAML files.",t.Resources.PipelineSettingsYamlFilePath="YAML file path",t.Resources.PipelineStatusCIDisabled="CI Disabled",t.Resources.PipelineStatusDisabled="Disabled",t.Resources.PipelineStatusPaused="Paused",t.Resources.PreferAppConnectionInstall="Enhance this pipeline by installing the {0}",t.Resources.PreferAppConnectionChange="Enhance this pipeline by changing its connection to use the {0}",t.Resources.QueueResourceName="Agent pool",t.Resources.Recommended="Recommended",t.Resources.Rename="Rename",t.Resources.RepositoryAlreadyMapped="The repository {0} is in use with the {1} in another Azure DevOps organization. {2}",t.Resources.RepositoryAnalyzing="Analyzing your repository to suggest a compatible template...",t.Resources.RepositorySelectorFetchingRepositories="Fetching repositories...",t.Resources.RepositorySelectorFilterPlaceholder="Filter by keywords",t.Resources.RepositorySelectorFilterReset="Reset",t.Resources.RepositorySelectorNoneFoundDescription="No matching repositories were found.",t.Resources.RepositorySelectorProvideAccessDescription="If you can't find a repository, make sure you {0}.",t.Resources.RepositorySelectorProvideAccessDescriptionLink="provide access",t.Resources.RepositorySelectorTagFork="fork",t.Resources.RepositorySelectorTagPrivate="private",t.Resources.RepositorySelectorTitle="Select a repository",t.Resources.ResourcesVariables="Variables",t.Resources.ResourcesAuthorizedResources="Authorized resources",t.Resources.Review="Review",t.Resources.ReviewYourPipelineYAML="Review your pipeline YAML",t.Resources.RunBuildErrorMessage="An unspecified error occurred while queuing the build.",t.Resources.RunButtonLabel="Run",t.Resources.SaveAndRunButtonLabel="Save and run",t.Resources.SaveButtonLabel="Save",t.Resources.SaveErrorMessage="An unspecified error occurred while saving the file.",t.Resources.SavePanelCommitDescriptionPlaceholder="Add an optional description...",t.Resources.SavePanelCommitMessage="Set up CI with Azure Pipelines",t.Resources.SavePanelCommitMessageForEdit="Update {0} for Azure Pipelines",t.Resources.SavePanelCommitToDefault="Commit directly to the {0} branch",t.Resources.SavePanelCommitToNewBranch="Create a new branch for this commit",t.Resources.SavePanelCreatePullRequest="Start a pull request",t.Resources.SavePanelDescription="Saving will commit {0} to the repository.",t.Resources.SavePanelNewBranchMessage="Based on the {0} branch",t.Resources.SavePanelNewBranchName="azure-pipelines",t.Resources.SavePanelTitleSave="Save",t.Resources.SavePanelTitleSaveAndRun="Save and run",t.Resources.SavePipelineCommentDisableCI="Disable pipeline CI",t.Resources.SavePipelineCommentEnableCI="Enable YAML pipeline CI",t.Resources.SavingChanges="Saving changes...",t.Resources.SecureFileResourceName="Secure file",t.Resources.Select="Select",t.Resources.SelectAzureSubscription="Select an Azure subscription",t.Resources.SelectYamlDescription="Select a file from the dropdown or type in the path to your file",t.Resources.ServiceEndpointResourceName="Service connection",t.Resources.ServicePort="Service port",t.Resources.ShowMore="Show more",t.Resources.SidePanelClose="Hide",t.Resources.SidePanelOpen="Show assistant",t.Resources.Stay="Stay",t.Resources.StepTemplate="Template",t.Resources.StepSubscription="Subscription",t.Resources.TemplateRequiresMoreInfo="The selected template requires the following information",t.Resources.TestPanelCommandName="TestPanel",t.Resources.TypeColumnHeader="Type",t.Resources.UnauthorizeButtonText="Unauthorize",t.Resources.UnableToInstallMarketplaceApp="The {0} is not installed to repository {1}. {2}",t.Resources.Validate="Validate",t.Resources.ValidateAndConfigureButtonLabel="Validate and configure",t.Resources.Validation="Validation",t.Resources.Value="Value",t.Resources.VariableGroupResourceName="Variable group",t.Resources.ViewOnExternalSite="view it on {0}",t.Resources.VisibilityMismatchProjectSettings="project settings",t.Resources.VisibilityMismatchRepoPrivate="You selected a private repository, but this is a public project. Go to {0} to change the visibility of the project. {1}",t.Resources.VisibilityMismatchRepoPublic="You selected a public repository, but this is not a public project. Go to {0} to change the visibility of the project. {1}",t.Resources.VariableColumnHeaderName="Name",t.Resources.VariableColumnHeaderValue="Value",t.Resources.VariableColumnHeaderSecret="Secret variable",t.Resources.VariableColumnHeaderIcon="Variable error message",t.Resources.VariableErrorNameIsRequired="Variable name is required",t.Resources.VariableErrorNameIsAlreadyDefined="Variable '{0}' is already defined",t.Resources.VariableSecretTooltipChangeToSecret="Change variable type to secret",t.Resources.VariableSecretTooltipChangeToPlainText="Change variable type to plain text",t.Resources.VariableAddButtonText="Add variable",t.Resources.VariableDeleteButtonTooltipText="Delete variable",t.Resources.VariableEditPanelTitleNew="New variable",t.Resources.VariableEditPanelTitleUpdate="Update variable",t.Resources.VariableEditPanelToReferenceText="{0}, prefix it with a dollar sign and enclose it in parentheses.  For example: {1}",t.Resources.VariableEditPanelToReferenceText0="To reference a variable in YAML",t.Resources.VariableEditPanelToUseText="{0}, use environment variable syntax.",t.Resources.VariableEditPanelToUseText0="To use a variable in a script",t.Resources.VariableEditPanelToUseTextMore="Replace {0} and space with {1}, capitalize the letters, and then use your platform's syntax for referencing an environment variable. Examples:",t.Resources.VariableEditPanelToUseExBatch="Batch script: {0}",t.Resources.VariableEditPanelToUseExPowerShell="PowerShell script: {0}",t.Resources.VariableEditPanelToUseExBash="Bash script: {0}",t.Resources.VariableEditPanelToUseSecret="{0}, you must explicitly map it as an environment variable.",t.Resources.VariableEditPanelToUseSecret0="To use a secret variable in a script",t.Resources.VariableEditPanelIsSecret="Keep this value secret",t.Resources.VariableEditPanelIsDuplicate="Variable '{0}' is already defined",t.Resources.VariableEditPanelAllowOverride="Let users override this value when running this pipeline",t.Resources.VariablesPanelCommandCopy="Copy",t.Resources.VariablesPanelCommandDelete="Delete variable",t.Resources.VariablesPanelCommandUndoDelete="Undo deletion",t.Resources.VariablesPanelEmptyText="Use variables to store values or encrypted secrets separately from your repository.",t.Resources.VariablesPanelLearnMore="Learn about variables",t.Resources.VariablesPanelNewVariable="New variable",t.Resources.VariablesPanelSaveComment="Update variables",t.Resources.VariablesPanelSearch="Search variables",t.Resources.VariablesPanelTitle="Variables",t.Resources.VariableReferencePlaceholderName="variable-name",t.Resources.WhereIsYourCode="Where is your code?",t.Resources.Yaml="YAML",t.Resources.YamlFileDescription="Pipeline process",le=t.Constants={},Object.defineProperty(t,"__esModule",{value:!0}),(De=t.Constants.EditorConstants||(t.Constants.EditorConstants={})).ElementToFocusOnEscape="ci-editor-escape-focus-element",De.ToastDuration=5e3,De.YamlAssistantToggleElement="yaml-assistant-toggle-element",(Le=t.Constants.FwLinks||(t.Constants.FwLinks={})).AzurePipelinesDocs="https://go.microsoft.com/fwlink/?linkid=2024748",Le.LearnMoreVariables="https://go.microsoft.com/fwlink/?linkid=2098718",(Fe=t.Constants.LegacyDesignerTabKeys||(t.Constants.LegacyDesignerTabKeys={})).Triggers="Tab_Triggers",Fe.Variables="Tab_Variables",Fe.Yaml="Tab_Tasks",(Ie=t.Constants.TemplateConstants||(t.Constants.TemplateConstants={})).TemplateIdKey="templateid",Ie.RepositoryNameKey="repositoryName",Ie.K8sConnectionKey="k8sConnection",Ie.SubscriptionId="subscriptionId",(Ne=t.Constants.TemplateRequiredConstants||(t.Constants.TemplateRequiredConstants={})).AzureSubscription="connectedService:azureRM",Ne.DataSourcePicklist="dataSourcePicklist",Ne.KubernetesEndpoint="endpoint:kubernetes",(Te=t.Constants.TemplateParameterTypes||(t.Constants.TemplateParameterTypes={})).AzureContainerRegistry="endpoint:containerRegistry",Te.AzureRmEndpoint="endpoint:azureRm",Te.Boolean="boolean",Te.DataSourcePickList="dataSourcePicklist",Te.KubernetesResource="environmentResource:kubernetes",Te.PickList="picklist",Te.String="string",Te.MarkDown="markdown",(t.Constants.TemplateAssetTypes||(t.Constants.TemplateAssetTypes={})).File="file",(Re=t.Constants.WellKnownExceptions||(t.Constants.WellKnownExceptions={})).DefinitionTypeNotSupportedException="DefinitionTypeNotSupportedException",Re.GitRepositoryNotFoundException="GitRepositoryNotFoundException",Re.ServiceEndpointNotFoundException="ServiceEndpointNotFoundException",(xe=t.Constants.WizardStateKeys||(t.Constants.WizardStateKeys={})).ConnectionId="connectionId",xe.RepositoryId="repositoryId",function(e){t.InstallAppService={},Object.defineProperty(t,"__esModule",{value:!0});class r extends s.VssService{installApp(){const e=this.pageContext.getService("IVssContributionService"),t=this._getTelemetrySession();e.getDataAsync("ms.vss-build-web.wizard-continuation-data-provider",{telemetrySession:t},!0).then(()=>{this._logTelemetry("installApp","CreatePipeline",t,""),i.openLinkSecurely(r._redirectUrl,!1)})}installAppForWizard(e,t,s,a){let n=r._redirectUrl;if(a.properties&&a.properties.ownerId){const e=a.properties.ownerId,t=a.properties.externalId,i=s.indexOf("?")>0?"&":"?";n=s+i+"suggested_target_id="+e+"&repository_ids[]="+t}const o=this._getTelemetrySession();this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.wizard-continuation-data-provider",{sourceProvider:e,repositoryId:a.id,repositoryName:a.name,connectionId:t,telemetrySession:o},!0).then(()=>{this._logTelemetry("installAppForRepository","CreatePipeline",o,a.id),i.openLinkSecurely(n,!1)})}installAppForEdit(e,t,s,a){let n=r._redirectUrl;if(a.properties&&a.properties.ownerId){const e=a.properties.ownerId,t=a.properties.externalId,i=s.indexOf("?")>0?"&":"?";n=s+i+"suggested_target_id="+e+"&repository_ids[]="+t}this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.pipeline-edit-continuation-data-provider",{pipelineId:e.toString(),nonce:t,repositoryId:a.id},!0).then(()=>{this._logTelemetry("installAppForRepository","EditPipeline",a.id),i.openLinkSecurely(n,!1)})}_getTelemetrySession(){return this.pageContext.getService("IVssHistoryService").getState().telemetrySession}_logTelemetry(e,t,i,s){this.pageContext.getService("IVssTelemetryService").publishEvent("Build",t,{GitHubApp:e,GitHubAppRepo:s,action:"InstallGitHubApp",telemetrySession:i||"unknown"})}}t.InstallAppService.InstallAppService=r,r._redirectUrl="https://go.microsoft.com/fwlink/?linkid=874367",s.Services.add("IInstallAppService",{serviceFactory:r})}(),ce=t.Performance={},Object.defineProperty(t,"__esModule",{value:!0}),(t.Performance.PerformanceConstants||(t.Performance.PerformanceConstants={})).Area="Build",(Be=t.Performance.PageLoadScenarios||(t.Performance.PageLoadScenarios={})).Sources="PLT.CI.AcquisitionWizard.Sources",Be.YamlEditor="PLT.CI.YamlEditor",Be.Repository="CI.Designer.Repository",Be.Templates="CI.Designer.Templates",function(e){t.PipelineEditorBreadcrumbService={},Object.defineProperty(t,"__esModule",{value:!0});s.Services.add("pipeline-editor-breadcrumb-service",{serviceFactory:class extends s.VssService{constructor(){super(...arguments),this.items=new r.ObservableArray}getBreadcrumbItems(e){return this.items}setPipeline(e){this.items.removeAll();const t=this.buildLinkingService.getDefinitionUrl();if(this.items.push({key:"pipeline-editor-builds-breadcrumb",text:oe.BuildsHubName,href:t,onClick:e=>{a.onClickFPS(this.pageContext,t,!0,e,{telemetrySource:"pipeline-editor-breadcrumb"})}}),e){const t=this.buildLinkingService.getDefinitionUrl(e.id);this.items.push({key:"pipeline-editor-definition-breadcrumb",text:e.name,href:t,onClick:e=>{a.onClickFPS(this.pageContext,t,!0,e,{telemetrySource:"pipeline-editor-breadcrumb"})}},{key:"pipeline-editor-pipeline-yaml-breadcrumb",text:oe.Yaml})}}clearPipeline(){this.items.removeAll()}get buildLinkingService(){return this.pageContext.getService("IBuildLinkingService")}}})}(),function(e){t.PipelineService={},Object.defineProperty(t,"__esModule",{value:!0});class i extends s.VssService{createAndRunPipeline(e,t,s,r,a,n,o){const l=this.pageContext.getService("IVssContributionService");let c={createOnly:o,connectionId:e.connectionId,sourceProvider:e.sourceProviderType,pipelinePath:a,repositoryId:e.id,repositoryName:e.name,branch:e.defaultBranch,sourceBranch:s||e.defaultBranch,filePath:t,queue:"Hosted Ubuntu 1604"};return r&&(c=Object.assign(Object.assign({},c),{commitId:r.commitId,pullRequestNumber:r.pullRequestNumber,commitDescriptorName:r.commitDescriptorName})),n&&Object.keys(n).length>0&&(c.variables=n),l.getDataAsync(i._pipelineDataProviderId,c,!0)}runPipeline(e,t){const i=this.pageContext.getRestClient("IBuildRestClient"),s={definition:{id:e.id},sourceBranch:t};return i.queueBuild(s,e.project.id)}enablePipelineCI(e,t){if((e=this.shallowCopy(e)).triggers&&(e.triggers=e.triggers.filter(e=>2!==e.triggerType)),t){const t={batchChanges:!1,maxConcurrentBuildsPerBranch:1,pollingJobId:"",pollingInterval:0,pathFilters:[],branchFilters:[],settingsSourceType:2,triggerType:2};e.triggers=e.triggers||[],e.triggers.push(t),e.comment=oe.SavePipelineCommentEnableCI}return e.comment=t?oe.SavePipelineCommentEnableCI:oe.SavePipelineCommentDisableCI,this.savePipeline(e)}enablePipeline(e,t){switch((e=this.shallowCopy(e)).queueStatus=t,t){case 2:e.comment=n.SavePipelineCommentDisable;break;case 0:e.comment=n.SavePipelineCommentEnable;break;case 1:e.comment=n.SavePipelineCommentPause}return this.savePipeline(e)}savePipeline(e){return this.pageContext.getRestClient("IBuildRestClient").updateDefinition(e,e.project.id,e.id)}getPipelineErrorMessage(){const e=this.pageContext.getService("IVssContributionService").getDataProviderExceptions()[i._pipelineDataProviderId];return e&&e.message}deepCopy(e){return JSON.parse(JSON.stringify(e))}shallowCopy(e){return Object.assign({},e)}}i._pipelineDataProviderId="ms.vss-build-web.create-and-run-pipeline-data-provider",s.Services.add("IPipelineService",{serviceFactory:i})}(),function(e){de=t.UtilFile={},Object.defineProperty(t,"__esModule",{value:!0}),t.UtilFile.getFileName=function(e){if(e){const t=e.lastIndexOf("/");return t>=0?e.substr(t+1):e}return""},t.UtilFile.getParentPath=function(e){let t;const i=n(a(e));if(i){t="/";const e=i.lastIndexOf("/");e>=0&&(t+=i.substr(0,e))}return t};const i=new Set(["\\",":","*","?",'"',"<",">","|"]),s=new Set(["/","."]);function r(e){return(e||"").split("/").map(e=>(e||"").trim()).join("/")}function a(e){for(;e&&"/"===e[0];)e=e.substr(1);return e}function n(e){for(;e&&"/"===e[e.length-1];)e=e.substr(0,e.length-1);return e}t.UtilFile.getInvalidFileNameMessage=function(e){return(e=r(e)).indexOf("//")>-1?oe.FileInvalidDoubleSlash:(e=a(e))?Array.from(e).some(e=>i.has(e))?oe.FileInvalidCharacters:e.split("/").some(e=>!e||s.has(e.substr(e.length-1)))?oe.FileInvalidEndCharacters:void 0:oe.FileInvalidEmpty},t.UtilFile.trimFilePath=r,t.UtilFile.trimLeadingSlashes=a,t.UtilFile.trimTrailingSlashes=n,t.UtilFile.ensureYamlExtension=function(e){const t=e.toLocaleLowerCase();return t.endsWith(".yml")||t.endsWith(".yaml")||(e+=".yml"),e}}(),function(e){pe=t.WarningBanner={},Object.defineProperty(t,"__esModule",{value:!0}),t.WarningBanner.clearWarning=function(e,t){const i=e.getService("IGlobalMessagesService"),s=i.getBanner();s&&s.settingId===t&&i.closeBanner()},t.WarningBanner.showWarning=function(e,t){e.getService("IGlobalMessagesService").addBanner({messageFormat:t.messageFormat,messageLinks:t.links,level:1,settingId:t.id},!1,!1)}}(),function(e){function i(e){const t=e.properties&&e.properties.isPrivate;return!(!t||"true"!==t.toLowerCase())}t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),t[e].bannerId="_warnIfVisibilityMismatch",t[e].isVisibilityMismatch=function(e,t){return function(e){const t=o.getTFSPageData(e);if(t&&t.project&&t.project.visibility){const e=t.project.visibility;return 2===e}return!1}(e)!=!i(t)},t[e].getBannerContent=function(s,r){const a=i(r),n=s.getService("IBuildLinkingService");return{id:t[e].bannerId,messageFormat:a?oe.VisibilityMismatchRepoPrivate:oe.VisibilityMismatchRepoPublic,links:[{name:oe.VisibilityMismatchProjectSettings,href:n.getProjectSettingsUrl()},{name:oe.LearnMore,href:"https://go.microsoft.com/fwlink/?linkid=2027430"}]}}}("VisibilityMismatchWarning"),function(e){t.YamlFileService={},Object.defineProperty(t,"__esModule",{value:!0});const i="[skip ci]",r=["***no_ci***",i,"[ci skip]","skip-checks: true","skip-checks:true","[skip azp]","[azp skip]","[skip azpipelines]","[azpipelines skip]","[skip azurepipelines]","[azurepipelines skip]"];s.Services.add("IYamlFileService",{serviceFactory:class extends s.VssService{commitFile(e,t,i,s,r,a){const n=[{content:s,path:i,oldObjectId:a||""}];return this.commitFiles(e,t,n,r)}commitFiles(e,t,i,s){s.skipCi&&this._suppressCIBuild(s);const r="ms.vss-build-web.commit-file-data-provider",a={connectionId:e.connectionId,sourceProviderType:e.sourceProviderType,repositoryId:e.id,projectId:e.projectId||"",files:i,targetBranch:t,sourceBranch:s.createNewBranch?s.newBranchName:"",createPullRequest:s.createNewBranch&&s.createPullRequest,message:s.message,description:s.description};if(e.projectId){const t={contributionIds:[r],context:{properties:a}};return t.context.properties.projectId=e.projectId,this.pageContext.getRestClient("IContributionsRestClient").queryDataProviders(t,"project",e.projectId).then(e=>{if(e.resolvedProviders&&e.resolvedProviders.length){if(e.exceptions&&e.exceptions[r])throw new Error(e.exceptions[r].message);{const t=e.data[r]||{};return Object.assign(Object.assign({},t),{commitDescriptorName:s.message})}}throw new Error(oe.SaveErrorMessage)},e=>{throw new Error(e&&e.message||oe.SaveErrorMessage)})}{const e=this.pageContext.getService("IVssContributionService");return e.getDataAsync(r,a,!0).then(t=>{if(t)return Object.assign(Object.assign({},t),{commitDescriptorName:s.message});{const t=e.getDataProviderExceptions()[r],i=t&&t.message||oe.SaveErrorMessage;throw new Error(i)}})}}getFileContentData(e,t,i){const s="ms.vss-build-web.file-content-data-provider",r={connectionId:e.connectionId,sourceProvider:e.sourceProviderType,repository:e.id,path:i,branch:t},a=this.pageContext.getService("IVssContributionService");return a.getDataAsync(s,r).then(r=>{if(r)return r;{const r=a.getDataProviderExceptions()[s];let n=r&&r.message||c.format(oe.GetFileContentErrorMessage,i,t);throw n=this._processErrorMessage(n,e),new Error(n)}})}_suppressCIBuild(e){let t=e.description||"";const s=((e.message||"")+"|"+t).toLocaleLowerCase();r.every(e=>-1===s.indexOf(e))&&(t+=(t?" ":"")+i,e.description=t)}_processErrorMessage(e,t){let i=e||"";return c.equals(t.sourceProviderType,l.RepositoryTypes.TfsGit,!0)&&t.name&&t.id&&(i=e.replace(t.id,t.name)),i}}})}(),function(e){t.YamlResourcesService={},Object.defineProperty(t,"__esModule",{value:!0});t.YamlResourcesService.AvailableResourcesModel=class{constructor(e){const t=e&&e.queues||[];this._queues=new r.ObservableArray(t.map(e=>({id:e.id,name:e.alias})))}get queues(){return this._queues}};class i extends s.VssObservableService{getVariables(){if(!this._variables){const e=this.pageContext.getService("IVssContributionService").getData(i.PipelineDataProviderKey),t=e&&e.definition&&e.definition.variables||{};this._variables=Object.keys(t).map(e=>Object.assign({name:e},t[e])).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())),this._originalJson=JSON.stringify(this._variables)}return[...this._variables]}isVariablesChanged(){return JSON.stringify(this._variables.sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())))!==this._originalJson}getAvailableQueues(){const e=new r.ObservableArray,t=this.pageContext.getService("IVssContributionService").getData(i.ContributionKey);return t&&(e.value=t.queues),e}updateVariables(e){this._variables=e,this._notify([...this._variables],"updateVariables".toString())}getBuildDefinitionVariables(){return this._variables.reduce((e,t)=>(e[t.name]=Object.assign({},t),e),{})}}i.ContributionKey="ms.vss-build-web.pipeline-resources-data-provider",i.PipelineDataProviderKey="ms.vss-build-web.pipeline-editor-data-provider",s.Services.add("IYamlResourcesService",{serviceFactory:i})}(),he=t.ComponentsFileList={},Object.defineProperty(t,"__esModule",{value:!0}),(ke=t.ComponentsFileList.FileType||(t.ComponentsFileList.FileType={})).Yaml="FileYML",ke.Other="FileCode",t.ComponentsFileList.FileList=(e=>{const t=new m.ArrayItemProvider(e.files);return d.createElement("div",{className:"fileList flex-column"},d.createElement("label",{className:"fileList-label"},c.format(oe.FilesToBeAdded,e.files.length)),d.createElement(h.List,{className:"section-content",itemProvider:t,renderRow:(e,t,i,s)=>d.createElement(h.ListItem,{key:s||"list-item"+e,index:e,details:i},d.createElement(p.Icon,{className:"fileList-icon body-xl",iconName:t.type}),d.createElement("div",{className:"fileList-info flex-column"},d.createElement("div",{className:"fileList-name body-m"},t.name),d.createElement("div",{className:"fileList-description body-s secondary-text"},t.description))),width:"100%"}))}),function(e){me=t.EditorAuthLandingPage={},Object.defineProperty(t,"__esModule",{value:!0});function s(e,t){const i=e.getService("IVssContributionService").getContributionsByType("ms.vss-build-web.acquisition-source-provider-tile"),s=Object.keys(i).map(e=>i[e]).filter(e=>e.key===t);return s.length>0?s[0]:void 0}t.EditorAuthLandingPage.EditorAuthLandingPage=class extends u.VssComponent{constructor(e,t){super(e,t),this._createAuthRequest=(()=>{this.props.loginUrl&&i.openLinkSecurely(this.props.loginUrl)}),this._sourceProvider=s(this.context.pageContext,this.props.sourceProvider.getKey())||{};const r=this.context.pageContext.getService("ITfsPageService").getData();this.state={projectId:r.project.id,yamlLink:this.props.yamlFileLink}}componentDidMount(){if(null==this.state.yamlLink){const e={branchName:this.props.repository.defaultBranch,repositoryName:this.props.repository.name};this.props.sourceProvider.fetchLinks([e]).then(e=>{if(e&&e.length>0){const t=e[0];t&&t.repositoryLink&&this.setState({yamlLink:t.repositoryLink})}})}}componentWillUnmount(){}render(){const e=c.format(oe.PipelineHostedOn,this._sourceProvider.name),t=c.format(oe.AuthorizeWithExternalIdentity,this._sourceProvider.name),i=c.format(oe.ViewOnExternalSite,this._sourceProvider.name);return d.createElement("div",{className:"ci-designer-auth-landing-page-body flex-grow flex-column justify-center flex-center"},d.createElement("div",{className:"circle flex flex-center"},(e=>e.iconAsset?d.createElement(f.Image,{className:"source-provider-icon",src:S.getAssetLocation(this.context.pageContext,e.iconAsset),alt:e.iconAssetAltText||""}):d.createElement(p.Icon,{className:"source-provider-icon",iconName:this.props.sourceProvider.getRepoIconName()}))(this._sourceProvider)),d.createElement("div",{className:"primary-text"},e),d.createElement("div",{className:"secondary-text"},t),d.createElement(b.Button,{className:"authorize-button",primary:!0,text:oe.AuthorizeButtonText,onClick:this._createAuthRequest}),d.createElement(v.FormatComponent,{format:oe.OrFormat},d.createElement(g.FPSLink,{href:this.state.yamlLink,telemetrySource:"pipeline-editor.auth-landing-page",telemetryProperties:{clickedOn:"viewOnGitHub"},"aria-label":i},i)))}},t.EditorAuthLandingPage.getSourceProviderTile=s}(),function(e){ue=t.EditorHeader={},Object.defineProperty(t,"__esModule",{value:!0});t.EditorHeader.EditorHeader=class extends u.VssComponent{constructor(e,t){super(e,t),this._gotoPipelineResults=(e=>{const t=this.buildLinkingService.getDefinitionUrl(this.props.definition&&this.props.definition.id);this._gotoUrl(t,e)}),this._gotoLegacyDesigner=((e,t)=>{const i=this.buildLinkingService.getDefinitionEditUrl(this.props.definition.id,e);this._gotoUrl(i,t)}),this.state={},this._isVariablesPanelEnabled=!_.isFeatureFlagEnabled(t.pageContext,"Build2.DisableYamlEditorVariables",!1)}render(){return d.createElement(d.Fragment,null,d.createElement(C.Header,{className:"ci-editor-header",title:this._getTitle(),titleSize:1,backButtonProps:{onClick:this._gotoPipelineResults},commandBarItems:this._getCommandBarItems()}),this._getMessages())}_getTitle(){const e=this.props.definition&&this.props.definition.queueStatus||0;let t="";return 2===e?t=oe.PipelineStatusDisabled:1===e?t=oe.PipelineStatusPaused:this.props.definition&&!this._isCIEnabled()&&(t=oe.PipelineStatusCIDisabled),d.createElement(d.Fragment,null,d.createElement("span",null,this.props.title),t&&d.createElement("span",{className:"pipeline-status"},t))}_getCommandBarItems(){const e=[];if(this._isVariablesPanelEnabled){const t={id:"variablesPanel",text:oe.CommandVariables,important:!0,disabled:!this.props.definition,isPrimary:!1,onActivate:this.props.onVariablesOpen};e.push(t)}const t={id:"runsave",className:le.EditorConstants.ElementToFocusOnEscape,text:this.props.actionButtonLabel,important:!0,disabled:this.props.actionDisabled,isPrimary:!0,onActivate:this.props.onActionClick};e.push(t);const i={id:"settings",text:oe.CommandSettings,important:!1,disabled:!this.props.definition,iconProps:{iconName:"Settings"},onActivate:this.props.onSettingsOpen};e.push(i),e.push({id:"sep1",itemType:1,important:!1});const s={id:"validate",text:oe.Validate,important:!1,disabled:!this.props.definition,iconProps:{iconName:"CheckMark"},onActivate:this.props.onValidateYaml};e.push(s);const r={id:"fullyaml",text:oe.FullYaml,important:!1,disabled:!this.props.definition,iconProps:{iconName:"FileYML"},onActivate:this.props.onFullYaml};e.push(r),e.push({id:"sep2",itemType:1,important:!1});const a={id:"triggers",text:oe.CommandTriggers,important:!1,disabled:!this.props.definition,iconProps:{iconName:"LightningBolt"},onActivate:(e,t)=>this._gotoLegacyDesigner(le.LegacyDesignerTabKeys.Triggers,t)};if(e.push(a),!this._isVariablesPanelEnabled){const t={id:"variables",text:oe.CommandVariables,important:!1,disabled:!this.props.definition,iconProps:{iconName:"Variable"},onActivate:(e,t)=>this._gotoLegacyDesigner(le.LegacyDesignerTabKeys.Variables,t)};e.push(t)}return e}_gotoUrl(e,t){t&&(t.ctrlKey||t.shiftKey)?i.openLinkSecurely(e,!0):a.onClickFPS(this.context.pageContext,e,!0)}_getMessages(){const e=this._getErrorBar(),t=this._getBuildMessageBar();if(e||t)return d.createElement("div",{className:"page-content flex-row flex-noshrink"},e,t)}_getErrorBar(){if(this.props.errorMessage)return d.createElement(y.MessageCard,{className:"flex-grow",severity:"Error",buttonProps:this.props.errorActions,onDismiss:this.props.onErrorMessageDismissed},this.props.errorMessage)}_getBuildMessageBar(){if(this.props.buildMessageInfo){const e=this.props.buildMessageInfo,t=e.id>0?this.buildLinkingService.getBuildUrl(e.id):"";return d.createElement(y.MessageCard,{className:"flex-grow",severity:"Info",onDismiss:this.props.onBuildMessageDismissed},e.isQueuing?oe.BuildQueuingMessage:d.createElement(v.FormatComponent,{format:oe.BuildQueuedMessage},d.createElement(g.FPSLink,{href:t},c.format(oe.BuildNumberFormat,e.number))))}}_isCIEnabled(){const e=this.props.definition.triggers;return!(!e||!e.find(e=>2===e.triggerType))}get buildLinkingService(){return this.context.pageContext.getService("IBuildLinkingService")}}}(),function(e){function i(e,t){return d.createElement(P.Dialog,{titleProps:{text:oe.ConfirmLosingUnsavedChangeTitle},onDismiss:t,footerButtonProps:[{primary:!0,onClick:e,text:oe.Leave},{onClick:t,text:oe.Stay}],lightDismiss:!1},oe.ConfirmLosingUnsavedChange)}ge=t.LoseChangesDialog={},Object.defineProperty(t,"__esModule",{value:!0}),t.LoseChangesDialog.addNavigateAwayListener=function(e){document.body.addEventListener("fpsStarting",e),window.addEventListener("beforeunload",e)},t.LoseChangesDialog.removeNavigateAwayListener=function(e){document.body.removeEventListener("fpsStarting",e),window.removeEventListener("beforeunload",e)},t.LoseChangesDialog.showLoseChangesDialog=function(e,t){const s=t.detail;if(s&&s.href){if(s.data&&s.data.isPageSwitchConfirmed)return;t.preventDefault(),e.getService("IVssLayoutManager").renderCallout(e=>i(()=>{e(),s.data=s.data||{},s.data.isPageSwitchConfirmed=!0,a.FastPageSwitch(s.pageContext,s.href,s.recordHistoryEntry,s.data)},()=>{e()}))}else t.returnValue=oe.ConfirmLosingUnsavedChange},t.LoseChangesDialog.getLoseChangesDialog=i}(),function(e){ve=t.PipelineVariableEditPanel={},Object.defineProperty(t,"__esModule",{value:!0});t.PipelineVariableEditPanel.PipelineVariableEditPanel=class extends u.VssComponent{constructor(e){super(e),this._onNameChanged=((e,t)=>{this.setState({name:t})}),this._onValueChanged=((e,t)=>{this.setState({value:t})}),this._onIsSecretChanged=((e,t)=>{this.setState({isSecret:t||void 0})}),this._onAllowOverrideChanged=((e,t)=>{this.setState({allowOverride:t||void 0})}),this._onUpdate=(()=>{const e=Object.assign({},this.state);e.name=e.name.trim(),e.value=e.isSecret?e.value||null:e.value,this.props.onUpdate(e)});const t=Object.assign({},e.variable);t.isDirty=!1,t.name=t.name||"",t.value=t.value||"",this.state=t,this._otherVariableNames={},this.props.allVariables.forEach(e=>{this._otherVariableNames[e.name.toLocaleLowerCase()]=!0}),this.props.variable.name&&(this._otherVariableNames[this.props.variable.name.toLocaleLowerCase()]=!1)}componentDidUpdate(e,t){super.componentDidUpdate(e,t);const i=this._isDirty();this.state.isDirty!==i&&this.setState({isDirty:i})}render(){const e=this.props.variable.isNew&&!this.props.variable.name?oe.VariableEditPanelTitleNew:oe.VariableEditPanelTitleUpdate;return d.createElement(T.CustomPanel,{ariaLabel:e,className:"pipeline-editor-variable-edit-panel",calloutClassName:"pipeline-editor-variable-edit-callout",defaultActiveElement:this.state.name?".variable-value-container input":".variable-name-container input",onDismiss:this.props.onDismiss,lightDismiss:!this.state.isDirty},d.createElement(T.PanelHeader,{backButtonProps:{onClick:this.props.onDismiss},titleProps:{text:e,size:1},onDismiss:this.props.onDismiss,showCloseButton:!1}),d.createElement(T.PanelContent,null,this._renderBody()),this._renderFooter())}_renderBody(){const e=this.props.variable.isSecret,t=e&&!this.props.variable.isNew&&!this.props.variable.isSecretDirty;let i="";const s="$("+(this.state.name||oe.VariableReferencePlaceholderName)+")",r=(this.state.name||oe.VariableReferencePlaceholderName).toLocaleUpperCase().replace(/[ \.]/g,"_");if(this._isDuplicateName()){const e=this._getDuplicateVariable();i=e?c.format(oe.VariableEditPanelIsDuplicate,e.name):""}return d.createElement("div",{className:"flex-grow"},d.createElement(x.FormItem,{className:"variable-edit-name-container",label:oe.Name,message:i,error:!!i},d.createElement(N.TextField,{value:this.state.name,disabled:e,className:"variable-name-container",required:!0,onChange:this._onNameChanged})),d.createElement(x.FormItem,{label:oe.Value},d.createElement(N.TextField,{value:this.state.value||"",className:"variable-value-container",inputType:this.state.isSecret?"password":"text",placeholder:e&&this.state.isSecret&&!this.state.value?n.VariableSecretMask:void 0,onChange:this._onValueChanged})),d.createElement(w.Checkbox,{className:"variable-edit-checkbox first-checkbox",label:oe.VariableEditPanelIsSecret,checked:this.state.isSecret,onChange:this._onIsSecretChanged,disabled:t,tooltipProps:t?{text:oe.DisabledSecretCheckboxTooltip}:void 0}),d.createElement(w.Checkbox,{className:"variable-edit-checkbox",label:oe.VariableEditPanelAllowOverride,checked:this.state.allowOverride,onChange:this._onAllowOverrideChanged}),d.createElement("div",{className:"body-m variable-help-container"},d.createElement("div",{className:"variable-help-section"},d.createElement("div",{className:"variable-reference-text"},d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToReferenceText},d.createElement("span",{className:"font-weight-semibold"},oe.VariableEditPanelToReferenceText0),d.createElement("span",{className:"code-format"},s)))),d.createElement("div",{className:"variable-help-section"},d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseText},d.createElement("span",{className:"font-weight-semibold"},oe.VariableEditPanelToUseText0))),d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseTextMore},d.createElement("span",{className:"code-format"},"."),d.createElement("span",{className:"code-format"},"_")))),d.createElement("div",{className:"variable-help-section"},d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseExBatch},d.createElement("span",{className:"code-format"},"%"+r+"%"))),d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseExPowerShell},d.createElement("span",{className:"code-format"},"$env:"+r))),d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseExBash},d.createElement("span",{className:"code-format"},"$"+r)))),this.state.isSecret&&d.createElement("div",{className:"variable-help-section"},d.createElement("div",null,d.createElement(v.FormatComponent,{format:oe.VariableEditPanelToUseSecret},d.createElement("span",{className:"font-weight-semibold"},oe.VariableEditPanelToUseSecret0))))))}_renderFooter(){return d.createElement(T.PanelFooter,{className:"flex-row flex-center",showSeparator:!0},d.createElement(R.Link,{className:"flex-grow",href:le.FwLinks.LearnMoreVariables,target:"_blank",rel:"noopener noreferrer"},oe.VariablesPanelLearnMore),d.createElement(E.ButtonGroup,{className:"flex-grow justify-end"},d.createElement(b.Button,{key:"cancel",text:oe.Cancel,onClick:this.props.onDismiss}),d.createElement(b.Button,{key:"ok",text:oe.OK,primary:!0,disabled:!this.state.isDirty||this._isEmptyName()||this._isDuplicateName(),onClick:this._onUpdate})))}_isDirty(){const e=this.props.variable||{};return this.state.name!==(e.name||"")||this.state.value!==(e.value||"")||this.state.isSecret!==e.isSecret||this.state.allowOverride!==e.allowOverride}_isEmptyName(){return!this.state.name.trim()}_isDuplicateName(){const e=this.state.name.trim().toLocaleLowerCase();return!(!e||!this._otherVariableNames[e])}_getDuplicateVariable(){const e=this.state.name.trim().toLocaleLowerCase();return this.props.allVariables.find(t=>t.name.toLocaleLowerCase()===e)}}}(),function(e){Se=t.PipelineVariablesPanel={},Object.defineProperty(t,"__esModule",{value:!0});t.PipelineVariablesPanel.PipelineVariablesPanel=class extends u.VssComponent{constructor(e,t){super(e,t),this._selection=new h.ListSelection(!0),this._renderRow=((e,t,i,s)=>{const r=t.isDeleted?"Delete":t.isSecret?"Lock":"Variable",a=t.isDeleted?"Deleted":t.isSecret?n.VariableSecretMask:"= "+t.value,o=t.isDeleted?"is-deleted":t.isDirty?"font-weight-semibold":"",l=t.isDeleted?oe.VariablesPanelCommandUndoDelete:oe.VariablesPanelCommandDelete;return d.createElement(h.ListItem,{key:s||"list-item"+e,index:e,details:i,className:t.isDeleted?"deleted-variable-row":""},d.createElement("div",{className:"variable-row full-size"},d.createElement(p.Icon,{iconName:r,size:"medium",className:"variable-icon"}),d.createElement("div",{className:u.css("variable-content flex-column h-scroll-hidden flex-grow",o)},d.createElement(D.Tooltip,{overflowOnly:!0},d.createElement("span",{className:"text-ellipsis primary-text"},t.name)),d.createElement(D.Tooltip,{overflowOnly:!0},d.createElement("span",{className:"font-size text-ellipsis secondary-text"},a))),d.createElement(E.ButtonGroup,{className:"flex-noshrink justify-end bolt-list-cell-content-reveal"},!t.isDeleted&&d.createElement(F.CopyToClipboardButton,{onClickStopPropagation:!0,textToCopy:()=>"$("+t.name+")"}),d.createElement(b.Button,{key:"delete",ariaLabel:l,iconProps:{iconName:t.isDeleted?"Undo":"Delete"},tooltipProps:{text:l},subtle:!0,onClick:e=>{this._setDeleted(t,!t.isDeleted),e&&e.stopPropagation()}}))))}),this._onNewFromEmptyScenario=(()=>{const e=I.findDOMNode(this),t=e&&e.querySelector(".bolt-panel-focus-element");t&&t.focus&&t.focus(),this._newVariable()}),this._editPanelDismissed=(()=>{this.setState({isEditPanelOpen:!1,variableToEdit:void 0})}),this._updateVariable=(e=>{const t=this._originalVariables.find(t=>t.key===e.key);e.isDirty=this._isVariableDirty(e,t),e.isSecretDirty=this._isSecretDirty(e,t);const i=this._getIndex(e);i>-1?this._modifiedVariables.splice(i,1,e):this._modifiedVariables.splice(0,0,e),this._editPanelDismissed(),this._onVariablesUpdated()}),this._rowClicked=((e,t)=>{const i=Object.assign({},t.data);i&&!i.isDeleted&&this._editVariable(i)}),this._onSearchTextChanged=((e,t)=>{this._throttledSearch(t),this.setState({searchText:t})}),this._newVariable=(()=>{const e={key:String(this._modifiedVariables.length),name:"",value:"",isNew:!0,isDeleted:!1};this._editVariable(e)}),this._editVariable=(e=>{this.setState({isEditPanelOpen:!0,variableToEdit:e})}),this._onDismiss=(()=>{this.props.onDismiss()}),this._onSave=(()=>{this.props.onSave(this._getUpdatedPipelineVariables())}),this._onNavigateAway=(e=>{this.state.isDirty&&ge.showLoseChangesDialog(this.context.pageContext,e)}),this.state={isDirty:!1,isEditPanelOpen:!1,searchText:""},this._originalVariables=this._getExistingVariables(),this._modifiedVariables=this._originalVariables.map(e=>Object.assign({},e)),this._filteredVariables=new r.ObservableArray([...this._modifiedVariables]),this._timerManagement=new L.TimerManagement,this._throttledSearch=this._timerManagement.debounce(e=>this._updateFilteredList(e),250)}componentDidMount(){super.componentDidMount(),ge.addNavigateAwayListener(this._onNavigateAway)}componentWillUnmount(){super.componentWillUnmount(),ge.removeNavigateAwayListener(this._onNavigateAway)}render(){const e=this.state.isDirty,t=oe.VariablesPanelTitle,i=this._modifiedVariables.length||this.state.variableToEdit;return d.createElement(T.CustomPanel,{ariaLabel:t,className:"pipeline-editor-variables-panel",defaultActiveElement:i?".variables-search-input input":".empty-new-button",onDismiss:this._onDismiss,escDismiss:!e&&!this.props.isSaving,lightDismiss:!e&&!this.props.isSaving},d.createElement(T.PanelHeader,{titleProps:{text:t,size:1},onDismiss:this._onDismiss}),i?d.createElement(d.Fragment,null,d.createElement(T.PanelContent,null,this._renderBody()),this._renderFooter()):this._renderEmptyScenario())}_renderBody(){return d.createElement("div",{className:"variables-content-body flex-column flex-grow"},this.props.errorMessage&&d.createElement(y.MessageCard,{className:"error-message",severity:"Error"},this.props.errorMessage),d.createElement("div",{className:"variables-controls-container flex-row"},d.createElement(N.TextField,{value:this.state.searchText,className:"variables-search-input",containerClassName:"flex-grow",placeholder:oe.VariablesPanelSearch,ariaLabel:oe.VariablesPanelSearch,prefixIconProps:{iconName:"Search"},onChange:this._onSearchTextChanged,style:1}),d.createElement(b.Button,{iconProps:{iconName:"Add"},onClick:this._newVariable,ariaLabel:oe.VariablesPanelNewVariable,tooltipProps:{text:oe.VariablesPanelNewVariable},className:"variable-commands"})),d.createElement(h.ScrollableList,{itemProvider:this._filteredVariables,renderRow:this._renderRow,selection:this._selection,width:"100%",singleClickActivation:!0,onActivate:this._rowClicked}),this.state.isEditPanelOpen&&this.state.variableToEdit&&d.createElement(ve.PipelineVariableEditPanel,{allVariables:this._modifiedVariables,variable:this.state.variableToEdit,onDismiss:this._editPanelDismissed,onUpdate:this._updateVariable}))}_renderFooter(){const e=this.state.isDirty;return d.createElement(T.PanelFooter,{className:"flex-row flex-center",showSeparator:!0},d.createElement(R.Link,{className:"flex-grow",href:le.FwLinks.LearnMoreVariables,target:"_blank",rel:"noopener noreferrer"},oe.VariablesPanelLearnMore),d.createElement(E.ButtonGroup,{className:"flex-grow justify-end"},d.createElement(b.Button,{key:"cancel",text:e?oe.Cancel:oe.Close,disabled:this.props.isSaving,onClick:this._onDismiss}),d.createElement(b.Button,{key:"save",text:oe.SaveButtonLabel,primary:!0,disabled:this.props.isSaving||!e,onClick:this._onSave})))}_renderEmptyScenario(){return d.createElement("div",{className:"empty-variables-view flex-column flex-grow flex-self-center"},d.createElement("div",{className:"flex-column flex-grow flex-noshrink justify-center flex-center text-center"},d.createElement("div",{className:"circle flex-center flex-self-center"},d.createElement(p.Icon,{className:"empty-icon",iconName:"Variable"})),d.createElement("div",{className:"empty-text"},oe.VariablesPanelEmptyText),d.createElement(b.Button,{className:"empty-new-button",text:oe.VariablesPanelNewVariable,primary:!0,onClick:this._onNewFromEmptyScenario}),d.createElement(R.Link,{href:le.FwLinks.LearnMoreVariables,target:"_blank",rel:"noopener noreferrer"},oe.VariablesPanelLearnMore)),d.createElement("div",{className:"flex-grow no-width"}))}_setDeleted(e,t){const i=Object.assign(Object.assign({},e),{isDeleted:t}),s=this._getIndex(e);this._modifiedVariables.splice(s,1,i),this._onVariablesUpdated()}_isVariableDirty(e,t){return!t||e.name!==t.name||e.value!==t.value||e.isSecret!==t.isSecret||e.allowOverride!==t.allowOverride}_isSecretDirty(e,t){return!t||e.isSecret!==t.isSecret}_getIndex(e){return this._modifiedVariables.findIndex(t=>t.key===e.key)}_getExistingVariables(){const e=this.props.variables||{};return Object.keys(e||{}).map((t,i)=>{const s=e[t];return{key:String(i),name:t,value:s.value,isSecret:s.isSecret,allowOverride:s.allowOverride,isDeleted:!1,isNew:!1}}).sort((e,t)=>e.name.toLocaleLowerCase().localeCompare(t.name.toLocaleLowerCase()))}_getUpdatedPipelineVariables(){const e={};return this._modifiedVariables.filter(e=>!e.isDeleted).sort((e,t)=>e.name.toLocaleLowerCase().localeCompare(t.name.toLocaleLowerCase())).forEach(t=>e[t.name]=Object.assign({value:t.value,isSecret:t.isSecret,allowOverride:t.allowOverride})),e}_onVariablesUpdated(){this._updateFilteredList(this.state.searchText),this._updateOverallDirtyState()}_updateFilteredList(e){e?(e=e.toLocaleLowerCase(),this._filteredVariables.value=this._modifiedVariables.filter(t=>t.name.toLocaleLowerCase().indexOf(e)>-1).sort((t,i)=>{const s=t.name.toLocaleLowerCase(),r=i.name.toLocaleLowerCase();return(s===e?0:s.startsWith(e)?1:2)-(r===e?0:r.startsWith(e)?1:2)})):this._filteredVariables.value=[...this._modifiedVariables]}_updateOverallDirtyState(){const e=!!this._modifiedVariables.find(e=>e.isNew?!e.isDeleted:e.isDirty||e.isDeleted);this.state.isDirty!==e&&this.setState({isDirty:e})}}}(),function(e){var i;be=t.SavePanel={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DefaultBranch="DefaultBranch",e.NewBranch="NewBranch"}(i||(i={}));t.SavePanel.SavePanel=class extends u.VssComponent{constructor(e,t){super(e,t),this._maxGitRefNameLength=400,this._invalidRefNameStrings=["~","^",":"," ","?","*","[","\\","/.",".lock/","//","..","@{"],this._invalidLeadNameStrings=["/","."],this._invalidTrailNameStrings=[".lock",".","/"],this._commitInputId="commitInputId",this._renderFooter=(()=>{const e=this.props.saveAndRun?oe.SaveAndRunButtonLabel:oe.SaveButtonLabel,t=!(this.props.isSaving||this.props.isRunning),i={className:"primary-action-button",disabled:!this._isValidInput(),onClick:this._onSaveClick,primary:!0,text:e},s={onClick:this.props.onDismiss,text:oe.Cancel},r=t?this.props.showCancelButton?[s,i]:[i]:void 0,a=this.props.isSaving?oe.SavingChanges:oe.CreatingPipeline;return d.createElement(T.PanelFooter,{buttonProps:r},!t&&d.createElement("div",{className:"ci-designer-save-panel-footer flex-row justify-end"},d.createElement(k.Spinner,{className:"loading-indicator",orientation:0,label:a})))}),this._checkMessage=(()=>{0===this.state.message.length&&this.setState({message:oe.SavePanelCommitMessage})}),this._setMessage=((e,t)=>{this.setState({message:t})}),this._setDescription=((e,t)=>{this.setState({description:t})}),this._checkNewBranchName=(()=>{0===this.state.newBranchName.length&&this.setState({newBranchName:oe.SavePanelNewBranchName})}),this._setNewBranchName=((e,t)=>{this.setState({newBranchName:t,newBranchNameErrorMessage:this._getBranchNameValidationError(t)})}),this._onCommitToOptionSelect=(e=>{this.setState({createNewBranch:e===i.NewBranch})}),this._onCreatePullRequestToggle=(()=>{this.setState({createPullRequest:!this.state.createPullRequest})}),this._onSaveClick=(()=>{this.props.onSave({description:this.state.description.trim(),createNewBranch:this.state.createNewBranch,message:this.state.message.trim(),newBranchName:this.state.createNewBranch?this.state.newBranchName.trim():"",createPullRequest:this.state.createNewBranch&&this.props.canCreatePr&&this.state.createPullRequest})}),this.state={message:this.props.commitMessage||oe.SavePanelCommitMessage,description:"",createNewBranch:!1,newBranchName:oe.SavePanelNewBranchName,newBranchNameErrorMessage:"",createPullRequest:!0}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.defaultBranch&&e.defaultBranch!==this.props.defaultBranch&&this.setState({createNewBranch:!1,newBranchNameErrorMessage:this._getBranchNameValidationError(this.state.newBranchName)})}render(){const e=this.props.saveAndRun?oe.SavePanelTitleSaveAndRun:oe.SavePanelTitleSave,t=this.props.filesAdded&&this.props.filesAdded.length>1?"":c.format(oe.SavePanelDescription,this.props.fileName);return d.createElement("div",null,this.props.isOpen&&d.createElement(T.CustomPanel,{ariaLabel:e,size:1,onDismiss:this.props.onDismiss,lightDismiss:!this.props.isSaving,defaultActiveElement:V.getSafeIdSelector(this._commitInputId)},d.createElement(T.PanelHeader,{titleProps:{text:e,size:1},description:t,onDismiss:this.props.onDismiss}),d.createElement(T.PanelContent,null,this._renderBody()),this._renderFooter()))}_renderBody(){const e=this.props.isSaving||this.props.isRunning,t=this._normalizeBranchName(this.props.defaultBranch),s=c.format(oe.SavePanelCommitToDefault,t),r=oe.SavePanelCommitToNewBranch,a=c.format(oe.SavePanelNewBranchMessage,t);return d.createElement("div",{className:"ci-designer-save-panel-body flex-grow"},this.props.errorMessage&&d.createElement(y.MessageCard,{className:"error-message",severity:"Error"},this.props.errorMessage),d.createElement(N.TextField,{className:"commit-message section-content",inputId:this._commitInputId,label:oe.CommitMessage,disabled:e,value:this.state.message,onBlur:this._checkMessage,onChange:this._setMessage}),d.createElement(N.TextField,{className:"commit-description section-content",label:oe.OptionalExtendedDescription,ariaLabel:oe.OptionalExtendedDescription,disabled:e,placeholder:oe.SavePanelCommitDescriptionPlaceholder,value:this.state.description,multiline:!0,rows:6,resizable:!1,onChange:this._setDescription}),this.props.filesAdded&&this.props.filesAdded.length>1&&d.createElement(he.FileList,{files:this.props.filesAdded}),d.createElement(B.RadioButtonGroup,{className:"commit-to",selectedButtonId:this.state.createNewBranch?i.NewBranch:i.DefaultBranch,onSelect:this._onCommitToOptionSelect},[d.createElement(B.RadioButton,{id:i.DefaultBranch,key:i.DefaultBranch,text:s,disabled:e}),d.createElement(B.RadioButton,{id:i.NewBranch,key:i.NewBranch,text:r,disabled:e})]),this.state.createNewBranch&&d.createElement("div",{className:"commit-new-branch"},d.createElement(x.FormItem,{message:this.state.newBranchNameErrorMessage||a,error:!!this.state.newBranchNameErrorMessage},d.createElement(N.TextField,{disabled:e||!this.state.createNewBranch,value:this.state.newBranchName,onBlur:this._checkNewBranchName,onChange:this._setNewBranchName})),this.props.canCreatePr&&d.createElement(w.Checkbox,{className:"margin-top-8",disabled:e||!this.state.createNewBranch,label:oe.SavePanelCreatePullRequest,checked:this.state.createPullRequest,onChange:this._onCreatePullRequestToggle})))}_normalizeBranchName(e){return e&&e.startsWith("refs/heads/")?e.substring("refs/heads/".length):e}_isValidInput(){return this.state.message.length>0&&!(this.state.createNewBranch&&(!this.state.newBranchName||this.state.newBranchNameErrorMessage))}_getBranchNameValidationError(e){if(!e||0===e.length)return"";if(("refs/heads/"+e).length>this._maxGitRefNameLength)return c.format(oe.BranchNameErrorTooLong,this._maxGitRefNameLength);const t=this._normalizeBranchName(this.props.defaultBranch);if(c.equals(e,t,!0))return oe.BranchNameErrorSameAsTarget;let i=null;return this._invalidRefNameStrings.some(t=>e.indexOf(t)>-1&&(i=t,!0)),i?c.format(oe.BranchNameErrorInvalidCharacter,i):(this._invalidLeadNameStrings.some(t=>0===e.lastIndexOf(t,0)&&(i=t,!0)),i?c.format(oe.BranchNameErrorInvalidLeadCharacter,i):(this._invalidTrailNameStrings.some(t=>{const s=e.length-t.length;return s>=0&&e.indexOf(t,s)===s&&(i=t,!0)}),i?c.format(oe.BranchNameErrorInvalidTrailCharacter,i):""))}}}(),function(e){fe=t.YamlEditor={},Object.defineProperty(t,"__esModule",{value:!0});t.YamlEditor.YamlEditor=class extends u.VssComponent{constructor(e,t){super(e,t),this._disposables=[],this._onEditorCreated=(e=>{e&&(this._editor=e,this._disposables.push(this._editor),this.props.onEditorCreated&&this.props.onEditorCreated(e),this.setState({isEditorLoaded:!0},()=>{this._editor&&this._editor.layout()}))}),this._onResizeHandler=(()=>{this._editor&&this._editor.layout()}),this._onThemeChanged=(()=>{const e=this._getEditorTheme();this.setState({monacoTheme:e})}),this.state={isEditorLoaded:!1,monacoTheme:this._getEditorTheme()}}render(){return d.createElement(d.Fragment,null,this.props.spinnerMessage?this._getSpinner(this.props.spinnerMessage):d.createElement(d.Fragment,null,d.createElement(i,{content:this.props.content,errorMessage:this.props.errorMessage,isReadOnly:this.props.isReadOnly,elementToFocusOnEscape:this.props.elementToFocusOnEscape,monacoTheme:this.state.monacoTheme,onEditorContentUpdated:this.props.onEditorContentUpdated,onEditorCreated:this._onEditorCreated}),!this.state.isEditorLoaded&&this._getSpinner(oe.LoadingEditor)),this.state.isEditorLoaded&&d.createElement(u.WrappedComponent,{dependencies:["ms.vss-build-web.pipelines-language"],wrappedType:"azure-pipelines-language-component",pageContext:this.context.pageContext,editor:this._editor,enableCodeLens:this.props.enableCodeLens,onEditTask:this.props.openSidePanel}))}componentDidMount(){window.addEventListener("resize",this._onResizeHandler),this._themeService.subscribe(this._onThemeChanged,"themeChanged")}componentWillUnmount(){window.removeEventListener("resize",this._onResizeHandler),this._themeService.unsubscribe(this._onThemeChanged,"themeChanged"),this._editor&&(this.props.onEditorDisposing&&this.props.onEditorDisposing(this._editor),this._disposables.forEach(e=>e.dispose()),this._editor=void 0)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._editor&&this.props.sidePanelIsOpen!==e.sidePanelIsOpen&&(this._editor.updateOptions({minimap:{enabled:!this.props.sidePanelIsOpen}}),this._editor.layout())}_getSpinner(e){return d.createElement(k.Spinner,{className:"absolute-fill",size:"large",label:e})}_getEditorTheme(){const e=this._themeService.getCurrentTheme();return e&&e.isDark?"vs-dark":"vs"}get _themeService(){return this.context.pageContext.getService("IVssThemeService")}};class i extends d.PureComponent{constructor(e){super(e),this._editorOptions=Object.assign(Object.assign({fontSize:14,lineNumbersMinChars:8,readOnly:this.props.isReadOnly,renderWhitespace:"all",fixedOverflowWidgets:!0,quickSuggestions:{comments:!1,strings:!0,other:!0},quickSuggestionsDelay:200,suggestOnTriggerCharacters:!0},{wordBasedSuggestions:!1}),{minimap:{enabled:!1}})}render(){const e=Object.assign(Object.assign({},this._editorOptions),{readOnly:this.props.isReadOnly});return d.createElement(u.WrappedComponent,{dependencies:["ms.vss-features.editor"],wrappedType:"code-editor",wrappedProps:{className:"ci-editor-host"+(this.props.errorMessage?" ci-show-error":""),monacoTheme:this.props.monacoTheme,editorOptions:e,elementToFocusOnEscape:this.props.elementToFocusOnEscape,editorRef:this.props.onEditorCreated,onContentUpdated:this.props.onEditorContentUpdated,content:{content:this.props.content,contentType:"application/x-yaml"}}})}}}(),function(e){function i(){const e=document.querySelector("."+le.EditorConstants.YamlAssistantToggleElement);e&&e.focus&&!e.hasAttribute("disabled")&&!e.classList.contains("disabled")&&"hidden"!==e.style.visibility&&"none"!==e.style.display&&e.focus()}ye=t.YamlEditorHeader={},Object.defineProperty(t,"__esModule",{value:!0}),t.YamlEditorHeader.focusYamlAssistantButton=i;t.YamlEditorHeader.YamlEditorHeader=class extends d.Component{render(){const e=this.props,t=e.sidePanelIsOpen;return d.createElement("div",{className:"ci-yaml-editor-header flex-row absolute-fill"},this.props.fileName&&d.createElement(d.Fragment,null,this._getBranchPicker(),d.createElement("div",{className:"subheader-items flex-row flex-grow scroll-hidden"},this._getRepository(),d.createElement(s,{fileName:e.fileName,fileUrl:e.fileUrl,supportsFPS:e.supportFPS,isYamlDirty:e.isYamlDirty,onFileNameChanged:e.onFileNameChanged})),!t&&d.createElement(O.HeaderCommandBar,{items:[{id:"show-hide-tasks",className:u.css("show-yaml-side-panel-button",le.EditorConstants.YamlAssistantToggleElement),text:t?"":oe.SidePanelOpen,onActivate:e.onSidePanelButtonClick,important:!0,iconProps:{iconName:t?"ClosePane":"OpenPane"},subtle:!0}]})))}_getBranchPicker(){const e=this.props.definition&&this.props.definition.repository;if(e)return d.createElement(A.BranchDropdown,{className:"branch-picker",ariaLabel:oe.Branch,repositoryType:e.type,repositoryId:e.id,defaultBranch:this.props.branchName,connectionId:e.properties&&e.properties.connectedServiceId,isDrodownFullWidth:!1,comboBoxMinWidth:120,comboBoxMaxWidth:350,onBranchSelected:this.props.onBranchSelected,onError:this.props.onBranchPickerError})}_getRepository(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"subheader-item ci-hover-behavior flex-row flex-center"},this.props.repositoryIconName&&d.createElement(U.VssIcon,{iconName:this.props.repositoryIconName}),d.createElement(D.Tooltip,{text:this.props.repositoryName,overflowOnly:!0},this.props.repositoryUrl?d.createElement(g.FPSLink,{className:"repository-name text-ellipsis",supportsFPS:this.props.supportFPS,href:this.props.repositoryUrl},this.props.repositoryName):d.createElement("span",{className:"repository-name text-ellipsis"},this.props.repositoryName))),d.createElement("div",{className:"flex-row flex-center"},d.createElement("span",{className:"separator"},"/")))}};class s extends d.Component{constructor(e){super(e),this._textField=d.createRef(),this._textDiv=d.createRef(),this._editModeOn=(()=>{this.setState({isEditMode:!0},()=>{this._textField.current&&this._textField.current.select()})}),this._editModeOff=((e,t)=>{const i=e?void 0:this.state.errorMessage,s=e?this.props.fileName:this._cleanupFileName(this.state.fileName);i||this.setState({fileName:s,errorMessage:i,isEditMode:!1},()=>{this.props.onFileNameChanged&&s!==this.props.fileName&&this.props.onFileNameChanged(s),t&&t()})}),this._onKeyDown=(e=>{if(13===e.which||27===e.which){e.preventDefault(),e.stopPropagation();const t=27===e.which;this._editModeOff(t,i)}}),this._onFilePathChanged=((e,t)=>{const i=de.getInvalidFileNameMessage(t);this.setState({fileName:t,errorMessage:i})}),this.state={isEditMode:!1,fileName:e.fileName}}render(){return d.createElement(d.Fragment,null,this.state.isEditMode?this._renderFilePathTextField():this._renderFilePath())}_renderFilePathTextField(){return d.createElement("div",{ref:this._textDiv,className:"flex-grow"},d.createElement(x.FormItem,{error:!!this.state.errorMessage,className:"flex-grow"},d.createElement(N.TextField,{containerClassName:"file-path-text flex-grow",className:"editable-file-path",value:this.state.fileName,autoFocus:!0,ref:this._textField,onChange:this._onFilePathChanged,onKeyDown:this._onKeyDown,onBlur:this._editModeOff})),this.state.errorMessage&&d.createElement(M.Callout,{contentShadow:!0,anchorElement:this._textDiv.current,anchorOrigin:{horizontal:"start",vertical:"end"},calloutOrigin:{horizontal:"start",vertical:"start"},anchorOffset:{horizontal:8,vertical:4}},d.createElement("div",{className:"file-path-error"},this.state.errorMessage)))}_renderFilePath(){let e=this.props.fileName;e=(e=(e=e.replace("\\","/")).startsWith("./")?e.substr(2):e).startsWith("/")?e.substr(1):e;const t=this.props.isYamlDirty?" *":"",i=e.lastIndexOf("/"),s=i>0?e.substr(0,i):"",r=(i>0?e.substr(i+1):e)+t,a=!!this.props.onFileNameChanged;return d.createElement(D.Tooltip,{text:a?oe.Rename:void 0},d.createElement("div",Object.assign({className:u.css("editable-path-container flex-center flex-row text-ellipsis",a&&"editable")},a?{tabIndex:0,onClick:this._editModeOn,onFocus:this._editModeOn}:{}),s&&d.createElement(d.Fragment,null,d.createElement("div",{className:"file-path flex-row flex-center"},d.createElement(D.Tooltip,{text:e,overflowOnly:!0},d.createElement("span",{className:"text-ellipsis white-space-pre"},s))),d.createElement("div",{className:"flex-row flex-center"},"/")),d.createElement("div",{className:"subheader-item ci-hover-behavior flex-row flex-center"},d.createElement(D.Tooltip,{text:e,overflowOnly:!0},d.createElement(d.Fragment,null,this.props.fileUrl?d.createElement(g.FPSLink,{className:"file-name text-ellipsis",supportsFPS:this.props.supportsFPS,href:this.props.fileUrl},r):d.createElement("span",{className:"file-name text-ellipsis"},r),a&&d.createElement(p.Icon,{className:"rename-icon",iconName:"Rename",size:"medium"}))))))}_cleanupFileName(e){return e=de.trimFilePath(e),e=de.trimLeadingSlashes(e),de.ensureYamlExtension(e)}}}(),function(e){_e=t.YamlSidePanel={},Object.defineProperty(t,"__esModule",{value:!0});const i=["ms.vss-build-web.designer-extensions.yaml-assistant","ms.vss-build-web.yaml-assistant-data-provider"];t.YamlSidePanel.YamlSidePanel=class extends u.VssComponent{constructor(){super(...arguments),this._onYamlGenerated=(e=>{let t="";switch(e.eventType){case 0:default:t=oe.AddedSnippet}this._insertText(e.yamlString,t)}),this._insertText=((e,t)=>{e.lastIndexOf("\r\n")===e.length-2&&(e=e.substr(0,e.length-2));const i=e.split("\r\n"),s=this.props.editor.getSelection(),r=i.length,a=i[r-1].length+1,n=this.props.editor.getModel().getLineContent(s.startLineNumber);s.startColumn===s.endColumn&&s.startLineNumber===s.endLineNumber?/\S/.test(n)?this._moveCursorToEndOfLineAndInsert(e,t,s,r,a):this._insertWhilePreservingTabDepth(e,i,t,n,s,r,a):s.startLineNumber!==s.endLineNumber&&1===s.startColumn&&n.indexOf(i[0])>=0?this._replaceTask(e,i,t,n,s,a):this._replaceCurrentlySelectedText(e,t,s,r,a)})}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),this.props.editor&&!this._yamlAssistantDependenciesPromise){const e=this.context.pageContext.getService("IVssContributionService");this._yamlAssistantDependenciesPromise=e.getContributionsAsync(i)}}render(){return this.props.isOpen&&this.props.editor?d.createElement("div",{className:V.css("flex-noshrink flex-column yaml-side-panel",!this.props.isOpen&&"hidden")},d.createElement(u.WrappedComponent,{dependencies:i,wrappedType:"yaml-assistant-view",wrappedProps:{onYamlGenerated:this._onYamlGenerated,onDismiss:this.props.onDismiss}})):null}_moveCursorToEndOfLineAndInsert(e,t,i,s,r){const a=this.props.editor.getModel().getLineMaxColumn(i.startLineNumber);e="\r\n"+e;const n=this._createRange(i.startLineNumber,a,i.startLineNumber,a),o=this._createSelection(i.startLineNumber+1,1,i.startLineNumber+s,r+1);this._insertTextToMonaco(e,t,n,o)}_insertWhilePreservingTabDepth(e,t,i,s,r,a,n){const o=this.props.editor.getModel().getLineMaxColumn(r.startLineNumber),l=s.substr(0,r.startColumn-1);e=t.join("\r\n"+l);const c=this._createRange(r.startLineNumber,r.startColumn,r.endLineNumber,o),d=this._createSelection(r.startLineNumber,1,r.startLineNumber+a-1,n+l.length+1);this._insertTextToMonaco(e,i,c,d)}_replaceTask(e,t,i,s,r,a){const n=s.trim(),o=s.substr(0,s.indexOf(n[0]));e=o+t.slice(1).join("\r\n"+o);let l=-1,c=-1;const d=this.props.editor.getModel(),p=o+"  ";for(let e=r.startLineNumber;e<=r.endLineNumber;++e)if(d.getLineContent(e)===p+"inputs:")l=e;else if(l>0){const t=d.getLineContent(e),i=t.trim();if(t.substr(0,t.indexOf(i[0]))===p){c=e-1;break}}-1===l&&(l=r.startLineNumber),-1===c&&(c=r.endLineNumber);const h=this._createRange(l,1,c,d.getLineMaxColumn(c)),m=t.length-1-(c-l+1),u=r.endLineNumber-r.startLineNumber+1,g=this._createSelection(r.startLineNumber,r.startColumn,r.startLineNumber+u+m-1,9999);this._insertTextToMonaco(e,i,h,g)}_replaceCurrentlySelectedText(e,t,i,s,r){const a=this._createRange(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn),n=this._createSelection(i.startLineNumber,i.startColumn,i.startLineNumber+s-1,r+1);this._insertTextToMonaco(e,t,a,n)}_insertTextToMonaco(e,t,i,s){const r={identifier:{major:1,minor:1},range:i,text:e,forceMoveMarkers:!0};this.props.editor.executeEdits(t,[r],[s]),this.props.editor.focus(),this._sendToast(t)}_sendToast(e){const t=this.context&&this.context.pageContext.getService("IGlobalMessagesService");t&&t.addToast({message:e,duration:2e3})}_createRange(e,t,i,s){return new monaco.Range(e,t,i,s)}_createSelection(e,t,i,s){return new monaco.Selection(e,t,i,s)}}}(),function(e){Ce=t.YamlTab={},Object.defineProperty(t,"__esModule",{value:!0});t.YamlTab.YamlTab=class extends u.VssComponent{constructor(e,t){super(e,t),this._onEditorContentUpdated=(e=>{if(e&&this.props.onContentUpdated){const t=e.getValue()||"";this.props.onContentUpdated(t)}}),this._onSidePanelButtonClick=(()=>{this.setState(e=>({sidePanelIsOpen:!e.sidePanelIsOpen}),()=>{ye.focusYamlAssistantButton()})}),this._openSidePanel=(()=>{this.state.sidePanelIsOpen||this.setState({sidePanelIsOpen:!0})}),this.state={sidePanelIsOpen:e.sidePanelInitiallyOpen}}render(){const e=this.props;return d.createElement("div",{className:"ci-yaml-editor-tab flex-grow flex-row"},d.createElement("div",{className:"flex-row absolute-fill"},d.createElement("div",{className:"flex-column flex-grow relative"},d.createElement("div",{className:"ci-yaml-header-container relative"},d.createElement(ye.YamlEditorHeader,{branchName:e.branchName,definition:e.definition,fileName:e.fileName,fileUrl:e.fileUrl,repositoryIconName:e.repositoryIconName,repositoryName:e.repositoryName,repositoryUrl:e.repositoryUrl,supportFPS:e.supportFPS,sidePanelIsOpen:this.state.sidePanelIsOpen,isYamlDirty:e.isYamlDirty,onBranchSelected:e.onBranchSelected,onBranchPickerError:e.onBranchPickerError,onSidePanelButtonClick:this._onSidePanelButtonClick,onFileNameChanged:this.props.onFileNameChanged})),d.createElement("div",{className:"relative flex-grow"},d.createElement("div",{className:"absolute-fill"},d.createElement(fe.YamlEditor,{content:e.content,spinnerMessage:e.spinnerMessage,errorMessage:"",isReadOnly:!1,elementToFocusOnEscape:"."+le.EditorConstants.ElementToFocusOnEscape,onEditorContentUpdated:this._onEditorContentUpdated,onEditorCreated:e.onEditorCreated,onEditorDisposing:e.onEditorDisposing,sidePanelIsOpen:this.state.sidePanelIsOpen,openSidePanel:this._openSidePanel,enableCodeLens:!0})))),d.createElement(_e.YamlSidePanel,{editor:e.editor,isOpen:this.state.sidePanelIsOpen,onDismiss:this._onSidePanelButtonClick})))}}}(),function(e){t.EditorView={},Object.defineProperty(t,"__esModule",{value:!0});const s="pipeline-editor-view bolt-page-grey flex-column flex-grow",r="hosted-mac-warning",o="https://go.microsoft.com/fwlink/?linkid=870426";u.Components.add("ci-designer-editor-view",class extends u.VssComponent{constructor(e,t){super(e,t),this._ttiRecorded=!1,this._lastCleanContent="",this._authorizeAfterSave=!1,this._onNavigateAway=(e=>{(this.state.isYamlDirty||this.state.isPipelineSaving)&&ge.showLoseChangesDialog(this.context.pageContext,e)}),this._clearBuildMessage=(()=>{this.state.buildMessageInfo&&this.setState({buildMessageInfo:void 0},this._resizeEditor)}),this._clearErrorMessage=(()=>{this.state.errorMessage&&this.setState({errorMessage:"",errorActions:void 0},this._resizeEditor)}),this._closeConnectionCard=(()=>{this.setState({useAppConnectionAction:void 0},this._resizeEditor)}),this._switchToAppConnection=(async e=>{const t=this.state.definition;t.repository.properties=t.repository.properties||[],t.repository.properties.connectedServiceId=e,this._closeConnectionCard(),this.setState({isPipelineSaving:!0,settingsErrorMessage:""});try{await this.pipelineService.savePipeline(t);const e=this.context.pageContext.getService("IVssContributionService");await e.getDataAsync("ms.vss-build-web.pipeline-edit-continuation-data-provider",{complete:!0},!0),this.setState({definition:t,isPipelineSaving:!1},this._closeConnectionCard),this.state.connection.autoUpgradeToAppConnection||this.globalMessageService.addToast({message:oe.ConnectionChanged,duration:le.EditorConstants.ToastDuration})}catch(e){const t=e&&e.message||n.SavePipelineErrorMessage;this._handleSettingsError(t)}}),this._installApp=(async(e,t,i,s)=>{this.context.pageContext.getService("IInstallAppService").installAppForEdit(e,t,i,s)}),this._onEditorCreated=(e=>{e&&(this._editor=e,e.focus(),this.setState({isEditorReady:!0}),this._markTimeToInteractive())}),this._onEditorDisposing=(e=>{let t="";e&&(t=e.getValue()||""),this._editor=null,this.setState({yamlContent:t,isEditorReady:!1})}),this._resizeEditor=(()=>{this._editor&&this._editor.layout()}),this._onYamlContentUpdated=(e=>{this.state.yamlContent!==e&&this.setState({yamlContent:e,isYamlDirty:e!==this._lastCleanContent})}),this._showSavePanel=(()=>{const e=this._editor&&this._editor.getValue()||this.state.yamlContent||"";this.setState({yamlContent:e,savePanelIsOpen:!0,isYamlSaving:!1})}),this._onYamlSave=(e=>{if(this.state.definition){this.setState({isYamlSaving:!0,saveErrorMessage:""});const t=this.state.definition,i={connectionId:this.state.connection.connectionId,id:t.repository.id,sourceProviderType:t.repository.type};this.yamlFileService.commitFile(i,this.state.yamlBranch,t.process.yamlFilename,this.state.yamlContent,e,this.state.yamlFileObjectId).then(e=>{this._lastCleanContent=this.state.yamlContent;const t=this._authorizeAfterSave?this._authorizeAndRun:void 0;this.setState({isYamlDirty:!1,isYamlSaving:!1,yamlBranch:e.branch,yamlFileObjectId:e.objectId,yamlFileUrl:e.url},()=>{this._dismissSavePanel(),this._updateUrl(),t&&t()})},e=>{this._handleYamlSaveError(e.message)}).then(()=>{this._checkForHostedMac()})}}),this._dismissSavePanel=(()=>{this.state.isYamlSaving||(this._authorizeAfterSave=!1,this.setState({saveErrorMessage:"",savePanelIsOpen:!1}))}),this._showRunPanel=(()=>{this.setState({runPanelIsOpen:!0})}),this._runBuild=(()=>{this.state.definition&&(this._onRunBuild(),this._onBuildQueuing(),this.pipelineService.runPipeline(this.state.definition,this.state.yamlBranch).then(this._onBuildQueued,e=>{this._handleRunBuildError(e)}))}),this._runBuildWithParameters=(()=>{if(!this.state.definition)return;this._onRunBuild();const e=this.state.definition;this.layoutManager.renderCallout(t=>{this._onQueueDialogDismiss=t;const i={definition:e,repository:e.repository,processType:e.process.type,pageContext:this.context.pageContext,project:e.project.id,source:"yamlEditor",onSuccess:this._onBuildQueued,onClosed:this._onQueueBuildDialogClosed,definitionVariables:e.variables,queue:e.queue,defaultSourceBranch:this.state.yamlBranch,onDismiss:t};return d.createElement(z.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent"},i),null)})}),this._fullYaml=(async()=>{if(!this.state.definition)return;const e=this.state.definition.name.concat(".yml");try{const t=await this._getYaml(this.state.definition);this._downloadFile(e,t.finalYaml)}catch(t){this.setState({validationDialogOpen:!0,validationDialogMessage:t.message}),this._downloadFile(e,t.message)}}),this._validateYaml=(async()=>{if(this.state.definition)try{await this._getYaml(this.state.definition),this.setState({validationDialogOpen:!0,validationDialogMessage:oe.OK})}catch(e){this.setState({validationDialogOpen:!0,validationDialogMessage:e.message})}}),this._getYaml=(async e=>{const t={stagesToSkip:void 0,resources:{pipelines:{},repositories:{refName:this.state.yamlBranch}},templateParameters:{},variables:e.variables,previewRun:!0,yamlOverride:this.state.yamlContent};return this.context.pageContext.getRestClient("IPipelinesRestClient").runPipeline(t,e.project.id,e.id)}),this._onBuildQueued=(e=>{if(e){const t={id:e.id,number:e.buildNumber};this.setState({buildMessageInfo:t,isBuildRunning:!1},this._resizeEditor)}else this._handleRunBuildError()}),this._onQueueBuildDialogClosed=(()=>{if(this._onQueueDialogDismiss){const e=this._onQueueDialogDismiss;this._onQueueDialogDismiss=void 0,e()}this.state.isBuildRunning&&this.setState({isBuildRunning:!1})}),this._onRunPanelClosed=(()=>{this.setState({runPanelIsOpen:!1})}),this._autoAuthorizeResources=(()=>this.context.pageContext.getService("IPipelineResourcesService").autoAuthorizeResources(this.state.definition.id,this.state.yamlBranch).then(e=>{},e=>{console.warn("YAML editor: Error while auto-authorizing resources: "+e&&e.message)})),this._authorizeAndRun=(()=>{this._clearErrorMessage(),this.state.isYamlDirty?(this._authorizeAfterSave=!0,this._showSavePanel()):this._autoAuthorizeResources().then(()=>this._runBuild())}),this._showPipelineSettingsPanel=(()=>{this.setState({settingsPanelIsOpen:!0})}),this._onSavePipelineSettings=(e=>{if(!e||!Object.keys(e).length)return;let t=!1;const i=[],s=Object.assign({},this.state.definition);if(this.setState({isPipelineSaving:!0,settingsErrorMessage:""}),void 0!==e.status)switch(s.queueStatus=e.status,e.status){case 2:i.push(n.SavePipelineCommentDisable);break;case 0:i.push(n.SavePipelineCommentEnable);break;case 1:i.push(n.SavePipelineCommentPause);break;default:i.push(n.SavePipelineCommentUnknownStatus)}if(void 0!==e.yamlFilePath){t=!0;const r=Object.assign({},s.process);r.yamlFilename=e.yamlFilePath,s.process=r,i.push(c.format(n.SavePipelineCommentYamlFile,e.yamlFilePath))}if(void 0!==e.witLinkingEnabled||e.witLinkingBranchFilter){s.options||(s.options=[]);let t=s.options.filter(e=>c.equals(e.definition.id,Y.BuildOptionGUIDs.WitLinkingOptionGUID))[0];e.witLinkingBranchFilter&&(i.push(c.format(n.SavePipelineCommentUpdateAutoLinkBranch,e.witLinkingBranchFilter)),t?t.inputs={branchFilters:JSON.stringify([e.witLinkingBranchFilter])}:(t={definition:{id:Y.BuildOptionGUIDs.WitLinkingOptionGUID},inputs:{branchFilters:JSON.stringify([e.witLinkingBranchFilter])},enabled:!0},s.options.push(t))),void 0!==e.witLinkingEnabled&&t&&(i.push(c.format(n.SavePipelineCommentEnableAutoLink,e.witLinkingEnabled)),t.enabled=e.witLinkingEnabled)}s.comment=i.join(". "),this.pipelineService.savePipeline(s).then(e=>{this._showPipelineSavedToast(),t?this.setState({isYamlDirty:!1,isPipelineSaving:!1},()=>a.FastPageSwitch(this.context.pageContext,window.location.href,!1)):this.setState({definition:e,isPipelineSaving:!1},this._dismissPipelineSettingsPanel)},e=>{const t=e&&e.message||n.SavePipelineErrorMessage;this._handleSettingsError(t)})}),this._dismissPipelineSettingsPanel=(()=>{this.state.isPipelineSaving||this.setState({settingsPanelIsOpen:!1,settingsErrorMessage:"",isPipelineSaving:!1})}),this._handleSettingsError=(e=>{this.setState({settingsErrorMessage:e,isPipelineSaving:!1,settingsPanelIsOpen:!0})}),this._showPipelineVariablesPanel=(()=>{this.setState({variablesPanelIsOpen:!0})}),this._dismissPipelineVariablesPanel=(()=>{this.state.isPipelineSaving||this.setState({variablesPanelIsOpen:!1,variablesErrorMessage:"",isPipelineSaving:!1})}),this._onSavePipelineVariables=(e=>{const t=[],i=Object.assign({},this.state.definition);this.setState({isPipelineSaving:!0,variablesErrorMessage:""}),i.variables=e,t.push(oe.VariablesPanelSaveComment),i.comment=t.join(". "),this.pipelineService.savePipeline(i).then(e=>{this._showPipelineSavedToast(),this.setState({definition:e,isPipelineSaving:!1},this._dismissPipelineVariablesPanel)},e=>{const t=e&&e.message||n.SavePipelineErrorMessage;this._handleVariablesError(t)})}),this._handleVariablesError=(e=>{this.setState({variablesErrorMessage:e,isPipelineSaving:!1,variablesPanelIsOpen:!0})}),this._handleRunBuildError=(e=>{this.setState({isBuildRunning:!1});let t,i=e&&e.message||oe.RunBuildErrorMessage;const s=e;if(s&&s.serverError&&s.serverError.customProperties){const e=s.serverError.customProperties.ValidationResults;if(e&&e.length>0){const s="https://aka.ms/yamlauthz";(i+="\n"+e.map(e=>e.message).join("\n")).indexOf(s)>0&&(t=[{primary:!0,text:oe.AuthorizeAndRunButtonText,onClick:this._authorizeAndRun}])}}this._handleError(i,!0,t)}),this._handleError=((e,t,i)=>{this._clearBuildMessage(),this.setState({errorMessage:e,isErrorMessageDismissable:t,errorActions:i},this._resizeEditor)}),this._handleYamlSaveError=(e=>{this.setState({saveErrorMessage:e,isYamlSaving:!1,savePanelIsOpen:!0})}),this._markTimeToInteractive=(()=>{this._ttiRecorded||(this._ttiRecorded=!0,this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(ce.PerformanceConstants.Area,ce.PageLoadScenarios.YamlEditor))}),this._onChangeVariables=((e,t)=>{this.setState({isVariablesDirty:this._yamlResourceService.isVariablesChanged()})}),this._onBranchSelected=(e=>{e!==this.state.yamlBranch&&(this.state.isYamlDirty?this.layoutManager.renderCallout(t=>ge.getLoseChangesDialog(()=>{t(),this._switchBranch(e)},()=>{t()})):this._switchBranch(e))}),this._switchBranch=(e=>{this.setState({yamlContent:"",yamlFileObjectId:"",yamlBranch:e,yamlFileUrl:""}),this._clearErrorMessage();const t=this.historyService,i=t.generateUrl({branch:e});t.pushState(void 0,i);const s=this.state.definition,r=s.process.yamlFilename,a=s.repository,n={connectionId:a.properties&&a.properties.connectedServiceId,id:a.id,name:a.name,sourceProviderType:a.type};this.yamlFileService.getFileContentData(n,e,r).then(e=>{this._updateFileInfo(e)},t=>{this._updateFileInfo({content:"",branch:e,path:r,objectId:"",url:""}),this._handleError(t.message,!1)}).then(()=>{this._checkForHostedMac()})});const i={isEditorReady:!1,connection:{},savePanelIsOpen:!1,runPanelIsOpen:!1,isYamlSaving:!1,yamlContent:"",yamlFileUrl:"",yamlBranch:"",yamlFileObjectId:"",isYamlDirty:!1,errorMessage:"",isErrorMessageDismissable:!1,settingsPanelIsOpen:!1,variablesPanelIsOpen:!1,isPipelineSaving:!1,isBuildRunning:!1,useAppConnectionAction:void 0,authentication:{isLoginRequired:!1,shouldShowLandingPage:!1}},s=this.context.pageContext.getService("IVssContributionService"),r=s.getData("ms.vss-build-web.pipeline-editor-data-provider");if(r){if(this._lastCleanContent=r.content||"",i.definition=r.definition,i.yamlBranch=r.branch||(r.definition.repository.defaultBranch||"").replace("refs/heads/",""),i.yamlContent=r.content,i.yamlFileUrl=r.yamlFileUrl,i.yamlFileObjectId=r.objectId,i.errorMessage=r.fileErrorMessage,i.errorMessage){const e=i.definition.repository;c.equals(e.type,l.RepositoryTypes.TfsGit,!0)&&e.id&&e.name&&(i.errorMessage=i.errorMessage.replace(e.id,e.name))}if(i.authentication=r.authenticationRequirements,i.connection=r.serviceConnection||{},i.authentication.isLoginRequired){if(i.yamlBranch="",i.authentication.shouldShowLandingPage)i.errorMessage="";else{const e=me.getSourceProviderTile(this.context.pageContext,i.definition.repository.type.toLowerCase());this._sourceProviderName=e?e.name:""}i.authentication.loginUrl||(i.errorMessage=oe.LoginUrlNotSpecified)}}else{const e=s.getDataProviderExceptions()["ms.vss-build-web.pipeline-editor-data-provider"];this._handleEditorDataProviderError(e,i)}this._yamlResourceService=t.pageContext.getService("IYamlResourcesService"),this.state=i,i.yamlBranch&&i.yamlBranch!==this.historyService.getState().branch&&this._updateUrl()}componentDidMount(){super.componentDidMount(),z.prefetch(this.context.pageContext),this.navigationService.setPageTitle(this._getTitle()),this.breadcrumbService.setPipeline(this.state.definition),this.state.authentication.isLoginRequired&&!this.state.authentication.shouldShowLandingPage&&this.state.authentication.loginUrl?i.openLinkSecurely(this.state.authentication.loginUrl):(this._yamlResourceService.subscribe(this._onChangeVariables),ge.addNavigateAwayListener(this._onNavigateAway),this._checkForAppConnectionUpgrade()),this._checkForHostedMac()}componentWillUnmount(){super.componentWillUnmount(),this._yamlResourceService.unsubscribe(this._onChangeVariables),this.breadcrumbService.clearPipeline(),ge.removeNavigateAwayListener(this._onNavigateAway),W.clearTreeStateOnUnmount(this.context.pageContext)}render(){return this.state.definition?this._shouldShowLandingPage()?this._getAuthLandingPage():this._getEditorPage():this._getEmptyPage()}_shouldShowLandingPage(){return this.state.authentication.isLoginRequired&&this.state.authentication.shouldShowLandingPage}_getEmptyPage(){return d.createElement(q.Page,{className:s},this._getHeader())}_getAuthLandingPage(){const e=this.state.definition;return d.createElement(q.Page,{className:s},this._getHeader(),d.createElement(me.EditorAuthLandingPage,{loginUrl:this.state.authentication.loginUrl,yamlFileLink:this.state.yamlFileUrl,repository:e.repository,sourceProvider:this._getSourceProvider()}))}_getEditorPage(){const e=this.state.definition,t=e.process.yamlFilename,i=this._getFileName(t),r=i?c.format(oe.SavePanelCommitMessageForEdit,i):"",a=this._getSourceProvider(),n=!c.equals(e.repository.type,l.RepositoryTypes.Bitbucket,!0)||_.isFeatureFlagEnabled(this.context.pageContext,"Build2.BitbucketAzurePipelinesOAuthClient",!1);let o="";this.state.authentication.isLoginRequired&&(o=this._sourceProviderName?c.format(oe.AuthorizingWithProviderMessage,this._sourceProviderName):oe.AuthorizingMessage);const p={onDismiss:()=>{this.setState({validationDialogOpen:!1})},lightDismiss:!0,modal:!0,contentSize:3,titleProps:{text:oe.Validation},footerButtonProps:[{text:oe.OK,onClick:()=>{this.setState({validationDialogOpen:!1})},primary:!0}]};let h=e.repository&&e.repository.properties&&e.repository.properties.manageUrl;return h&&!h.toLowerCase().startsWith("http")&&(h=""),d.createElement(q.Page,{className:s},this._getHeader(),d.createElement(Ce.YamlTab,{content:this.state.yamlContent,editor:this._editor,spinnerMessage:o,onContentUpdated:this._onYamlContentUpdated,onEditorCreated:this._onEditorCreated,onEditorDisposing:this._onEditorDisposing,sidePanelInitiallyOpen:!0,repositoryName:e.repository.name,repositoryIconName:a.getRepoIconName(),repositoryUrl:h,branchName:this.state.yamlBranch,fileName:t,fileUrl:this.state.yamlFileUrl,supportFPS:c.equals(e.repository.type,l.RepositoryTypes.TfsGit,!0),isYamlDirty:this.state.isYamlDirty,definition:e,onBranchSelected:this._onBranchSelected}),d.createElement(be.SavePanel,{errorMessage:this.state.saveErrorMessage,fileName:t,commitMessage:r,defaultBranch:this.state.yamlBranch,isOpen:this.state.savePanelIsOpen,isSaving:this.state.isYamlSaving,saveAndRun:!1,canCreatePr:n,onSave:this._onYamlSave,onDismiss:this._dismissSavePanel,showCancelButton:!0}),this.state.runPanelIsOpen&&d.createElement(H.QueuePanel,{showPanel:this.state.runPanelIsOpen,pageContext:this.context.pageContext,projectId:e.project.id,definitionId:e.id,buildRepository:e.repository,sourceBranch:this.state.yamlBranch||"",runtimeVariables:this._getOverridableVariables(e.variables),onDismiss:this._onRunPanelClosed}),d.createElement(j.PipelineSettingsPanel,{key:e.revision,definition:e,branch:this.state.yamlBranch,isYamlDirty:this.state.isYamlDirty,errorMessage:this.state.settingsErrorMessage,isOpen:this.state.settingsPanelIsOpen,isSaving:this.state.isPipelineSaving,onSave:this._onSavePipelineSettings,onDismiss:this._dismissPipelineSettingsPanel,onError:e=>this.setState({settingsErrorMessage:e})}),this.state.variablesPanelIsOpen&&d.createElement(Se.PipelineVariablesPanel,{variables:e.variables,errorMessage:this.state.variablesErrorMessage,isSaving:this.state.isPipelineSaving,onSave:this._onSavePipelineVariables,onDismiss:this._dismissPipelineVariablesPanel}),this.state.validationDialogOpen&&d.createElement(P.Dialog,Object.assign({},p),this.state.validationDialogMessage))}_getOverridableVariables(e){return Object.keys(e||{}).filter(t=>e[t].allowOverride).map(t=>({name:t,variable:Object.assign({},e[t])}))}_getFileName(e){let t=e||"";const i=t.lastIndexOf("/")+1;return i>0&&t.length>i&&(t=t.substr(i)),t}_getHeader(){return d.createElement(d.Fragment,null,d.createElement(ue.EditorHeader,{definition:this.state.definition,isYamlDirty:this.state.isYamlDirty,actionButtonLabel:this.state.isYamlDirty?oe.SaveButtonLabel:oe.RunButtonLabel,actionDisabled:!!this.state.errorMessage||this.state.isBuildRunning||this.state.isPipelineSaving,onActionClick:this.state.isYamlDirty?this._showSavePanel:this._showRunPanel,onFullYaml:this._fullYaml,onRunWithParameters:this._runBuildWithParameters,onSettingsOpen:this._showPipelineSettingsPanel,onValidateYaml:this._validateYaml,onVariablesOpen:this._showPipelineVariablesPanel,buildMessageInfo:this.state.buildMessageInfo,onBuildMessageDismissed:this._clearBuildMessage,errorMessage:this.state.errorMessage,errorActions:this.state.errorActions,onErrorMessageDismissed:this.state.isErrorMessageDismissable?this._clearErrorMessage:void 0,title:this._getTitle()}),this._getAppUpgradeHeader())}_getAppUpgradeHeader(){return _.isFeatureFlagEnabled(this.context.pageContext,"Build2.SwitchToAppConnection",!1)&&this.state.useAppConnectionAction?d.createElement("div",{className:"page-content flex-row flex-noshrink"},d.createElement(y.MessageCard,{className:"flex-grow",severity:"Info",onDismiss:this._closeConnectionCard,buttonProps:[this.state.useAppConnectionAction]},d.createElement(v.FormatComponent,{format:this.state.useAppConnectionDescription},d.createElement(g.FPSLink,{href:this.state.connection.appHelpLink},this.state.connection.appName)))):d.createElement(d.Fragment,null)}async _checkForAppConnectionUpgrade(){if(_.isFeatureFlagEnabled(this.context.pageContext,"Build2.SwitchToAppConnection",!1)&&!this._shouldShowLandingPage()&&!this.state.connection.isAppConnection&&this.state.connection.appName)try{const e=this.state.definition,t=this.state.connection.nonce,i=await this._getRecommendedServiceConnection(e,t),s=i.commonConnectionId;if(s)if(this.state.connection.autoUpgradeToAppConnection)this._switchToAppConnection(s);else{const e={text:oe.ChangeToAppConnection,onClick:()=>this._switchToAppConnection(s)};this.setState({useAppConnectionAction:e,useAppConnectionDescription:oe.PreferAppConnectionChange})}else if(!i.appInstalledForRepository&&i.userCanInstall){const s={text:oe.InstallApp,onClick:()=>this._installApp(e.id,t,i.installAppUrlRoot,e.repository)};this.setState({useAppConnectionAction:s,useAppConnectionDescription:oe.PreferAppConnectionInstall})}}catch(e){this.context.pageContext.getService("IVssTelemetryService").publishEvent("Build","Editor.CheckForAppConnectionUpgradeError",{message:e&&e.message,error:e})}}_getRecommendedServiceConnection(e,t){const i=this.context.pageContext.getService("IVssContributionService"),s="ms.vss-build-web.app-serviceconnections-recommendation-data-provider",r={sourceProvider:this._getSourceProvider().getKey(),repositoryId:e.repository.id,repositoryName:e.repository.name,connectionId:this.state.connection.connectionId,strongBoxKey:"useWellKnownStrongBoxLocation",createOAuthConnectionIfNeeded:!1,login:this.state.connection.login};return i.getDataAsync(s,r,!0).then(e=>{if(!e){const e=i.getDataProviderExceptions()[s];throw new Error(e&&e.message)}return e})}_getSourceProvider(){const e=this.context.pageContext.getService("ISourceProviderService");return this.state.definition&&e.getSourceProvider(this.state.definition.repository.type)}_getTitle(){return this.state.definition&&this.state.definition.name||oe.EditorDefaultTitle}_updateUrl(){const e=this.historyService,t=e.generateUrl({branch:this.state.yamlBranch});e.replaceState(void 0,t)}_downloadFile(e,t){let i=new Blob([t],{type:"text/plain"});if(window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,e);else{let t=document.createElement("a");t.href=URL.createObjectURL(i),t.setAttribute("download",e),document.body.appendChild(t),t.click(),document.body.removeChild(t)}}_onRunBuild(){this.setState({isBuildRunning:!0}),this._clearErrorMessage(),this._clearBuildMessage()}_onBuildQueuing(){this.setState({buildMessageInfo:{id:-1,number:"",isQueuing:!0}},this._resizeEditor)}_showPipelineSavedToast(){this.globalMessageService.addToast({message:oe.PipelineSavedMessage,duration:le.EditorConstants.ToastDuration})}_handleEditorDataProviderError(e,t){let i,s=c.format(oe.EditorErrorDefaultPipelineFetch,e&&e.message||"");if(e&&e.exceptionType){const t=Number(this.historyService.getState().pipelineId);if(t>0){let r=!0;switch(e.exceptionType){case le.WellKnownExceptions.ServiceEndpointNotFoundException:s=c.format(oe.EditorErrorServiceConnection,e.message);break;case le.WellKnownExceptions.GitRepositoryNotFoundException:s=c.format(oe.EditorErrorGitRepoNotFound,e.message);break;case le.WellKnownExceptions.DefinitionTypeNotSupportedException:s=c.format(oe.EditorErrorNotYamlPipeline,e.message);break;default:r=!1}if(r){const e=this.buildLinkingService.getDefinitionEditUrl(t,le.LegacyDesignerTabKeys.Yaml);i=[{text:oe.EditInOldDesigner,href:e}]}}}t.errorMessage=s,t.errorActions=i}_updateFileInfo(e){this._lastCleanContent=e.content,this.setState({isYamlDirty:!1,isYamlSaving:!1,yamlBranch:e.branch,yamlFileObjectId:e.objectId,yamlContent:e.content,yamlFileUrl:e.url})}_checkForHostedMac(){if(this.state.definition){const e="ms.vss-build-web.check-for-hosted-mac-data-provider",t={pipelineId:this.state.definition.id,sourceBranch:this.state.yamlBranch};this.context.pageContext.getService("IVssContributionService").getDataAsync(e,t,!0).then(e=>{if(e)if(e.usingHostedMac){const e=this.globalMessageService.getBanner();if(!e||e.settingId!==r){const e={id:r,links:[{href:o,name:oe.LearnMore,supportsFPS:!1}],messageFormat:oe.HostedMacWarning};pe.showWarning(this.context.pageContext,e)}}else pe.clearWarning(this.context.pageContext,r)})}}get breadcrumbService(){return this.context.pageContext.getService("pipeline-editor-breadcrumb-service")}get buildLinkingService(){return this.context.pageContext.getService("IBuildLinkingService")}get historyService(){return this.context.pageContext.getService("IVssHistoryService")}get layoutManager(){return this.context.pageContext.getService("IVssLayoutManager")}get navigationService(){return this.context.pageContext.getService("ITfsNavigationService")}get pipelineService(){return this.context.pageContext.getService("IPipelineService")}get globalMessageService(){return this.context.pageContext.getService("IGlobalMessagesService")}get yamlFileService(){return this.context.pageContext.getService("IYamlFileService")}})}(),function(e){Pe=t.WizardList={},Object.defineProperty(t,"__esModule",{value:!0}),t.WizardList.WizardList=function(e){const t=new m.ArrayItemProvider(e.wizardListItems);return d.createElement(h.List,{className:"wizard-list",itemProvider:t,onActivate:e.onClick,singleClickActivation:!0,renderRow:(e,t,i,s)=>d.createElement(h.ListItem,{key:s||"list-item"+e,index:e,details:i},d.createElement("div",{className:"flex-row flex-grow cursor-pointer scroll-hidden"},(e=>e.iconUrl?d.createElement(f.Image,{className:u.css("list-image",e.iconClass),src:e.iconUrl,alt:e.iconAltText||""}):d.createElement(p.Icon,{className:u.css("list-icon",e.iconClass),iconName:e.iconName}))(t),d.createElement("div",{className:"list-content flex-column flex-grow scroll-hidden"},d.createElement("div",{className:"flex-row flex-grow flex-center"},d.createElement("span",{className:"body-m text-ellipsis"},t.name),(e=>{if(e&&e.labels)return d.createElement(G.PillGroup,{className:"flex-row flex-noshrink"},e.labels.map((e,t)=>d.createElement(K.Pill,{className:"list-item-label",size:0,key:t,excludeTabStop:!0,excludeFocusZone:!0},e)))})(t)),t.renderDescription?t.renderDescription():d.createElement("span",{className:"body-s secondary-text"},t.description)),t.isFavorite&&d.createElement(p.Icon,{className:"favorite-icon",iconName:"FavoriteStarFill"}))),width:"100%"})}}(),function(e){t.RepositorySelector={},Object.defineProperty(t,"__esModule",{value:!0});function i(e){const t=t=>e&&e[t];return{isFork:t("isFork"),isPrivate:t("isPrivate"),externalOwnerId:t("ownerId"),externalOwnerName:t("orgName"),externalOwnerIsAUser:t("ownerIsAUser"),repositoryUrl:t("manageUrl"),safeRepository:t("safeRepository"),hasAdminPermissions:t("hasAdminPermissions")}}function s(e,t){const i=e&&e.properties&&e.properties[t];return!(!i||"true"!==i.toLowerCase())}t.RepositorySelector.RepositorySelector=class extends u.VssComponent{constructor(e,t){super(e,t),this._filterBarRef=d.createRef(),this._ttiMarked=!1,this.getDescriptionMessage=(()=>this.state&&this.state.repositoryList&&this.state.repositoryList.continuationToken?oe.RepositorySelectorFetchingRepositories:""),this.renderProgressIndicator=(()=>d.createElement(d.Fragment,null,d.createElement(Q.ProgressIndicator,{className:"progress",progressHidden:!this.state.repositoryList,percentComplete:this._getPercentageOfRepositoriesLoaded()}),d.createElement("div",{className:"subheader"},this.getDescriptionMessage()))),this.renderRepositoryList=(()=>{const e=this._getFilteredRepositories();return d.createElement(Pe.WizardList,{wizardListItems:this._mapToWizardListItems(e),onClick:(t,s)=>{const r=e[s.index];this._onRepoSelected(r,i(r.properties))}})}),this._mapToWizardListItems=(e=>(e||[]).map(e=>{const t=[];let i;s(e,"isFork")&&t.push(oe.RepositorySelectorTagFork),s(e,"isPrivate")&&t.push(oe.RepositorySelectorTagPrivate);const r=e.properties&&e.properties.lastUpdated;return r&&(isNaN(Date.parse(r))?$.traceWarning(this.context.pageContext,"vss-build-web.designer","RepositorySelector",c.format("{0} repository lastUpdated property '{1}' is not a recognized date string",this.props.sourceProvider,r)):i=new Date(r)),{name:e.fullName,iconUrl:this.getRepositoryIconUrl(e),iconName:this.getRepositoryIconName(),iconClass:u.css("rounded-corners",this.getRepositoryIconClass()),labels:t,isFavorite:s(e,"isFavorite"),renderDescription:()=>i?d.createElement(Z.Ago,{className:"body-s secondary-text",date:i,format:0}):d.createElement(d.Fragment,null)}})),this._onFilterChanged=((e,t)=>{if(e.hasOwnProperty("filterText")){const t=e.filterText&&e.filterText.value||"",i=this._filterNoReposFound(this.state.repositories||[],t);this.setState({filterText:t,filterNoReposFound:i,footerText:this.getFooter(i,!(!this.state.repositoryList||!this.state.repositoryList.continuationToken))},()=>this.props.onRepositoryListUpdate("ReposFilter",{repoCount:this._getFilteredRepositories().length,filterText:t}))}if(e.hasOwnProperty("filterType")&&e.filterType&&e.filterType.value){const t=e.filterType&&e.filterType.value&&e.filterType.value[0];t&&t.key!==this.state.resultSet&&this.setState({resultSet:t.key,footerText:void 0},()=>{this._fetchRepositories()})}}),this._getFilterItems=(()=>this.state.filterTypes||this.getFilterItems()),this._getFilterItem=(e=>({name:e.displayName,key:e.key})),this._onRepositoryListReceived=((e,t)=>{if(this._mounted&&t===this.state.resultSet&&e){if(e.repositories&&this.props.autoSelectRepositoryId){const t=e.repositories.find(e=>e.id===this.props.autoSelectRepositoryId);if(t)return this.props.onSelectRepository(t,i(t.properties)),void this._markTTI()}const s={};let r=(this.state.repositories||[]).concat(e.repositories),a=void 0;if(e.continuationToken)this.listRepositories(this.state.projectId,this.props.sourceProvider,this.props.connectionId,this.state.resultSet,!0,e.continuationToken).then(e=>this._onRepositoryListReceived(e,t));else{this._updateFilterDropdown(t)&&(s.filterTypes=e.resultSets||this.getFilterItems(),s.filterTypes&&s.filterTypes.length>0&&(a=(()=>{const t=e.currentResults&&e.currentResults.key,i=s.filterTypes.find(e=>e.key===t)||this.state.resultSet,r={value:i&&[i]};this._filter.setDefaultState({filterType:r}),this._filter.setFilterItemState("filterType",r)}))),r=r.sort(this.compareRepositories);const i=this._filterNoReposFound(r,this.state.filterText||"");s.filterNoReposFound=i,s.footerText=this.getFooter(i,!1),this.props.onRepositoryListUpdate("ReposLoaded",{resultSet:t&&t.toString(),repoCount:r.length,duration:this._timer?(new Date).getTime()-this._timer.getTime():-1})}s.repositoryList=e,s.repositories=r,s.countRequests=this.state.countRequests+1,this.setState(s,a),this._markTTI()}}),this._onRepoSelected=((e,t)=>{this.props.onSelectRepository(e,t)}),this._getPercentageOfRepositoriesLoaded=(()=>{if(this.state&&this.state.repositoryList)return this.state.countRequests/this.state.repositoryList.totalPageCount}),this._getFilteredRepositories=(()=>this.state&&this.state.repositories?this.state.filterText?this._filterRepositories(this.state.repositories,this.state.filterText):this.state.repositories:[]),this._markTTI=(()=>{this.props.onTTI&&!this._ttiMarked&&(this._ttiMarked=!0,this.props.onTTI())}),this._client=this.context.pageContext.getRestClient("IBuildRestClient");const r=this.context.pageContext.getService("ITfsPageService").getData();this.state={projectId:r.project.id,projectName:r.project.name,countRequests:0,filterText:void 0,footerText:void 0,filterNoReposFound:!1,repositories:void 0,repositoryList:void 0,resultSet:1};const a=this.getFilterItems()[0];this._filter=new ie.Filter({defaultState:{filterType:{value:a?[a]:void 0}}}),this._filter.subscribe(this._onFilterChanged,ie.FILTER_CHANGE_EVENT)}render(){return d.createElement("div",{className:this.getClassName("repository-selection")},d.createElement("div",{className:"header-section"},d.createElement("div",{className:"subheader body-m secondary-text"},oe.NewPipeline),d.createElement("div",{className:"header title-l"},oe.RepositorySelectorTitle)),d.createElement(X.FilterBar,{filter:this._filter,ref:this._filterBarRef},d.createElement(te.KeywordFilterBarItem,{filterItemKey:"filterText",placeholder:oe.RepositorySelectorFilterPlaceholder,throttleWait:400}),this._showFilterDropdown()&&d.createElement(ee.PickListFilterBarItem,{filterItemKey:"filterType",getListItem:this._getFilterItem,getPickListItems:this._getFilterItems,selectionMode:J.SelectionMode.single})),this.state&&!this.state.repositoryList||this.state&&this.state.repositoryList&&this.state.repositoryList.continuationToken?this.renderProgressIndicator():this.renderRepositoryList(),this.state.footerText&&d.createElement("div",{className:"repository-picker-footer flex-row flex-start"},d.createElement("div",{className:"flex-self-start"},d.createElement(p.Icon,{iconName:"Error",className:"repository-picker-footer-icon"})),d.createElement("div",{className:"repository-picker-footer-text flex-grow scroll-hidden"},this.state.footerText)))}componentDidMount(){this._mounted=!0,this._fetchRepositories()}componentWillUnmount(){this._mounted=!1}getClassName(e){return e}getFilterItems(){return[]}getFooter(e,t){if(e){const e=this.getFooterLink();return d.createElement(d.Fragment,null,d.createElement("span",null,oe.RepositorySelectorNoneFoundDescription," "),e&&d.createElement(v.FormatComponent,{format:oe.RepositorySelectorProvideAccessDescription},d.createElement(R.Link,{href:e},oe.RepositorySelectorProvideAccessDescriptionLink)))}}getFooterLink(){}getRepositoryIconUrl(e){return e&&e.properties&&e.properties.ownerAvatarUrl}getRepositoryIconName(){return"GitLogo"}getRepositoryIconClass(){}compareRepositories(e,t){const i=Date.parse(e.properties.lastUpdated),s=Date.parse(t.properties.lastUpdated)-i;return isNaN(s)?0:s}getRepositories(e,t,i,s,r){throw new Error("getRepositories() not implemented")}checkIsMounted(){return this._mounted}autoSelectConnection(){return!0}_showFilterDropdown(){return this.getFilterItems().length>0||this.state.filterTypes&&this.state.filterTypes.length>0}_updateFilterDropdown(e){return this.autoSelectConnection()&&void 0!==e&&!this.isCustomResultSetFilter(e)}_fetchRepositories(){this._timer=new Date,this.setState({countRequests:0,footerText:void 0,repositories:void 0,resultSet:this.state.resultSet});const e=this.state.resultSet;this.listRepositories(this.state.projectId,this.props.sourceProvider,this.props.connectionId,e,!0).then(t=>{this._onRepositoryListReceived(t,e)},e=>{this.props.onErrorMessage(oe.InvalidServiceConnection),this.setState({footerText:this.getFooter(!0,!1)})})}listRepositories(e,t,i,s,r,a){return this.autoSelectConnection()||void 0!==s&&this.isCustomResultSetFilter(s)?this.getRepositories(i,void 0,s,r,a):this._client.listRepositories(e,t,i,void 0,s,r,a)}isCustomResultSetFilter(e){return"string"==typeof e}_filterRepositories(e,t){if(e){const i=t.trim().toLowerCase();return e.filter(e=>-1!==e.fullName.toLowerCase().indexOf(i))}return e}_filterNoReposFound(e,t){return 0===this._filterRepositories(e,t).length}}}(),function(e){Ee=t.TemplateSelector={},Object.defineProperty(t,"__esModule",{value:!0});const i="bringYourOwn";class r extends u.VssComponent{constructor(e,t){super(e,t),this._selectTemplate=((e,t,i)=>{const s=e&&e.parameters&&e.parameters.filter(e=>!!e)||[];s.length>0?(e.parameters=s,this.setState({progress:0,incompleteTemplate:{template:e,repoAnalysis:t,configuration:i},requiredInfoPanelIsOpen:!0})):this._onTemplateSelected(e,t,void 0)}),this._completeTemplate=(async e=>{if(this.state.incompleteTemplate){const t=this.state.incompleteTemplate,i=this._getTemplateParameters(t.template);this.setState({renderingTemplate:!0}),this._creatingResources=!0,this.monitorAndUpdateProgress(),this._recordTelemetryInfo("CreatingResources");const s=this._parseResponse(await this._createRequiredResources(e));this._createdResources=!0,this._recordTelemetryInfo("WaitingForEndpointsToBeReady");const r=(t.template.parameters||[]).filter(e=>e.type.startsWith("endpoint")||e.type.toLocaleLowerCase()===le.TemplateParameterTypes.KubernetesResource.toLocaleLowerCase()),a=[];r.forEach(e=>{e.type.toLocaleLowerCase()===le.TemplateParameterTypes.KubernetesResource.toLocaleLowerCase()?a.push(se.EndpointHelper.getEndpointStatus(s[le.TemplateConstants.K8sConnectionKey].Id,this.context.pageContext)):a.push(se.EndpointHelper.getEndpointStatus(s[e.name].Id,this.context.pageContext))});try{await Promise.all(a),this.setState({progress:.8})}catch(e){const t=JSON.parse(e);this._recordTelemetryInfo("WaitingForEndpointsToBeReadyFailed",{endpoint:t.endpointId}),this._handleError(t.error)}try{this._recordTelemetryInfo("RenderingTemplateWithValues"),this._endpointStatusCompleted=!0,await this._renderAndSelectTemplate(Object.assign(Object.assign(Object.assign({},e),i),s),t.template,t.repoAnalysis,t.configuration),this._recordTelemetryInfo("RenderingTemplateWithValuesSucceeded")}catch(e){this._recordTelemetryInfo("RenderTemplateWithValuesFailed",{error:e}),this._handleError(e)}}}),this._renderAndSelectTemplate=(async(e,t,i,s)=>{const r=this.context.pageContext.getService("IBuildTemplateService"),a=await r.renderTemplate(this.props.wizardState,e);if(a.exception)return this.setState({renderingTemplate:!1}),this._recordTelemetryInfo("RenderTemplateWithValuesFailed",{error:a.exception}),void this._handleError(a.exception);t.content=a.content,t.assets=a.assets,this._fetchedCustomizedTemplates=!0,this._onTemplateSelected(t,i,s)}),this._createRequiredResources=(async e=>{let t={},i={};const s=this.state.incompleteTemplate&&this.state.incompleteTemplate.template.parameters?this.state.incompleteTemplate.template.parameters:[];let r=!1;if(s.forEach(i=>{i.type.toLocaleLowerCase().startsWith("endpoint:")?t[i.name]={resourcetocreate:e[i.name],type:i.type}:i.type.toLocaleLowerCase()===le.TemplateParameterTypes.KubernetesResource.toLocaleLowerCase()&&(t[le.TemplateConstants.K8sConnectionKey]={resourcetocreate:e[i.name],type:le.TemplateRequiredConstants.KubernetesEndpoint},r=!0)}),!t)return Promise.resolve({});const a=this.context.pageContext.getService("IVssContributionService"),n="ms.vss-build-web.create-resources-data-provider";try{const e=await a.getDataAsync(n,t)||{};if(Object.keys(e).forEach(t=>i[t]=e[t]),r){const t=await se.EndpointHelper.generateAuxillaryResourcesForEndpoints(s,e,this.props.wizardState);if(t){const e=await a.getDataAsync(n,t)||{};Object.keys(e).forEach(t=>i[t]=e[t])}}}catch(e){this._handleError(e)}return Promise.resolve(i)}),this._parseResponse=(e=>{const t=this.context.pageContext.getService("IVssContributionService").getDataProviderExceptions()["ms.vss-build-web.create-resources-data-provider"];return t?(this._handleError(t),{}):e}),this._getTemplateParameters=(e=>({[le.TemplateConstants.TemplateIdKey]:e.id,[le.TemplateConstants.RepositoryNameKey]:this.props.wizardState.repositoryName})),this._onTemplatesRetrieved=((e,t)=>{t!==a.templatesRetrieved||this._templatesFetched?t===a.templatesRetrievedFail&&this._handleError(e&&e.exception):(this._templatesFetched=!0,this._recommendedConfigPath=e.configurationPath,this._mounted&&this.setState({progress:this.state.progress+r.s_progressBarTemplateResults}))}),this._showFileSelectPanel=(()=>{this.setState({fileSelectPanelIsOpen:!0})}),this._dismissFileSelectPanel=(()=>{this.setState({fileSelectPanelIsOpen:!1})}),this._dismissRequiredInfoPanel=(()=>{this.setState({requiredInfoPanelIsOpen:!1})}),this._onTemplateSelected=((e,t,s,r)=>{e&&e.id===i?this._showFileSelectPanel():!this.state.errorMessage&&this.props.onTemplateSelected(e,t,s,r,this._recommendedConfigPath)}),this._normalizeHTML=(async e=>this._markdownPromise.then(()=>{return this.context.pageContext.getService("IHtmlNormalizerService").normalizeStripAttributes(e)})),this._recordTelemetryInfo=((e,t)=>{let i="";this.state.incompleteTemplate&&(i=this.state.incompleteTemplate.template.id);const s=Object.assign({action:e,template:i},t);this.context.pageContext.getService("IVssTelemetryService").publishEvent("Build","CreatePipeline",s)}),this.state={progress:0,loadComplete:!1,errorMessage:"",fileSelectPanelIsOpen:!1,requiredInfoPanelIsOpen:!1,renderingTemplate:!1},this._progressTicker=this._getPromiseTicker(),this._existingConfigFileFetched=!1,this._creatingResources=!1,this._createdResources=!1,this._endpointStatusCompleted=!1,this._fetchedCustomizedTemplates=!1,this.context.pageContext.getService("IVssPerformanceService").startScenario(ce.PageLoadScenarios.Templates,!1)}render(){const e=this.context.pageContext.getService("IBuildTemplateService"),t=!!this.state.incompleteTemplate&&!!this.state.incompleteTemplate.template.parameters&&this.state.incompleteTemplate.template.parameters;return d.createElement("div",{className:"template-selector"},d.createElement("div",{className:"header-section"},d.createElement("div",{className:"subheader body-m secondary-text"},oe.NewPipeline),d.createElement("div",{className:"header title-l"},oe.ConfigureYourPipeline)),!this.state.renderingTemplate&&d.createElement(d.Fragment,null,this.state.errorMessage&&this.state.loadComplete&&d.createElement(y.MessageCard,{severity:"Error"},d.createElement("span",{dangerouslySetInnerHTML:{__html:this.state.errorMessage}})),d.createElement(re.Observer,{templateData:e},d.createElement(o,{sourceProvider:this.props.wizardState.sourceProvider,templateData:void 0,loadComplete:this.state.loadComplete,onTemplateSelected:this._selectTemplate,progress:this.state.progress})),this.state.fileSelectPanelIsOpen&&d.createElement(u.WrappedComponent,{wrappedType:"designer-file-select-panel",dependencies:["ms.vss-build-web.designer-extensions.file-select-panel"],wrappedProps:{wizardState:this.props.wizardState,isOpen:this.state.fileSelectPanelIsOpen,onDismiss:this._dismissFileSelectPanel,onTemplateSelected:this._onTemplateSelected}}),!!t&&t.length>0&&this.state.incompleteTemplate&&d.createElement(u.WrappedComponent,{wrappedType:"designer-required-template-info-panel",dependencies:["ms.vss-build-web.designer-extensions.required-template-info-panel"],wrappedProps:{template:this.state.incompleteTemplate.template,requires:t,isOpen:this.state.requiredInfoPanelIsOpen,onRequiredTemplateInfoCompleted:this._completeTemplate,onDismiss:this._dismissRequiredInfoPanel,onError:this._handleError}})),this.state.renderingTemplate&&d.createElement(d.Fragment,null,this.state.errorMessage&&d.createElement(y.MessageCard,{severity:"Error"},d.createElement("span",{dangerouslySetInnerHTML:{__html:this.state.errorMessage}})),!this.state.errorMessage&&d.createElement(d.Fragment,null,d.createElement("div",null,oe.ConfiguringYourPipelineAndGeneratingYaml),d.createElement(Q.ProgressIndicator,{className:"progress",percentComplete:this.state.progress}))))}componentDidMount(){this._mounted=!0,this._existingConfigFileFetched=!1;const e=this.context.pageContext.getService("IVssContributionService");e.getDataAsync("ms.vss-build-web.existing-configuration-data-provider",this.props.wizardState).then(e=>{this._existingConfigFileFetched=!0,e?(this.props.onTemplateSelected(void 0,void 0,e),this._progressTicker=Promise.resolve()):this._mounted&&this.setState({progress:this.state.progress+r.s_progressBarExistingResults,loadComplete:this._existingConfigFileFetched})}),this._templatesFetched=!1;const t=this.context.pageContext.getService("IBuildTemplateService");t.subscribe(this._onTemplatesRetrieved),t.getTemplates(this.props.wizardState),this._markdownPromise=e.getContributionAsync("ms.vss-features.markdown")}componentWillUnmount(){super.componentWillUnmount(),this.context.pageContext.getService("IBuildTemplateService").unsubscribe(this._onTemplatesRetrieved),this._mounted=!1}monitorAndUpdateProgress(){let e;return e=this._fetchedCustomizedTemplates?r.s_progressBarMax:this._endpointStatusCompleted?.75:this._createdResources?.5:.25,!this.state.errorMessage&&this.state.progress<r.s_progressBarMax?new Promise(()=>setTimeout(()=>{let t=this.state.progress+r.s_progressBarStep;t=t<e?t:e,this._mounted&&(this.setState({progress:t}),this.monitorAndUpdateProgress())},100)):Promise.resolve()}_getPromiseTicker(){return this._existingConfigFileFetched&&this._templatesFetched||!(this.state.progress<r.s_progressBarMax)?Promise.resolve():new Promise(()=>setTimeout(()=>{this._mounted&&this.setState({progress:this.state.progress+r.s_progressBarStep}),this._progressTicker=this._getPromiseTicker()},100))}_handleError(e){let t="";this._mounted&&e&&(e.message?t=e.message:"string"==typeof e&&(t=e),this._normalizeHTML(t).then(e=>{this.setState({errorMessage:e})}))}}var a;t.TemplateSelector.TemplateSelector=r,r.s_progressBarMax=.99,r.s_progressBarExistingResults=.3*r.s_progressBarMax,r.s_progressBarTemplateResults=.3*r.s_progressBarMax,r.s_progressBarStep=(r.s_progressBarMax-r.s_progressBarExistingResults)/55,function(e){e.templatesRetrieved="templatesRetrieved",e.templatesRetrievedFail="templatesRetrievedFail"}(a||(a={}));class n extends s.VssObservableService{getTemplates(e){const t=this.pageContext.getService("IVssContributionService"),i="ms.vss-build-web.recommended-configuration-data-provider";t.getDataAsync(i,e).then(e=>{if(e)this._notify(e,a.templatesRetrieved,!1);else{const e={templates:[],configurationPath:"",exception:t.getDataProviderExceptions()[i]};this._notify(e,a.templatesRetrievedFail,!1)}})}renderTemplate(e,t){const i=this.pageContext.getService("IVssContributionService"),s="ms.vss-build-web.customized-template-data-provider",r={templateParameters:t,validateAssets:!0,sourceProviderType:e.sourceProvider,repositoryId:e.repositoryId||e.repositoryName,connectionId:e.connectionId,branch:e.branch};return i.getDataAsync(s,r).then(e=>e||{content:"",exception:i.getDataProviderExceptions()[s]})}}t.TemplateSelector.TemplateService=n;class o extends u.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._showAllTemplates=(()=>{this.setState({showAllTemplates:!0})}),this.state={showAllTemplates:!1}}render(){let e=void 0,t=[],s=[];const r={content:"",id:i,name:oe.BringYourOwnYamlTitle,description:oe.BringYourOwnYamlDesc,recommendedWeight:0};if(this.props.templateData){for(let i=0;i<this.props.templateData.templates.length;++i){const a=this.props.templateData.templates[i];a.id!==o.s_empty?a.recommendedWeight>0?s.push(a):t.push(a):(e=a,r.iconUrl=e.iconUrl)}t=this._sortTemplatesByName(t),s=this._sortTemplatesByWeight(s),e&&s.push(e),s.length>0&&s.push(r)}if(!this.props.templateData||!this.props.loadComplete)return d.createElement("div",{className:"analyzing-container"},d.createElement("div",null,oe.RepositoryAnalyzing),d.createElement("div",null,d.createElement(Q.ProgressIndicator,{className:"progress",percentComplete:this.props.progress})));const a=this.state.showAllTemplates?s.concat(t):s,n={recommendTemplate:a[0],suggestedTemplates:s};return a.length>0?d.createElement("div",{className:"template-view flex-column"},d.createElement(Pe.WizardList,{wizardListItems:this._mapToWizardListItems(a),onClick:(e,t)=>{this.props.onTemplateSelected(a[t.index],n)}}),!this.state.showAllTemplates&&d.createElement(b.Button,{className:"all-templates-button flex-self-start",onClick:this._showAllTemplates},oe.ShowMore)):d.createElement("div",null)}componentDidMount(){super.componentDidMount(),this._ttiMarked||(this._ttiMarked=!0,this.context.pageContext.getService("IVssPerformanceService").endScenario(ce.PerformanceConstants.Area,ce.PageLoadScenarios.Templates,!1))}_sortTemplatesByName(e){return e&&e.length>0?e.sort((e,t)=>{const i=e&&e.name?e.name:"",s=t&&t.name?t.name:"";return i.localeCompare(s)}):e}_sortTemplatesByWeight(e){return e&&e.length>0?e.sort((e,t)=>{const i=e&&e.recommendedWeight?e.recommendedWeight:0,s=t&&t.recommendedWeight?t.recommendedWeight:0;if(i==s){const i=e&&e.name?e.name:"",s=t&&t.name?t.name:"";return i.localeCompare(s)}return s-i}):e}_mapToWizardListItems(e){return e.map(e=>({name:e.name,description:e.description,iconUrl:e.iconUrl,iconName:"FileCode"}))}}o.s_empty="empty",s.Services.add("IBuildTemplateService",{serviceFactory:n,options:2})}(),function(e){we=t.YamlWizardPage={},Object.defineProperty(t,"__esModule",{value:!0});t.YamlWizardPage.YamlWizardPage=class extends u.VssComponent{constructor(e,t){super(e,t),this._renderHeader=(()=>{const e=this._isDirty()||this._isNewFile();return d.createElement("div",{className:"ci-editor-header header-section flex-row"},d.createElement("div",{className:"scroll-hidden"},d.createElement("div",{className:"subheader body-m secondary-text"},oe.NewPipeline),d.createElement("div",{className:"title-l text-ellipsis"},oe.ReviewYourPipelineYAML)),d.createElement("div",{className:"ci-editor-action-buttons flex-self-end"},this.state.isRunning?d.createElement(k.Spinner,{className:"loading-indicator",orientation:0,label:oe.CreatingPipeline}):d.createElement(E.ButtonGroup,null,this._isVariablesPanelEnabled&&d.createElement(b.Button,{className:"ci-editor-action-button",text:oe.CommandVariables,primary:!1,disabled:this.state.isRunning,onClick:this._showPipelineVariablesPanel}),d.createElement(ae.SplitButton,{primary:!0,disabled:!this.state.isEditorReady||!this.state.content||this.state.isRunning,buttonProps:{className:V.css("ci-editor-action-button",le.EditorConstants.ElementToFocusOnEscape),text:e?oe.SaveAndRunButtonLabel:oe.RunButtonLabel,onClick:this._onSaveAndRunClick},menuButtonProps:{contextualMenuProps:{menuProps:{id:"saveSubmenu",items:[{id:"saveOnly",text:oe.SaveButtonLabel,disabled:this.state.isRunning,onActivate:this._onSaveOnlyClick}]}}}}))))}),this._navigateAwayHandler=(e=>{this._isDirty()&&(e.returnValue=oe.ConfirmLosingUnsavedChange)}),this._onHistoryChanged=(e=>{this._isDirty()&&!confirm(oe.ConfirmLosingUnsavedChange)||(this._switchHistoryChangeHandler(this._onHistoryChanged,this.props.onHistoryChanged),this.props.onHistoryChanged(e))}),this._onEditorCreated=(e=>{e&&(this._editor=e,e.focus(),this.setState({isEditorReady:!0}))}),this._onYamlContentUpdated=(e=>{e!==this.state.content&&this.setState({content:e})}),this._onFileNameChanged=(e=>{e!==this.state.fileName&&this.setState({fileName:e})}),this._showPipelineVariablesPanel=(()=>{this.setState({variablesPanelIsOpen:!0})}),this._dismissPipelineVariablesPanel=(()=>{this.setState({variablesPanelIsOpen:!1})}),this._onSavePipelineVariables=(e=>{this.setState({variables:e}),this._dismissPipelineVariablesPanel()}),this._showSavePanel=(()=>{const e=this._editor&&this._editor.getValue()||"";this.setState({content:e,savePanelIsOpen:!0,isSaving:!1},()=>this.props.onAction("ShowSavePanel"))}),this._saveAndRunPipeline=(()=>{this._ensureEditorIsReadOnly(!0),this.setState({isRunning:!0,errorMessage:""});const e={sourceProviderType:this.props.wizardState.sourceProvider,connectionId:this.props.wizardState.connectionId,id:this.props.wizardState.repositoryId,name:this.props.wizardState.repositoryName,defaultBranch:this.props.wizardState.branch},t=this.state.sourceBranch,i=this.state.savedFileInfo,s=this.state.fileName,r=this.props.wizardState.pipelinePath,a=this.state.variables,n=!this._runAfterSaving,o=this.context.pageContext.getService("IPipelineService");o.createAndRunPipeline(e,s,t,i,r,a,n).then(e=>{if(e){if(e.pipeline){const i=this.context.pageContext.getService("ITfsPageService").getData().project.id||c.EmptyGuidString,s=c.format("{0}:{1}",i,e.pipeline.id);this.props.onAction("PipelineCreated",{ProjectAndPipelineId:s}),this.props.onAction("Run",{yamlWasEdited:this._lastSavedContent!==this.props.content}),this.setState({pipelineCreated:e.pipeline}),n&&this._gotoEmptySummaryPage(e.pipeline.id,t)}e.pipelineBuildWebUrl&&this.props.redirectToPipeline(e.pipelineBuildWebUrl),e.queuePipelineErrorMessage&&this._handleRunError(e.queuePipelineErrorMessage)}const i=o.getPipelineErrorMessage();i&&this._handleRunError(i)})}),this._onDataProviderQueryEnd=(e=>{if(e.dataProviderExceptions){const t=e.dataProviderExceptions["ms.vss-build-web.create-and-run-pipeline-data-provider"];t&&this._handleRunError(t.message)}}),this._onSaveAndRunClick=(()=>{this._save(!0)}),this._onSaveOnlyClick=(()=>{this._save(!1)}),this._save=(e=>{this._runAfterSaving=e,this._isDirty()||this._isNewFile()?this._showSavePanel():this._saveAndRunPipeline()}),this._saveYamlAndPipeline=(e=>{this._ensureEditorIsReadOnly(!0),this.setState({saveErrorMessage:"",isSaving:!0},()=>this.props.onAction(e.createNewBranch?"SavePR":"SaveCommit"));const t=this._editor&&this._editor.getValue()||"",i={connectionId:this.props.wizardState.connectionId,sourceProviderType:this.props.wizardState.sourceProvider,id:this.props.wizardState.repositoryId,projectId:this.props.wizardState.repositoryProjectId};e.skipCi=!0;const s=this.context.pageContext.getService("IYamlFileService"),r=this._isNewFile()?"":this._lastSavedSha;if(this.props.additionalFiles){const a=[{path:this.state.fileName,content:t,oldObjectId:r},...this._mapToCommitFileInfo(this.props.additionalFiles)];s.commitFiles(i,this.props.wizardState.branch,a,e).then(e=>{this._onYamlSaved(e,t)},e=>{this._handleSaveError(e.message)})}else s.commitFile(i,this.props.wizardState.branch,this.state.fileName,t,e,r).then(e=>{this._onYamlSaved(e,t)},e=>{this._handleSaveError(e.message)})}),this._onYamlSaved=((e,t)=>{this._lastSavedContent=t,this._lastSavedSha=e.objectId,this._lastSavedFileName=this.state.fileName,this.setState({isSaving:!1,sourceBranch:e.branch,savedFileInfo:e},()=>{this._saveAndRunPipeline()})}),this._dismissSavePanel=(()=>{this.state.isSaving||this.setState({saveErrorMessage:"",savePanelIsOpen:!1})}),this._handleRunError=(e=>{this.setState({isRunning:!1,savePanelIsOpen:!1,errorMessage:e})}),this._handleSaveError=(e=>{this.setState({saveErrorMessage:e,isSaving:!1,isRunning:!1,savePanelIsOpen:!0}),this._ensureEditorIsReadOnly(!1)}),this._mapToFileListItems=(e=>e.map(e=>({name:e.destinationPath,description:e.description,type:this._getFileType(e.path)}))),this._getFileType=(e=>c.endsWith(e,"yml",!0)?he.FileType.Yaml:he.FileType.Other),this._mapToCommitFileInfo=(e=>e.map(e=>({path:e.destinationPath,content:e.content,oldObjectId:""}))),this._editorIsReadOnly=!1,this._lastSavedContent=e.content||"",this._lastSavedSha=e.contentSha||"",this._lastSavedFileName=this._trimPath(this.props.path),this._runAfterSaving=!0,this._isVariablesPanelEnabled=!_.isFeatureFlagEnabled(t.pageContext,"Build2.DisableYamlEditorVariables",!1),this.state={content:this._lastSavedContent,fileName:this._lastSavedFileName,sourceBranch:"",isEditorReady:!1,isRunning:!1,savePanelIsOpen:!1,isSaving:!1,saveErrorMessage:"",errorMessage:"",variables:{},variablesPanelIsOpen:!1,pipelineCreated:void 0,savedFileInfo:void 0}}componentDidMount(){window.addEventListener("beforeunload",this._navigateAwayHandler),this.context.pageContext.getService("IVssContributionService").subscribe(this._onDataProviderQueryEnd,"dpqCompleted"),this._switchHistoryChangeHandler(this.props.onHistoryChanged,this._onHistoryChanged)}componentWillUnmount(){window.removeEventListener("beforeunload",this._navigateAwayHandler),this.context.pageContext.getService("IVssHistoryService").unsubscribe(this._onHistoryChanged),this.context.pageContext.getService("IVssContributionService").unsubscribe(this._onDataProviderQueryEnd,"dpqCompleted")}render(){const e=this._getSourceProvider(),t=!c.equals(this.props.wizardState.sourceProvider,l.RepositoryTypes.Bitbucket,!0)||_.isFeatureFlagEnabled(this.context.pageContext,"Build2.BitbucketAzurePipelinesOAuthClient",!1);return d.createElement("div",{className:"ci-yaml-wizard-view flex-column flex-grow"},this._renderHeader(),this.state.errorMessage&&""!==this.state.errorMessage&&d.createElement(y.MessageCard,{className:"ci-editor-error",severity:"Error"},this.state.errorMessage),d.createElement(Ce.YamlTab,{content:this.state.content,editor:this._editor,onContentUpdated:this._onYamlContentUpdated,onEditorCreated:this._onEditorCreated,sidePanelInitiallyOpen:!1,repositoryName:this.props.wizardState.repositoryName,repositoryIconName:e&&e.getRepoIconName(),repositoryUrl:"",branchName:"",fileName:this.state.fileName,fileUrl:"",supportFPS:c.equals(this.props.wizardState.sourceProvider,l.RepositoryTypes.TfsGit,!0),isYamlDirty:this._isDirty()||this._isNewFile(),definition:void 0,onBranchSelected:()=>{},onFileNameChanged:this._onFileNameChanged}),this.state.variablesPanelIsOpen&&d.createElement(Se.PipelineVariablesPanel,{variables:this.state.variables,isSaving:!1,onSave:this._onSavePipelineVariables,onDismiss:this._dismissPipelineVariablesPanel}),d.createElement(be.SavePanel,{errorMessage:this.state.saveErrorMessage,fileName:this.state.fileName,defaultBranch:this.props.wizardState.branch||oe.DefaultBranch,isOpen:this.state.savePanelIsOpen,isSaving:this.state.isSaving,isRunning:this.state.isRunning,saveAndRun:this._runAfterSaving,canCreatePr:t,onSave:this._saveYamlAndPipeline,onDismiss:this._dismissSavePanel,filesAdded:this.props.additionalFiles&&[{name:this.state.fileName,description:oe.YamlFileDescription,type:he.FileType.Yaml},...this._mapToFileListItems(this.props.additionalFiles)]}))}_switchHistoryChangeHandler(e,t){const i=this.context.pageContext.getService("IVssHistoryService");i.unsubscribe(e),i.subscribe(t)}_isDirty(){return!!this._editor&&this._editor.getValue()!==this._lastSavedContent}_trimPath(e){return e&&(e=(e=e.startsWith("./")?e.slice(2):e).startsWith("/")?e.slice(1):e),e}_isNewFile(e){return!this._lastSavedSha||(e||this.state.fileName)!==this._lastSavedFileName}_ensureEditorIsReadOnly(e){this._editor&&this._editorIsReadOnly!==e&&(this._editorIsReadOnly=e,this._editor.updateOptions({readOnly:e}))}_getSourceProvider(){return this.context.pageContext.getService("ISourceProviderService").getSourceProvider(this.props.wizardState.sourceProvider)}_gotoEmptySummaryPage(e,t){const i=this.buildLinkingService.getPipelinesUrl(e);a.onClickFPS(this.context.pageContext,i,!0)}get buildLinkingService(){return this.context.pageContext.getService("IBuildLinkingService")}}}(),function(e){t.Wizard={},Object.defineProperty(t,"__esModule",{value:!0});class s extends u.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._mapToWizardListItems=(e=>e.map(e=>{const t=[];return e.supportsYaml&&t.push(oe.Yaml),{name:e.name,description:e.description,iconUrl:e.iconAsset?S.getAssetLocation(this.context.pageContext,e.iconAsset):void 0,iconAltText:e.iconAssetAltText,iconName:e.iconName,labels:t}})),this._onHistoryChanged=(e=>{this.setState(this._readStateFromHistory(e.newState.state))}),this._onSourceProviderClick=(e=>{if(e.isClassic){const t=this._getClassicEditorLink(e.key),i="new-pipeline-wizard.old-designer",s={telemetrySession:this.state.wizardState.telemetrySession,sourceProvider:e.key};a.onClickFPS(this.context.pageContext,t,!0,void 0,{telemetrySource:i,telemetryProperties:s})}else{const t=this.context.pageContext.getService("IVssHistoryService"),i=t.generateUrl({sourceProvider:e.key,telemetrySession:this.state.wizardState&&this.state.wizardState.telemetrySession||this._createTelemetrySession()},2);t.pushState(void 0,i),this.setState({sourceProviderKey:e.key,repositorySubheader:"",templateSubheader:"",stepNumber:2,wizardState:t.getState()},()=>this._recordTelemetryInfo())}}),this._onSourceProviderComplete=((e,t)=>{e||(e={}),e.sourceProviderComplete="true",e.telemetrySession=this.state.wizardState&&this.state.wizardState.telemetrySession||this._createTelemetrySession();const i=this.context.pageContext.getService("IVssHistoryService"),s=i.generateUrl(e,2);i.pushState(void 0,s),t||(t={}),this.setState({stepNumber:3,repositorySubheader:e.repositoryName||"",repositoryUrl:e.repositoryUrl,templateSubheader:"",wizardState:Object.assign(Object.assign(Object.assign({},this.state.wizardState),e),t)},()=>this._recordTelemetryInfo())}),this._onTemplateSelected=((e,t,i,s,r)=>{if(e||s){const t={branch:s||this.state.wizardState&&this.state.wizardState.branch||"",template:e?e.name:this.state.template?this.state.template.name:"",telemetrySession:this.state.wizardState&&this.state.wizardState.telemetrySession||this._createTelemetrySession()},i=this.context.pageContext.getService("IVssHistoryService"),r=i.generateUrl(t,2);i.pushState(void 0,r)}this._onTemplateSelectionComplete(4,e,t,i,s,r)}),this._getSourceProviderTile=(e=>this._sourceProviders.find(t=>c.equals(t.key,e,!0))),this._recordTelemetryInfo=((e,t)=>{const i=(e,t,i)=>{this.state.wizardState&&this.state.wizardState[t]?e[t]=this.state.wizardState[t]:i&&(e[t]=i)},s=(e,t)=>{this.state.wizardState&&this.state.wizardState[t]&&(e[t]="true"===this.state.wizardState[t].toLowerCase())},r={};if(e)r.action=e;else switch(this.state.stepNumber){case 1:r.action="ChooseConnection";break;case 2:r.action="ChooseRepo";break;case 3:r.action="ChooseTemplate";break;case 4:r.action="EditYaml";break;default:r.action="unknown"}i(r,"externalOwnerId"),i(r,"externalOwnerName"),s(r,"externalOwnerIsAUser"),i(r,"entryPoint"),s(r,"repositoryIsFork"),s(r,"repositoryIsPrivate"),i(r,"telemetrySession",this._createTelemetrySession()),this.state.wizardState&&this.state.wizardState.safeRepository&&(r.repositoryName=this.state.wizardState.safeRepository);const a=this._getSourceProviderTile(this.state.sourceProviderKey||"");if(r.repositoryType=a&&a.name||"",this.state.template&&this.state.template.name&&(r.templateName=this.state.template.name),this.state.repoAnalysis&&this.state.repoAnalysis.recommendTemplate&&(r.recommendedTemplateName=this.state.repoAnalysis.recommendTemplate.name,r.suggestedTemplateNames=this.state.repoAnalysis.suggestedTemplates.map(e=>e.name)),t)for(const e in t)r[e]=t[e];this.context.pageContext.getService("IVssTelemetryService").publishEvent("Build","CreatePipeline",r)}),this._markRepositoryTTI=(()=>{this._markTTI(ce.PageLoadScenarios.Repository)}),this._markTTI=(e=>{this._ttiMarked||(this._ttiMarked=!0,this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(ce.PerformanceConstants.Area,e))}),this._getWizardItems=(e=>[oe.Connect,oe.Select,oe.Configure,oe.Review].map((t,i)=>({title:t,itemState:new r.ObservableValue(e>i+1?"Complete":"None")}))),this._getFallbackLink=(()=>{return this.context.pageContext.getService("IBuildLinkingService").getNewDefinitionEditUrl(this.state.wizardState.pipelinePath)+"&id=0"}),this._getClassicEditorLink=(e=>this._getFallbackLink()+"&repositoryType="+e),this._redirectToPipeline=(e=>{4==this.state.stepNumber&&i.openLinkSecurely(e)}),this._normalizeBranchName=(e=>{return e&&c.startsWith(e,"refs/heads/",!0)?e.substring("refs/heads/".length):e}),this._getAdditionalFilesForTemplate=(e=>{if(e&&e.assets)return e.assets.filter(e=>e&&c.equals(e.type,le.TemplateAssetTypes.File,!0))}),this._configurationPath="/azure-pipelines.yml";const s=this.context.pageContext.getService("IVssHistoryService").getState(),n=this.context.pageContext.getService("IVssContributionService").getContributionsByType("ms.vss-build-web.acquisition-source-provider-tile");this._sourceProviders=Object.keys(n).map(e=>n[e]).sort((e,t)=>e.name.localeCompare(t.name)),this.state=s?this._readStateFromHistory(s):{stepNumber:1,showSaveAndRun:!0,wizardState:{}},this._recordTelemetryInfo()}componentDidMount(){this.context.pageContext.getService("IVssHistoryService").subscribe(this._onHistoryChanged),1==this.state.stepNumber&&this._markTTI(ce.PageLoadScenarios.Sources)}componentWillUnmount(){this.context.pageContext.getService("IVssHistoryService").unsubscribe(this._onHistoryChanged)}render(){const e=4===this.state.stepNumber;return d.createElement(q.Page,{className:u.css("ci-designer-wizard-view flex-column flex-grow",e?"bolt-page-grey":"")},d.createElement(ne.Wizard,{className:"wizard-view-step-list page-content page-content-top flex-noshrink",items:this._getWizardItems(this.state.stepNumber),selectedIndex:this.state.stepNumber-1}),d.createElement("div",{className:u.css("wizard-view-detail flex-column flex-grow",e?"":"page-content")},this._renderDetail()))}_renderDetail(){switch(this.state.stepNumber){default:case 1:return this._renderSourceProviderSelector();case 2:return this._getSourceProviderWizard();case 3:return d.createElement(Ee.TemplateSelector,{wizardState:this.state.wizardState,onTemplateSelected:this._onTemplateSelected});case 4:return this._renderYamlWizardPage()}}_renderSourceProviderSelector(){return d.createElement("div",{className:"source-provider-selector"},d.createElement("div",{className:"header-section"},d.createElement("div",{className:"subheader  body-m secondary-text"},oe.NewPipeline),d.createElement("div",{className:"header title-l"},oe.WhereIsYourCode)),d.createElement(Pe.WizardList,{wizardListItems:this._mapToWizardListItems(this._sourceProviders),onClick:(e,t)=>{this._onSourceProviderClick(this._sourceProviders[t.index])}}),d.createElement("div",{className:"old-designer-fallback"},d.createElement(v.FormatComponent,{format:oe.OldDesignerFallbackFormat},d.createElement(g.FPSLink,{href:this._getFallbackLink(),telemetrySource:"new-pipeline-wizard.old-designer",telemetryProperties:{telemetrySession:this.state.wizardState.telemetrySession}},oe.OldDesignerLinkText))))}_renderYamlWizardPage(){const e=this.state.configuration?this.state.configuration.path:this.state.wizardState.configPath?this.state.wizardState.configPath:this._configurationPath;return d.createElement(we.YamlWizardPage,{wizardState:this.state.wizardState,content:this.state.template?this.state.template.content:this.state.configuration.content,path:e,url:this.state.configuration?this.state.configuration.webUrl:void 0,onAction:this._recordTelemetryInfo,onHistoryChanged:this._onHistoryChanged,contentSha:this.state.configuration?this.state.configuration.objectId:"",redirectToPipeline:this._redirectToPipeline,additionalFiles:this._getAdditionalFilesForTemplate(this.state.template)})}_readStateFromHistory(e){let t=1,i=void 0,s=void 0,r=void 0;const a=e.sourceProvider;return a&&(i=this._getSourceProviderTile(a))&&(t=2),"true"===e.sourceProviderComplete&&(t=3,s=e.repositoryName,r=e.repositoryUrl),{stepNumber:t,sourceProviderKey:a,repositorySubheader:s,repositoryUrl:r,showSaveAndRun:!0,templateSubheader:"",wizardState:Object.assign(Object.assign({},e),{branch:this._normalizeBranchName(e.branch)})}}_onTemplateSelectionComplete(e,t,i,s,r,a){this.setState({stepNumber:e,template:t,repoAnalysis:i,configuration:s,templateSubheader:t?t.name:oe.ExistingFileFound,showSaveAndRun:!!t,wizardState:Object.assign(Object.assign({},this.state.wizardState),{branch:r||this.state.wizardState.branch,configPath:a||""})},()=>this._recordTelemetryInfo())}_getSourceProviderWizard(){const e=this.context.pageContext.getService("IVssLayoutManager").getComponentsForRegion("sourceProviderWizard").value.find(e=>{const t=e.componentProperties.key;return!!t&&c.equals(t.toString(),this.state.sourceProviderKey,!0)});return e?d.createElement(u.WrappedComponent,Object.assign({wrappedType:e.componentType},e.componentProperties,{wizardState:this.state.wizardState,onComplete:this._onSourceProviderComplete,onUpdate:this._recordTelemetryInfo,onTTI:this._markRepositoryTTI})):d.createElement("div",null,"The source provider key '",this.state.sourceProviderKey,"' was not recognized.")}_createTelemetrySession(){return c.newGuid()}}t.Wizard.DesignerWizardContent=s,u.Components.add("ci-designer-wizard-view",s)}()},["Resources","Constants","InstallAppService","Performance","PipelineEditorBreadcrumbService","PipelineService","Util/File","WarningBanner","VisibilityMismatchWarning","YamlFileService","YamlResourcesService","Components/FileList","EditorAuthLandingPage","EditorHeader","LoseChangesDialog","PipelineVariableEditPanel","PipelineVariablesPanel","SavePanel","YamlEditor","YamlEditorHeader","YamlSidePanel","YamlTab","EditorView","WizardList","RepositorySelector","TemplateSelector","YamlWizardPage","Wizard"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.designer"}}));