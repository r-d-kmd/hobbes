"use strict";define("VSSUI",["require","exports","react","VSS/Core/Observable","VSS/Core/TimerManagement"],function(e,t,s,i,n){var l;!function(e){l=t.ComponentsTagPickerTagPicker={},Object.defineProperty(t,"__esModule",{value:!0});class a extends s.Component{constructor(e){super(e),this.inputElement=s.createRef(),this.outerElement=s.createRef(),this.textValue=new i.ObservableValue(""),this.suggestionsVisible=new i.ObservableValue(!1),this.selectedIndex=new i.ObservableValue(-1),this.selectableTags=new i.ObservableArray([]),this.clearTagPicker=(()=>{this.suggestionsVisible.value=!1,this.textValue.value="",this.selectedIndex.value=-1}),this.suggestionsLoaded=(()=>(-1===this.selectedIndex.value&&!i.ObservableLike.getValue(this.props.suggestionsLoading)&&this.inputElement.current&&""!==this.inputElement.current.value&&(this.updateIndexTimer&&window.cancelAnimationFrame(this.updateIndexTimer),this.updateIndexTimer=window.requestAnimationFrame(()=>{this.selectedIndex.value=0})),!0)),this.createGenericItem=((e,t)=>{const s=this.props.createDefaultItem&&this.props.createDefaultItem(e);if(!s||!t.some(e=>this.props.areTagsEqual(s,e)))return s}),this.onBlur=(()=>{if(this.props.shouldBlurClear&&!this.props.shouldBlurClear())return;const e=this.textValue.value;this.textValue.value="",this.selectableTags.value=[],this.props.onBlur&&this.props.onBlur(e),this.onSuggestionsDismiss()}),this.onOuterKeyDown=(e=>{switch(e.which){case 46:case 8:!e.isDefaultPrevented()&&this.selectableTags.value.length>0&&(this.props.onTagsRemoved&&this.props.onTagsRemoved(this.selectableTags.value),this.selectableTags.value=[],this.focusInput(),e.preventDefault())}}),this.onKeyDown=(e=>{const t=e.which,s=this.inputElement.current,n=this.suggestionsVisible.value,l=i.ObservableLike.getValue(this.props.suggestions);switch(t){case 27:this.onSuggestionsDismiss(),e.preventDefault();break;case 9:case 13:if(!e.shiftKey)if(n)this.completeSuggestion(),e.preventDefault();else if(this.props.createDefaultItem){const t=this.createGenericItem(this.textValue.value,i.ObservableLike.getValue(this.props.selectedTags));t&&(this.addItem(t),e.preventDefault())}break;case 38:n&&(this.selectedIndex.value=Math.max(0,this.selectedIndex.value-1),e.preventDefault());break;case 40:n?(this.selectedIndex.value=Math.min(l.length-1,this.selectedIndex.value+1),e.preventDefault()):""===this.textValue.value?(this.props.onEmptyInputFocus&&this.props.onEmptyInputFocus(),this.suggestionsVisible.value=!0,e.preventDefault()):(this.suggestionsVisible.value=!0,e.preventDefault());break;case 39:n&&l&&l[this.selectedIndex.value]&&this.props.onSuggestionExpanded&&s&&s.value.length===s.selectionEnd&&(this.props.onSuggestionExpanded(l[this.selectedIndex.value]),e.preventDefault())}}),this.onInputClick=(e=>{this.props.onEmptyInputFocus&&this.props.onEmptyInputFocus(),this.suggestionsVisible.value=!0,e&&e.preventDefault()}),this.onInputChange=(e=>{this.textValue.value=e.target.value,this.selectedIndex.value=-1,this.onResolveInput(e),e.persist(),e.preventDefault()}),this.onResolveInput=(e=>{const t=this.props.deliminator&&this.textValue.value.split(this.props.deliminator);this.props.onDelimitedSearch&&this.props.deliminator&&t&&t.length>1?this.props.onDelimitedSearch(this.textValue.value.split(this.props.deliminator)):(this.props.onSearchChanged(e.target.value),this.suggestionsVisible.value=!0)}),this.onTagClicked=((e,t)=>{if(!e||!e.isDefaultPrevented()){const s=this.indexOfTag(t,this.selectableTags.value);if(!this.props.onTagsRemoved)return;s<0?this.selectableTags.push(t):this.selectableTags.splice(s,1),e&&e.preventDefault()}}),this.onTagRemoved=(e=>{const t=this.indexOfTag(e,this.selectableTags.value);t>=0&&this.selectableTags.splice(t,1),this.props.onTagRemoved(e),this.inputElement.current&&this.inputElement.current.focus()}),this.onTagPickerSizeChanged=((e,t)=>{this.setState({width:e})}),this.completeSuggestion=(()=>{const e=i.ObservableLike.getValue(this.props.suggestions)[this.selectedIndex.value];e&&this.addItem(e)}),this.onSuggestionClick=(e=>{this.addItem(e.item)}),this.addItem=(e=>{this.suggestionsVisible.value=!1,this.props.onTagAdded(e),this.textValue.value="",this.selectedIndex.value=-1,this.focusInput()}),this.focusInput=(()=>{this.inputElement.current&&(this.inputElement.current.focus(),this.inputElement.current.select())}),this.onSuggestionsDismiss=(()=>{this.suggestionsVisible.value=!1}),this.indexOfTag=((e,t)=>t.findIndex(t=>this.props.areTagsEqual(t,e))),this.state={width:296},this.timerManagement=new n.TimerManagement}render(){const{ariaLabel:e,ariaLabelledBy:i,convertItemToPill:n,noResultsFoundText:l,onTagsRemoved:a,placeholderText:o,prefixIconProps:r,renderSuggestionItem:u,selectedTags:c,suggestions:g,suggestionsLoading:h,suggestionsLoadingText:d}=this.props;return s.createElement(t.FocusWithin.FocusWithin,{onBlur:this.onBlur},p=>s.createElement(s.Fragment,null,s.createElement(t.Observer.Observer,{suggestionsLoading:{observableValue:h,filter:this.suggestionsLoaded},suggestionsVisible:this.suggestionsVisible,selectedIndex:this.selectedIndex,selectableTags:this.selectableTags,selectedTags:c,suggestions:{observableValue:g,filter:this.suggestionsLoaded},textValue:this.textValue},l=>{const u=this.createGenericItem(this.textValue.value,l.suggestions.concat(l.selectedTags));return u&&l.suggestions.unshift(u),s.createElement(t.Measure.Measure,{onMeasure:this.onTagPickerSizeChanged},s.createElement("div",{className:t.Util.css("bolt-tag-picker",(p.hasFocus||l.suggestionsVisible)&&"edit"),ref:this.outerElement,onBlur:p.onBlur,onFocus:p.onFocus,onClick:this.focusInput},s.createElement("div",{className:"bolt-tag-picker-group flex-center flex-row flex-grow flex-wrap",onKeyDown:a&&this.onOuterKeyDown},0===l.selectedTags.length&&r?s.createElement(t.Icon.Icon,Object.assign({},r,{className:t.Util.css(r.className,"bolt-tag-picker-prefix-icon")})):null,l.selectedTags.map((e,i)=>{const o=n(e,i),r=this.indexOfTag(e,l.selectableTags);return s.createElement(t.Pill.Pill,Object.assign({},o,{key:t.Util.getSafeId("bolt-tag-picker-pill"+i),className:t.Util.css(o.className,"bolt-tag-picker-pill",a&&"bolt-tag-picker-pill-selectable",r>=0&&"active"),contentClassName:"text-ellipsis scroll-hidden",onClick:t=>{this.onTagClicked(t,e),o.onClick&&o.onClick(t)},onRemoveClick:t=>{this.onTagRemoved(e),t.preventDefault()}}),o.content)}),s.createElement(t.FormItem.FormItemContext.Consumer,null,n=>{const a=0===l.selectedTags.length||p.hasFocus?o:void 0,r=!p.hasFocus&&l.selectedTags.length>0&&!l.suggestionsVisible;let u;l.suggestionsVisible&&(u=-1===l.selectedIndex||l.suggestionsLoading?t.Util.getSafeId("sug-list-transition"):l.suggestions&&l.suggestions.length?t.Util.getSafeId(`sug-row-${l.selectedIndex}`):t.Util.getSafeId("sug-list-no-results"));const c=l.suggestionsVisible?t.Util.getSafeId("tag-picker-callout"):void 0;return s.createElement("div",{className:"bolt-tag-picker-add-icon-div flex-row flex-grow"},r&&s.createElement(t.Icon.Icon,{className:"bolt-tag-picker-add-icon cursor-pointer",iconName:"Add",size:"small"}),s.createElement("input",{"aria-activedescendant":u,"aria-autocomplete":"list","aria-controls":c,"aria-expanded":l.suggestionsVisible,"aria-haspopup":"listbox","aria-label":e||o,"aria-labelledby":t.Util.getSafeId(i||n.ariaLabelledById),className:t.Util.css("bolt-tag-picker-input flex-row flex-grow scroll-hidden",r&&!a&&"hide-input"),onBlur:p.onBlur,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onClick:this.onInputClick,placeholder:a,ref:this.inputElement,role:"combobox",type:"text",value:l.textValue}))}))))}),s.createElement(t.Observer.Observer,{suggestionsVisible:this.suggestionsVisible,suggestionsLoading:h,selectedIndex:this.selectedIndex,suggestions:g,textValue:this.textValue},e=>e.suggestionsVisible?s.createElement(t.Callout.Callout,{anchorElement:this.outerElement.current||void 0,anchorOrigin:{horizontal:"start",vertical:"end"},calloutOrigin:{horizontal:"start",vertical:"start"},contentClassName:"bolt-tag-picker-callout-content scroll-hidden",contentShadow:!0,id:"tag-picker-callout",role:"presentation"},s.createElement(t.SuggestionsList.SuggestionsList,{isLoading:e.suggestionsLoading,loadingText:d,onBlur:p.onBlur,onFocus:p.onFocus,noResultsFoundText:e.textValue?l:void 0,onSuggestionClicked:this.onSuggestionClick,renderSuggestion:u,selectedIndex:e.selectedIndex,suggestions:e.suggestions,width:this.state.width})):null)))}componentDidMount(){this.onResolveInput=this.timerManagement.debounce(this.onResolveInput,this.props.onSearchChangedDebounceWait)}focus(){this.inputElement.current&&this.inputElement.current.focus()}}t.ComponentsTagPickerTagPicker.TagPicker=a,a.defaultProps={onSearchChangedDebounceWait:250}}(),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(s){for(var i in s)t[e].hasOwnProperty(i)||(t[e][i]=s[i])}(l)}("TagPicker")},["Components/TagPicker/TagPicker","TagPicker"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.ui-tag-picker-content"}}));