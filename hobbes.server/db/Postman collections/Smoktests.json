{
	"info": {
		"_postman_id": "005481b0-f4b7-40a1-84f3-f3afe6ba20b9",
		"name": "Smoktests",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Test Init",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "05082b15-a24d-428f-b54e-fbe4fdb1719b",
						"exec": [
							"pm.test(\"Status code is 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"function testExists(url, descr) {",
							"    request =  {",
							"                url: environment.dburl + url,",
							"                method: 'GET',",
							"                header: 'Authorization:Basic ' + environment.userPass64",
							"               };",
							"               ",
							"   pm.sendRequest(request, function(err, res) {",
							"        pm.test(descr, function() {",
							"            pm.expect(res).to.have.property('code', 200);",
							"        });",
							"    });",
							"}",
							"",
							"testExists('_users', '_users has been created');",
							"testExists('_global_changes', '_global_changes has been created');",
							"testExists('_replicator', '_replicator has been created');",
							"testExists('cache', 'cache has been created');",
							"testExists('cache/_design/default', 'cache default design doc has been created');",
							"testExists('cache/default_hash', 'cache default design doc hash has been created');",
							"testExists('configurations', 'configurations has been created');",
							"testExists('configurations/_design/default', 'configurations default design doc has been created');",
							"testExists('configurations/default_hash', 'configurations default design doc hash has been created');",
							"testExists('rawdata', 'rawdata has been created');",
							"testExists('rawdata/_design/default', 'rawdata default design doc has been created');",
							"testExists('rawdata/default_hash', 'rawdata default design doc hash has been created');",
							"testExists('transformations', 'transformations has been created');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{couch_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{couch_user}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{front}}/api/init",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"init"
					]
				},
				"description": "Tests wether the databases have been created."
			},
			"response": []
		},
		{
			"name": "Test ping",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "2fb7e3b0-23b2-4249-9f4e-f666165e1c7d",
						"exec": [
							"pm.test(\"Ping responded\", function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{front}}/api/ping",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"ping"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test get configurations",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "850de264-28e7-4b7a-9488-4206565b3311",
						"exec": [
							"pm.test(\"Status code ok\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"List of confs returned\", function() {",
							"    pm.expect((pm.response.json().configurations)).to.be.an('array');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{front}}/api/list/configurations",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"list",
						"configurations"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test add configurations",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "839444d7-7583-43b4-97ec-bef867bfbca6",
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "34cc25c7-c4e5-49a1-b4d5-957cd07ab7c7",
						"exec": [
							"function createRequest(url, method, rev) {",
							"    var header;",
							"    if(rev) {",
							"        header = {",
							"                'Authorization': 'Basic ' + environment.userPass64,",
							"                'If-Match': rev",
							"            };",
							"            ",
							"    } else {header = 'Authorization: Basic  ' + environment.userPass64}",
							"   ",
							"    return {",
							"             url: environment.dburl + url,",
							"             method: method,",
							"             header: header",
							"    };",
							"}",
							"",
							"getRequest =  createRequest('configurations/test', 'GET');",
							"              ",
							"pm.test(\"Document put succesfully\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"if(pm.response.code == 200) {",
							"    pm.sendRequest(getRequest, function(err, res) {",
							"        pm.test(\"document found in db\", function() {",
							"            pm.expect(res).to.have.property('code', 200);",
							"        });",
							"        if(err) {",
							"            console.log(err);",
							"        } else if(res.code == 200) {",
							"                removeRequest =  getRequest =  createRequest('configurations/test', 'DELETE', res.json()._rev);",
							"                pm.sendRequest(removeRequest, function(err, res) {});",
							"        }",
							"    });",
							"}",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"key": "Authorization",
						"value": "",
						"type": "text",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"_id\" : \"test\",\r\n    \"source\" : \"name of source such as Azure DevOps, Rally or Jira\",\r\n    \"dataset\" : \"name of the dataset. Eg a project name in azure devops\",\r\n    \"transformations\" : [\"transformation 1\", \"transformation 2\"]\r\n}"
				},
				"url": {
					"raw": "{{front}}/api/configurations",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"configurations"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test get transformations",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "48ae3fb8-66c0-430e-bdd3-d0dccc0a41c9",
						"exec": [
							"pm.test(\"Status code ok\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"List of transformachinos returned\", function() {",
							"    pm.expect((pm.response.json()).transformations).to.be.an('array');",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "8fd83090-fb9b-48b6-a2d8-7ada45d9d1fe",
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{front}}/api/list/transformations",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"list",
						"transformations"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test add transformation",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "8e8d554f-db56-401d-a549-3b15bfb9450e",
						"exec": [
							"function createRequest(url, method, rev) {",
							"    var header;",
							"    if(rev) {",
							"        header = {",
							"                'Authorization': 'Basic ' + environment.userPass64,",
							"                'If-Match': rev",
							"            };",
							"            ",
							"    } else {header = 'Authorization: Basic  ' + environment.userPass64}",
							"   ",
							"    return {",
							"             url: environment.dburl + url,",
							"             method: method,",
							"             header: header",
							"    };",
							"}",
							"",
							"getRequest = createRequest('transformations/test', 'GET');",
							"              ",
							"pm.test(\"Document put succesfully\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"if(pm.response.code == 200) {",
							"    pm.sendRequest(getRequest, function(err, res) {",
							"        pm.test(\"document found in db\", function() {",
							"            pm.expect(res).to.have.property('code', 200);",
							"        });",
							"        if(err) {",
							"            console.log(err);",
							"        } else if(res.code == 200) {",
							"            removeRequest = createRequest('transformations/test', 'GET', res.json()._rev);",
							"            pm.sendRequest(removeRequest, function(err, res) {});",
							"        }",
							"    });",
							"}",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"_id\" : \"test\",\n\t\"lines\" : [\"\",\"jghkhj\"]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{front}}/api/transformations",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"transformations"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test get data",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "12e1e33e-f52a-453f-810a-178e5d3684e4",
						"exec": [
							"function sendRequest(url, body) {",
							"    request =  ",
							"        {",
							"            url: environment.dburl + url,",
							"            method: 'POST',",
							"            header: {",
							"                'Authorization': 'Basic  ' + environment.userPass64,",
							"                'content-type': 'application/json'",
							"            },",
							"            body: {",
							"                mode: 'raw',",
							"                raw: JSON.stringify(body)",
							"            }",
							"       };",
							"               ",
							"   pm.sendRequest(request, function(err, res) {});",
							"}",
							"",
							"var conf = ",
							"    {",
							"        \"_id\" : \"test\",",
							"        \"source\" : \"Azure DevOps\",",
							"        \"dataset\" : \"testSet\",",
							"        \"transformations\" : [\"test\"]",
							"    };",
							"    ",
							"var trans =",
							"    {",
							"        \"_id\": \"test\",",
							"        \"lines\": [\"only 1 = 1\"]",
							"    };",
							"    ",
							"var data =",
							"    {",
							"        \"_id\": \"test\",",
							"        \"project\": \"testSet\",",
							"        \"source\": \"Azure DevOps\",",
							"        \"timestamp\": \"01/01/1970\",",
							"        \"data\": ",
							"        {",
							"            \"@odata.context\": \"https://www.test.test2\",",
							"            \"value\": [",
							"              {",
							"                \"ChangedDate\": \"2019-02-20T14:21:41.137+01:00\",",
							"                \"WorkItemId\": 78566,",
							"                \"WorkItemRevisionSK\": 89722988,",
							"                \"WorkItemType\": \"Task\",",
							"                \"State\": \"New\",",
							"                \"StateCategory\": \"Proposed\",",
							"                \"Iteration\": {",
							"                  \"ProjectSK\": \"7c0a8e77-f740-44a3-96a7-7d7ff665caaf\",",
							"                  \"IterationSK\": \"857658df-406e-43e5-bb1b-382d229f2dea\",",
							"                  \"IterationId\": \"857658df-406e-43e5-bb1b-382d229f2dea\",",
							"                  \"IterationName\": \"Iteration 1\",",
							"                  \"Number\": 2565,",
							"                  \"IterationPath\": \"flowerpot\\\\Iteration 1\",",
							"                  \"StartDate\": \"2019-02-13T00:00:00+01:00\",",
							"                  \"EndDate\": \"2019-02-27T23:59:59.999+01:00\",",
							"                  \"IterationLevel1\": \"flowerpot\",",
							"                  \"IterationLevel2\": \"Iteration 1\",",
							"                  \"Depth\": 1,",
							"                  \"IsEnded\": true",
							"                }",
							"              },",
							"              {",
							"                \"ChangedDate\": \"2019-02-20T14:22:00.37+01:00\",",
							"                \"WorkItemId\": 78567,",
							"                \"WorkItemRevisionSK\": 89722989,",
							"                \"WorkItemType\": \"Task\",",
							"                \"State\": \"New\",",
							"                \"StateCategory\": \"Proposed\",",
							"                \"Iteration\": {",
							"                  \"ProjectSK\": \"7c0a8e77-f740-44a3-96a7-7d7ff665caaf\",",
							"                  \"IterationSK\": \"857658df-406e-43e5-bb1b-382d229f2dea\",",
							"                  \"IterationId\": \"857658df-406e-43e5-bb1b-382d229f2dea\",",
							"                  \"IterationName\": \"Iteration 1\",",
							"                  \"Number\": 2565,",
							"                  \"IterationPath\": \"flowerpot\\\\Iteration 1\",",
							"                  \"StartDate\": \"2019-02-13T00:00:00+01:00\",",
							"                  \"EndDate\": \"2019-02-27T23:59:59.999+01:00\",",
							"                  \"IterationLevel1\": \"flowerpot\",",
							"                  \"IterationLevel2\": \"Iteration 1\",",
							"                  \"Depth\": 1,",
							"                  \"IsEnded\": true",
							"                }",
							"              }",
							"            ]",
							"        }",
							"    };",
							"    ",
							"sendRequest('rawdata', data);",
							"sendRequest('transformations', trans);",
							"sendRequest('configurations', conf);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "95c42f7f-06fe-4a44-98d4-1c2c0a459199",
						"exec": [
							"pm.test(\"Status code ok\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"reponse is text\", function() {",
							"    pm.expect(pm.response.text()).to.be.an('string');",
							"});",
							"",
							"function createRequest(url, method, rev) {",
							"    var header;",
							"    if(rev) {",
							"        header = {",
							"                'Authorization': 'Basic ' + environment.userPass64,",
							"                'If-Match': rev",
							"            };",
							"            ",
							"    } else {header = 'Authorization: Basic  ' + environment.userPass64}",
							"   ",
							"    return {",
							"             url: environment.dburl + url,",
							"             method: method,",
							"             header: header",
							"    };",
							"}",
							"",
							"function requestDelete(url) {",
							"    pm.sendRequest(createRequest(url, 'GET'), function(err, res) {",
							"        if(err) {",
							"            console.log(err);",
							"        } else {",
							"            pm.sendRequest(createRequest(url, 'DELETE', res.json()._rev), function(err, res) {});",
							"        }",
							"    });",
							"}",
							"",
							"requestDelete('configurations/test');",
							"requestDelete('transformations/test');",
							"requestDelete('rawdata/test');",
							"requestDelete('cache/Azure DevOps:testSet:test');",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{front}}/api/data/test",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"data",
						"test"
					]
				}
			},
			"response": []
		},
		{
			"name": "Test get cache",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "dc030ad5-bb28-4869-959e-e2fa456cdd21",
						"exec": [
							"pm.test(\"Status code ok\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"List of johnny cache returned\", function() {",
							"    pm.expect((pm.response.json()).cache).to.be.an('array')",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{pat}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{front}}/api/list/cache",
					"host": [
						"{{front}}"
					],
					"path": [
						"api",
						"list",
						"cache"
					]
				}
			},
			"response": []
		}
	],
	"protocolProfileBehavior": {}
}